<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport">
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹ - å­è§„å…¥æ¢§æ¡</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½ å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚ ç±»åŠ è½½å™¨JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰ æ‹“å±•ç±»åŠ è½½å™¨ï¼šExtension">
<meta property="og:type" content="article">
<meta property="og:title" content="ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹">
<meta property="og:url" content="https://www.lazydaily.cn/761386768996885/index.html">
<meta property="og:site_name" content="å­è§„å…¥æ¢§æ¡">
<meta property="og:description" content="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½ å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚ ç±»åŠ è½½å™¨JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰ æ‹“å±•ç±»åŠ è½½å™¨ï¼šExtension">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901134621820.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901135402519.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901160002516.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901160256824.png">
<meta property="article:published_time" content="2024-08-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-20T07:21:30.943Z">
<meta property="article:author" content="z1gui">
<meta property="article:tag" content="java">
<meta property="article:tag" content="ç±»åŠ è½½å™¨">
<meta property="article:tag" content="åŒäº²å§”æ´¾æ¨¡å‹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lazydaily.cn/img/20200901134621820.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://www.lazydaily.cn/761386768996885/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.png">
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

  
<link rel="stylesheet" href="/css/a11y-dark.min.css">

  
<script src="/js/toc.js"></script>

  

  
  <!-- å›¾ç‰‡æ‡’åŠ è½½ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // åªé€‰æ‹©markdownæ–‡æ¡£ä¸­çš„æ‡’åŠ è½½å›¾ç‰‡
      const lazyImages = document.querySelectorAll('.post-md .lazy-image');
      
      if (lazyImages.length === 0) return;
      
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const spinner = img.previousElementSibling;
            
            // åŠ è½½å›¾ç‰‡
            img.src = img.dataset.src;
            
            // å›¾ç‰‡åŠ è½½å®Œæˆåçš„å¤„ç†
            img.addEventListener('load', function() {
              img.classList.add('loaded');
              if (spinner && spinner.classList.contains('image-loading-spinner')) {
                spinner.classList.add('hidden');
              }
            });
            
            // å›¾ç‰‡åŠ è½½å¤±è´¥çš„å¤„ç†
            img.addEventListener('error', function() {
              if (spinner && spinner.classList.contains('image-loading-spinner')) {
                spinner.classList.add('hidden');
              }
              console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', img.dataset.src);
            });
            
            // åœæ­¢è§‚å¯Ÿè¿™ä¸ªå›¾ç‰‡
            observer.unobserve(img);
          }
        });
      }, {
        rootMargin: '50px 0px', // æå‰50pxå¼€å§‹åŠ è½½
        threshold: 0.01
      });
      
      // å¼€å§‹è§‚å¯Ÿæ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡
      lazyImages.forEach(img => {
        imageObserver.observe(img);
      });
    });
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="å­è§„å…¥æ¢§æ¡" type="application/atom+xml">
</head>

    <body>
        <!-- å›ºå®šå·¥å…·æ  -->
        <div class="fixed-toolbar">
        </div>
        
        <div class="paper">
            <div class="paper-main">
                <div class="header">
    <div class="header-content">
        <!-- å¤´åƒå’Œä¸»æ ‡é¢˜ä¸€èµ·å¯ç‚¹å‡» -->
        <a href="/" class="header-home-link">
            <div class="hero-header">
                <div class="hero-header-visual">
                    <div class="hero-header-graphic">
                        <img src="/img/favicon.png" alt="Logo" width="30" height="30">
                    </div>
                </div>
                <div class="hero-header-text">
                    <h1 class="hero-header-title">å­è§„å…¥æ¢§æ¡</h1>
                </div>
            </div>
        </a>
        <!-- å¯¼èˆªæ  -->
        <ul class="nav">
            
            <li>
                
                <a href="/" class="">
                   ä¸»é¡µ
                   
                </a>
            </li>
            
            <li>
                
                <a href="/archives" class="">
                   å½’æ¡£
                   
                </a>
            </li>
            
            <li>
                
                <a href="/about" class="">
                   å…³äº
                   
                </a>
            </li>
            
            <li>
                
                <a href="/use" class="">
                   è®¾å¤‡
                   
                </a>
            </li>
            
            <li>
                
                <a href="https://uhufoundme.sol.build/" class="" target="&quot;_blank&quot;" rel="&quot;noopener" noreferrer&#34;="">
                   ç¢ç¢å¿µ
                   
                   <span class="external-link-icon">ğŸ”—</span>
                   
                </a>
            </li>
            
        </ul>
    </div>
</div>

                <div class="post-main">
    <!-- é˜…è¯»è¿›åº¦æ¡ -->
    <div class="reading-progress-bar" id="readingProgressBar"></div>
    
    
        <div class="post-main-title">
            ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹
        </div>
        <div class="post-meta">
            2024-09-01 ï½œ 
            
                <a href="/tags/java/"># java</a>
            
                <a href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"># ç±»åŠ è½½å™¨</a>
            
                <a href="/tags/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B/"># åŒäº²å§”æ´¾æ¨¡å‹</a>
            
        </div>

        <div class="post-content-wrapper">
            <div class="post-content-main">
                <div class="post-md">
                    <h3 id="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰"><a href="#ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰" class="headerlink" title="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰"></a>ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰</h3><p><strong>åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½</strong></p>
<p><div class="image-loading-spinner"></div><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸ" data-src="/img/20200901134621820.png" loading="lazy" class="lazy-image"><br>å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚</p>
<h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a><strong>ç±»åŠ è½½å™¨</strong></h3><p>JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨</p>
<p><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰</p>
<p><strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>ï¼šExtension Class Loaderï¼Œjre/lib/extä¸‹çš„jaræˆ–è€…æ˜¯æŒ‡å®šçš„jar</p>
<p><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</strong>ï¼šApplication  Class Loaderï¼ŒåŠ è½½calsspathæŒ‡å®šå†…å®¹</p>
<p>å½“ç„¶è‡ªå·±ä¹Ÿå¯ä»¥å®šä¹‰åŠ è½½å™¨ï¼Œä¸ç®—å…¥JVMä¸­çš„ï¼Œ<strong>è‡ªå®šä¹‰åŠ è½½å™¨</strong>ï¼šCustom ClassLoaderï¼Œè‡ªå®šä¹‰åŠ è½½å™¨ï¼Œæ”¯æŒä¸€äº›ä¸ªæ€§åŒ–çš„æ‰©å±•åŠŸèƒ½</p>
<pre><code class="language-text">Xbootclasspath
è®¾ç½®å¯åŠ¨ç±»åŠ è½½å™¨çš„è·¯å¾„
</code></pre>
<h3 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a><strong>åŒäº²å§”æ´¾æ¨¡å‹</strong></h3><p><div class="image-loading-spinner"></div><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="åŒäº²å§”æ´¾æ¨¡å‹" data-src="/img/20200901135402519.png" loading="lazy" class="lazy-image"><br>æ¯ä¸€å±‚çš„ç±»åŠ è½½å™¨éƒ½æœ‰ä¸Šå±‚çš„åŠ è½½å™¨ï¼Œç§°ä¸ºçˆ¶ç±»åŠ è½½å™¨ï¼ŒBootstrapåŠ è½½å™¨æœ€ä¸Šå±‚çš„ç±»åŠ è½½å™¨ï¼Œä¸»è¦åŠ è½½ä¸€äº›é‡è¦çš„ç±»ï¼Œå¦‚Objectç±»ï¼ŒStringç±»ç­‰ã€‚å½“ç±»éœ€è¦åŠ è½½çš„æ—¶å€™å­ç±»åŠ è½½å™¨ä¼šä¾æ¬¡å‘ä¸Šå§”æ‰˜çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå¹¶å‘ä¸Šè¯¢é—®æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœçˆ¶ç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œåˆ™å‘ä¸‹å°è¯•å­ç±»åŠ è½½å™¨æ˜¯å¦å¯åŠ è½½ï¼Œç›´åˆ°è¯¥ç±»è¢«åŠ è½½ï¼Œè¿‡ç¨‹ç»“æŸã€‚è¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å‹æœºåˆ¶ã€‚</p>
<p>æ€»ç»“ï¼š<strong>å‘ä¸Šå§”æ‰˜å¹¶è¯¢é—®ï¼Œå‘ä¸‹å°è¯•åŠ è½½</strong></p>
<p>ä¼˜åŠ¿ï¼š<strong>ç¨³å®š</strong>ï¼Œå½“è‡ªå·±é‡å†™äº†ä¸ªåŸºç¡€ç±»ï¼ˆObjectç±»ï¼ŒStringç±»ç­‰ï¼‰è¿›è¡ŒåŠ è½½çš„æ—¶å€™ï¼Œå­ç±»åŠ è½½å™¨ä¾æ¬¡å‘ä¸Šå§”æ‰˜åŸºç¡€ç±»ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ°äº†Bootstrapç±»åŠ è½½å™¨å‘ç°rt.jarä¸­æœ‰ï¼Œç„¶åå°±ç›´æ¥åŠ è½½ï¼Œè¿”å›åŠ è½½æˆåŠŸã€‚è¿™æ ·ä¿è¯äº†JVMè¿è¡Œçš„å®‰å…¨ç¨³å®šã€‚</p>
<p><strong>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨ Java è™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚</strong></p>
<h4 id="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹"><a href="#æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹"></a><strong>æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹</strong></h4><p>è™½ç„¶åŒäº²å§”æ´¾æ¨¡å‹èƒ½å¤Ÿä¿è¯JVMç¨³å®šè¿è¡Œï¼Œä½†æœ‰äº›æ—¶å€™æ ¹æ®åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰“ç ´è¿™ç§æœºåˆ¶ã€‚</p>
<h5 id="1-Tomcaç±»åŠ è½½æœºåˆ¶"><a href="#1-Tomcaç±»åŠ è½½æœºåˆ¶" class="headerlink" title="1.Tomcaç±»åŠ è½½æœºåˆ¶"></a>1.Tomcaç±»åŠ è½½æœºåˆ¶</h5><p><div class="image-loading-spinner"></div><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="TomcatåŠ è½½æœºåˆ¶" data-src="/img/20200901160002516.png" loading="lazy" class="lazy-image"></p>
<p>Tomcatä¸­è‡ªå®šä¹‰çš„CommonåŠ è½½å™¨ï¼šCatalinaç±»+Sharedç±»åŠ è½½å™¨</p>
<p>tomcaté€šè¿‡waråŒ…è¿›è¡Œçš„åº”ç”¨å‘å¸ƒï¼Œå…¶å®æ—¶è¿åäº†åŒäº²å§”æ´¾æœºåˆ¶åŸåˆ™ã€‚å› ä¸ºä¸åŒçš„é¡¹ç›®å¯èƒ½ç”¨åˆ°ä¸åŒç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹ï¼Œå³éœ€è¦ä¸åŒwebAppç±»åŠ è½½å™¨åŠ è½½ä¸åŒç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹ï¼Œéœ€è¦éš”ç¦»ï¼Œæ‰€ä»¥è¦ç ´ååŒäº²å§”æ´¾æ¨¡å‹ã€‚</p>
<p><strong>tomcatçš„è®¾è®¡å¦‚ä½•ç ´åäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ</strong></p>
<p>tomcatä¸­å­˜åœ¨ä¸‰ç§ç±»åŠ è½½å™¨ï¼ŒCommonåŠ è½½å™¨ï¼šCatalinaç±»+Sharedç±»åŠ è½½å™¨ï¼Œåœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p>
<p>1.é¦–å…ˆåˆ¤æ–­è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½äº†ï¼Œå¦‚æœè¢«åŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>2.å°è¯•é€šè¿‡Appcalition ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œä¸»è¦æ˜¯é¿å…ä¸€äº›åŸºç¡€ç±»ï¼ˆObjectï¼ŒStringç±»ï¼‰è¢«webä¸­çš„ç±»è¦†ç›–ï¼Œå¯¼è‡´ä¸å®‰å…¨ï¼Œå¦‚æœåŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>3.å¦‚æœå‰ä¸¤æ­¥éƒ½æ²¡æœ‰åŠ è½½åˆ°ç±»ï¼Œå°±å¯ç”¨webAppç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœè¢«åŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>4.æœ€åè¿˜æ²¡æœ‰åŠ è½½çš„è¯ï¼Œå°±å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨Common ClassLoaderè¿›è¡ŒåŠ è½½ã€‚</p>
<p><strong>ä½†æ˜¯ä½ è‡ªå·±å†™ä¸€ä¸ª ArrayListæˆ–è€…HashMapæ—¶å€™ï¼Œæ”¾åœ¨åº”ç”¨ç›®å½•é‡Œï¼Œtomcat ä¾ç„¶ä¸ä¼šåŠ è½½ï¼ˆä¼šåœ¨ç¬¬äºŒæ­¥æ—¶é€šè¿‡Applicationç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼‰ã€‚Tomcaç±»åŠ è½½æœºåˆ¶åªæ˜¯è‡ªå®šä¹‰çš„åŠ è½½å™¨é¡ºåºä¸åŒï¼Œä½†å¯¹äºé¡¶å±‚æ¥è¯´ï¼Œè¿˜æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<h5 id="2-SPIï¼ˆService-Provider-Infrefaceï¼‰"><a href="#2-SPIï¼ˆService-Provider-Infrefaceï¼‰" class="headerlink" title="2.SPIï¼ˆService Provider Infrefaceï¼‰"></a>2.<strong>SPI</strong>ï¼ˆService Provider Infrefaceï¼‰</h5><p>Java ä¸­æœ‰ä¸€ä¸ª SPI æœºåˆ¶ï¼Œå…¨ç§°æ˜¯ Service Provider Interfaceï¼Œæ˜¯ Java æä¾›çš„ä¸€å¥—ç”¨æ¥è¢«ç¬¬ä¸‰æ–¹å®ç°æˆ–è€…æ‰©å±•çš„æœåŠ¡æä¾›æ¥å£ï¼Œè®¾è®¡æ¨¡å¼ï¼šåŸºäºæ¥å£çš„ç¼–ç¨‹ï¼Œæ˜¯æ¥å£+å®ç°ç±»+é…ç½®æ–‡ä»¶</p>
<p>å…¶ä¸­æœ€æœ‰ä»£è¡¨æ€§çš„ï¼Œ<strong>JDBCï¼Œæ•°æ®åº“è¿æ¥</strong></p>
<p><strong>å¦‚ä½•ç ´ç¯åŒäº²å§”æ´¾ï¼Ÿ</strong></p>
<p>åŸæœ¬åº”è¯¥æ˜¯é€šè¿‡BootStrap ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œæ²¡æœ‰ä»£ç è¿›è¡Œå®ç°åŠ è½½ï¼Œåªèƒ½è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œå³æ•´ä¸ªwebçš„Application ClassLoderï¼Œæ‰€ä»¥æœ€åå…¶å®åœ¨ä½¿ç”¨çš„Applicationç±»åŠ è½½å™¨åŠ è½½</p>
<p><div class="image-loading-spinner"></div><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="SPI" data-src="/img/20200901160256824.png" loading="lazy" class="lazy-image"><br>æºç åˆ†æ</p>
<pre><code class="language-java">public class Test{
//æˆ‘ä»¬åœ¨JDBCè¿æ¥æ•°æ®åº“çš„æ—¶å€™å¾€å¾€é€šè¿‡ä¸€è¡Œä»£ç å°±èƒ½å®ç°
//Class.forName("xx");å¯ä»¥ä¸ç”¨å†™

    Connection conn= DriverManager.getConnection(url, user, password);
//å½“getConnectionè¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒDriverManagerä¸­æœ‰ä¸ªstaticé™æ€ä»£ç å—è¿›è¡Œæ‰§è¡Œ
    /**
     * Load the initial JDBC drivers by checking the System property
     * jdbc.properties and then use the {@code ServiceLoader} mechanism
     */
    static {
        loadInitialDrivers();
        println("JDBC DriverManager initialized");
    }
    //é™æ€ä»£ç å—æ‰§è¡Œçš„æ–¹æ³•loadInitialDrivers()
    private static void loadInitialDrivers() {
        String drivers;
        try {
            drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {
                public String run() {
                    return System.getProperty("jdbc.drivers");
                }
            });
        } catch (Exception ex) {
            drivers = null;
        }
        // If the driver is packaged as a Service Provider, load it.
        // Get all the drivers through the classloader
        // exposed as a java.sql.Driver.class service.
        // ServiceLoader.load() replaces the sun.misc.Providers()

        AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
            public Void run() {
                //æ³¨æ„è¿™é‡Œï¼ï¼ï¼åŠ è½½Driver.classä»£ç 
                ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);
                Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();

                /* Load these drivers, so that they can be instantiated.
                 * It may be the case that the driver class may not be there
                 * i.e. there may be a packaged driver with the service class
                 * as implementation of java.sql.Driver but the actual class
                 * may be missing. In that case a java.util.ServiceConfigurationError
                 * will be thrown at runtime by the VM trying to locate
                 * and load the service.
                 *
                 * Adding a try catch block to catch those runtime errors
                 * if driver not available in classpath but it's
                 * packaged as service and that service is there in classpath.
                 */
                try{
                    while(driversIterator.hasNext()) {
                        driversIterator.next();
                    }
                } catch(Throwable t) {
                    // Do nothing
                }
                return null;
            }
        });

        println("DriverManager.initialize: jdbc.drivers = " + drivers);

        if (drivers == null || drivers.equals("")) {
            return;
        }
        String[] driversList = drivers.split(":");
        println("number of Drivers:" + driversList.length);
        for (String aDriver : driversList) {
            try {
                println("DriverManager.Initialize: loading " + aDriver);
                Class.forName(aDriver, true,
                        ClassLoader.getSystemClassLoader());
            } catch (Exception ex) {
                println("DriverManager.Initialize: load failed: " + ex);
            }
        }
    }
    //è¿›å…¥åˆ°ServiceLoaderä¹‹åçš„ä»£ç 
//èƒ½å‘ç°ï¼Œè¿™ä¸ªåŠ è½½æ—¶æ˜¯è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè€Œè¿™ä¸ªåŠ è½½å™¨ä¸æ˜¯JVMä¸­BootStrapç±»åŠ è½½å™¨ï¼Œè€Œæ˜¯å‚å•†æä¾›çš„ï¼Œæ‰€ä»¥åŠ è½½çš„æ—¶å€™ä¸æ˜¯åœ¨BootStrapç±»åŠ è½½å™¨åŠ è½½ï¼Œåœ¨æ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹~
    public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) {
        ClassLoader cl = Thread.currentThread().getContextClassLoader();
        return ServiceLoader.load(service, cl);
    }
}

</code></pre>
<p>æ€»ç»“ï¼šé€šè¿‡æºç ä¸éš¾çœ‹å‡ºï¼ŒClass.forName(â€œxxâ€);èƒ½å†™ä¸”ä¸æŠ¥é”™ï¼Œè¯´æ˜åœ¨JVMé‡Œé¢æœ‰è¿™ä¸ªDriveç±»çš„åŠ è½½ä»£ç ï¼Œä½†æ˜¯åªæœ‰æ¥å£ï¼Œæ²¡æœ‰å®ç°ï¼Œå…·ä½“å®ç°æ˜¯å‚å•†æä¾›çš„ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸éµå¾ªåŒäº²å§”æ´¾æœºåˆ¶ã€‚</p>
<blockquote>
<p>å¯¹SPIæƒ³å¤šç‚¹äº†è§£ï¼Œå¯å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNDY0MTg2MA==&amp;mid=2247483935&amp;idx=1&amp;sn=e6da46cfe2df2812fd2b9e24253ec246&amp;chksm=97a53fb4a0d2b6a2896b5c0850e83a7852ad08fbe0939bb61d04982bc0d03d3f6da25ee56dbf&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzIxNDY0MTg2MA==&amp;mid=2247483935&amp;idx=1&amp;sn=e6da46cfe2df2812fd2b9e24253ec246&amp;chksm=97a53fb4a0d2b6a2896b5c0850e83a7852ad08fbe0939bb61d04982bc0d03d3f6da25ee56dbf&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<h5 id="3-OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰-å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚"><a href="#3-OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰-å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚" class="headerlink" title="3.OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰  å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚"></a>3.<strong>OSGi</strong>â€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰  å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚</h5><p>åŸç†ï¼šä½¿ç±»ç›¸äº’ä¹‹é—´ä¸å¯è§ï¼Œç›¸å½“éœ¸é“ï¼ï¼ˆåç»­è¡¥å……ï¼‰</p>

                </div>
            </div>
            <div class="post-content-sidebar">
                <div class="toc-toggle-btn" id="tocToggleBtn" title="æ˜¾ç¤ºç›®å½•">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </div>
                <div class="post-toc" id="postToc">
                    <div class="toc-header">
                        <div class="toc-title">ç›®å½•</div>
                    </div>
                    <div class="toc-content"></div>
                </div>
            </div>
        </div>
    

<!-- åªåœ¨æ–‡ç« é¡µé¢æ˜¾ç¤ºåˆ†ç±»å’Œå¯¼èˆª -->

    <!-- åˆ†ç±»ä¿¡æ¯ -->
    
        <div class="post-categories">
            åˆ†ç±»ï¼š
            
                <a href="/categories/%E5%90%8E%E7%AB%AF/"> / åç«¯</a>
            
        </div>
    

    <!-- åˆ†äº«æŒ‰é’® -->
    <div class="post-share">
        <button class="share-btn" id="shareBtn" title="åˆ†äº«æ–‡ç« ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 5.12548 15.0077 5.24917 15.0227 5.37061L8.08264 9.26727C7.54305 8.48822 6.60487 8 5.5 8C4.11929 8 3 9.11929 3 10.5C3 11.8807 4.11929 13 5.5 13C6.60487 13 7.54305 12.5118 8.08264 11.7327L15.0227 15.6294C15.0077 15.7508 15 15.8745 15 16C15 17.6569 16.3431 19 18 19C19.6569 19 21 17.6569 21 16C21 14.3431 19.6569 13 18 13C16.8951 13 15.9569 13.4882 15.4174 14.2673L8.47736 10.3706C8.49232 10.2492 8.5 10.1255 8.5 10C8.5 9.87452 8.49232 9.75083 8.47736 9.62939L15.4174 5.73273C15.9569 6.51178 16.8951 7 18 7C19.6569 7 21 5.65685 21 4C21 2.34315 19.6569 1 18 1C16.3431 1 15 2.34315 15 4C15 4.12548 15.0077 4.24917 15.0227 4.37061L8.08264 8.26727C7.54305 7.48822 6.60487 7 5.5 7C3.567 7 2 8.567 2 10.5C2 12.433 3.567 14 5.5 14C6.60487 14 7.54305 13.5118 8.08264 12.7327L15.0227 16.6294C15.0077 16.7508 15 16.8745 15 17C15 18.6569 16.3431 20 18 20C19.6569 20 21 18.6569 21 17C21 15.3431 19.6569 14 18 14C16.8951 14 15.9569 14.4882 15.4174 15.2673L8.47736 11.3706C8.49232 11.2492 8.5 11.1255 8.5 11C8.5 10.8745 8.49232 10.7508 8.47736 10.6294L15.4174 6.73273C15.9569 7.51178 16.8951 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            åˆ†äº«
        </button>
    </div>

    <!-- æ·»åŠ ä¸Šä¸€ç¯‡å’Œä¸‹ä¸€ç¯‡å¯¼èˆª -->
    <div class="post-navigation">
        <div class="post-nav-prev">
            
                <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                <a href="/761386768996841/" class="nav-title">èŠèŠJava IOçš„é‚£äº›äº‹</a>
            
        </div>
        <div class="post-nav-next">
            
                <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                <a href="/761386768996512/" class="nav-title">javascriptä¸­ constï¼Œvarï¼Œletçš„åŒºåˆ«</a>
            
        </div>
    </div>

</div>

<!-- å›¾ç‰‡å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="image-modal" id="imageModal">
    <img id="modalImage" src="" alt="å…¨å±å›¾ç‰‡">
</div>

<!-- ä»£ç å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="code-modal" id="codeModal">
    <div class="code-modal-content">
        <div class="code-modal-header">
            <div class="code-modal-title">ä»£ç æŸ¥çœ‹</div>
            <div class="code-modal-close" id="codeModalClose">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
        </div>
        <div class="code-modal-code">
            <pre><code id="modalCode"></code></pre>
        </div>
    </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const postImages = document.querySelectorAll('.post-md img');

    // ç‚¹å‡»å›¾ç‰‡æ‰“å¼€æ¨¡æ€æ¡†
    postImages.forEach(img => {
        // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦åœ¨ç¤¾äº¤é“¾æ¥ä¸­
        const isSocialIcon = img.closest('.social-links') !== null;
        if (!isSocialIcon) {
            img.addEventListener('click', function() {
                modal.classList.add('active');
                modalImg.src = this.src;
                document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            });
        }
    });

    // ç‚¹å‡»æ¨¡æ€æ¡†å…³é—­
    modal.addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
    });

    // æŒ‰ ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    // é˜…è¯»è¿›åº¦æ¡åŠŸèƒ½
    const progressBar = document.getElementById('readingProgressBar');
    if (progressBar) {
        function updateReadingProgress() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            
            // é™åˆ¶è¿›åº¦æ¡å®½åº¦åœ¨0-100%ä¹‹é—´
            const progressWidth = Math.min(Math.max(scrollPercent, 0), 100);
            progressBar.style.width = progressWidth + '%';
        }

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', updateReadingProgress);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¿›åº¦æ¡
        updateReadingProgress();
    }



    // ç›®å½•åŠŸèƒ½å·²ç§»è‡³å·¥å…·æ ç»Ÿä¸€ç®¡ç†

    // ä»£ç å—å…¨å±åŠŸèƒ½
    const codeModal = document.getElementById('codeModal');
    const modalCode = document.getElementById('modalCode');
    const codeModalClose = document.getElementById('codeModalClose');

    // ä¸ºæ‰€æœ‰ä»£ç å—æ·»åŠ å…¨å±æŒ‰é’®
    const codeBlocks = document.querySelectorAll('.post-md pre');
    codeBlocks.forEach(pre => {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰æŒ‰é’®ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
        if (!pre.querySelector('.code-fullscreen-btn')) {
            const fullscreenBtn = document.createElement('div');
            fullscreenBtn.className = 'code-fullscreen-btn';
            fullscreenBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H5C3.89543 3 3 3.89543 3 5V8M21 8V5C21 3.89543 20.1046 3 19 3H16M16 21H19C20.1046 21 21 20.1046 21 19V16M3 16V19C3 20.1046 3.89543 21 5 21H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            fullscreenBtn.title = 'å…¨å±æŸ¥çœ‹ä»£ç ';
            
            // ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå…¨å±ä»£ç 
            fullscreenBtn.addEventListener('click', function() {
                const codeElement = pre.querySelector('code');
                if (codeElement) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å·²ç»åº”ç”¨äº†è¡Œå·çš„ä»£ç å—
                    const hljsTable = pre.querySelector('table.hljs-ln');
                    
                    let codeContent;
                    let startLineNumber = 1;
                    
                    if (hljsTable) {
                        // å¦‚æœæœ‰è¡Œå·è¡¨æ ¼ï¼Œæå–çº¯ä»£ç å†…å®¹å’Œèµ·å§‹è¡Œå·
                        const codeLines = hljsTable.querySelectorAll('.hljs-ln-code');
                        codeContent = Array.from(codeLines).map(line => {
                            // æå–æ¯è¡Œçš„æ–‡æœ¬å†…å®¹ï¼Œä¿æŒåŸå§‹æ ¼å¼
                            return line.textContent || line.innerText || ' ';
                        }).join('\n');
                        
                        // è·å–èµ·å§‹è¡Œå·
                        const firstNumberCell = hljsTable.querySelector('.hljs-ln-numbers');
                        if (firstNumberCell) {
                            const lineAttr = firstNumberCell.getAttribute('data-line-number');
                            if (lineAttr) {
                                startLineNumber = parseInt(lineAttr) || 1;
                            }
                        }
                    } else {
                        // æ™®é€šä»£ç å—ï¼Œç›´æ¥è·å–æ–‡æœ¬å†…å®¹
                        codeContent = codeElement.textContent || codeElement.innerText;
                    }
                    
                    const codeLanguage = getCodeLanguage(codeElement);
                    
                    // è®¾ç½®æ¨¡æ€æ¡†ä¸­çš„ä»£ç å†…å®¹
                    modalCode.textContent = codeContent;
                    modalCode.className = codeElement.className; // ä¿æŒä»£ç é«˜äº®çš„ç±»å
                    
                    // å¦‚æœåŸä»£ç æœ‰è‡ªå®šä¹‰èµ·å§‹è¡Œå·ï¼Œè®¾ç½®dataå±æ€§
                    if (startLineNumber !== 1) {
                        modalCode.setAttribute('data-ln-start-from', startLineNumber);
                    } else {
                        modalCode.removeAttribute('data-ln-start-from');
                    }
                    
                    // æ›´æ–°æ ‡é¢˜
                    const modalTitle = document.querySelector('.code-modal-title');
                    if (codeLanguage) {
                        modalTitle.textContent = `ä»£ç æŸ¥çœ‹ - ${codeLanguage}`;
                    } else {
                        modalTitle.textContent = 'ä»£ç æŸ¥çœ‹';
                    }
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    codeModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    // é‡æ–°åº”ç”¨ä»£ç é«˜äº®å’Œè¡Œå·
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightElement(modalCode);
                        
                        // åº”ç”¨è¡Œå·
                        if (typeof hljs.lineNumbersBlock !== 'undefined') {
                            hljs.lineNumbersBlock(modalCode, {
                                startFrom: startLineNumber
                            });
                        }
                    }
                }
            });
            
            pre.appendChild(fullscreenBtn);
        }
    });

    // è·å–ä»£ç è¯­è¨€
    function getCodeLanguage(codeElement) {
        const className = codeElement.className;
        const languageMatch = className.match(/language-(\w+)|hljs-(\w+)|\b(\w+)$/);
        if (languageMatch) {
            return languageMatch[1] || languageMatch[2] || languageMatch[3];
        }
        return '';
    }

    // å…³é—­ä»£ç å…¨å±æ¨¡æ€æ¡†
    function closeCodeModal() {
        codeModal.classList.remove('active');
        document.body.style.overflow = '';
    }

    // ç‚¹å‡»å…³é—­æŒ‰é’®
    if (codeModalClose) {
        codeModalClose.addEventListener('click', closeCodeModal);
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­ï¼ˆç‚¹å‡»å†…å®¹åŒºåŸŸä¸å…³é—­ï¼‰
    codeModal.addEventListener('click', function(e) {
        if (e.target === codeModal) {
            closeCodeModal();
        }
    });

    // æŒ‰ ESC é”®å…³é—­ä»£ç æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (codeModal.classList.contains('active')) {
                closeCodeModal();
            }
        }
    });

    // åˆ†äº«åŠŸèƒ½
    const shareBtn = document.getElementById('shareBtn');
    if (shareBtn) {
        shareBtn.addEventListener('click', function() {
            // è·å–æ–‡ç« ä¿¡æ¯
            const title = document.querySelector('.post-main-title')?.textContent?.trim() || 'æœªçŸ¥æ ‡é¢˜';
            const date = document.querySelector('.post-meta')?.textContent?.match(/\d{4}-\d{2}-\d{2}/)?.[0] || '';
            const url = window.location.href;
            
            // è·å–æ–‡ç« å‰å‡ è¡Œå†…å®¹ï¼ˆæ’é™¤æ ‡é¢˜ã€å…ƒä¿¡æ¯ç­‰ï¼‰
            const postContent = document.querySelector('.post-md');
            let content = '';
            if (postContent) {
                // è·å–æ‰€æœ‰æ®µè½å’Œæ–‡æœ¬å†…å®¹
                const paragraphs = postContent.querySelectorAll('p, h1, h2, h3, h4, h5, h6');
                const contentArray = [];
                
                for (let i = 0; i < Math.min(paragraphs.length, 3); i++) {
                    const text = paragraphs[i].textContent?.trim();
                    if (text && text.length > 0) {
                        contentArray.push(text);
                    }
                }
                
                content = contentArray.join('\n\n');
                
                // å¦‚æœå†…å®¹å¤ªé•¿ï¼Œæˆªå–å‰100ä¸ªå­—ç¬¦
                if (content.length > 100) {
                    content = content.substring(0, 100) + '...';
                }
            }
            
            // æ„å»ºåˆ†äº«å†…å®¹
            let shareText = `æ–‡ç« æ ‡é¢˜ï¼š ${title}`;
            if (date) {
                shareText += `\nå‘å¸ƒæ—¶é—´ï¼š ${date}`;
            }
            if (content) {
                shareText += `\n\n${content}`;
            }
            shareText += `\n\nğŸ”— ${url}`;
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard && window.isSecureContext) {
                // ä½¿ç”¨ç°ä»£ Clipboard API
                navigator.clipboard.writeText(shareText).then(function() {
                    showShareSuccess();
                }).catch(function(err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(shareText);
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyTextToClipboard(shareText);
            }
        });
    }
    
    // æ˜¾ç¤ºåˆ†äº«æˆåŠŸæç¤º
    function showShareSuccess() {
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            const originalText = shareBtn.innerHTML;
            shareBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                å·²å¤åˆ¶
            `;
            shareBtn.classList.add('copied');
            
            setTimeout(function() {
                shareBtn.innerHTML = originalText;
                shareBtn.classList.remove('copied');
            }, 2000);
        }
    }
    
    // é™çº§å¤åˆ¶æ–¹æ¡ˆ
    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showShareSuccess();
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
            }
        } catch (err) {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
        }
        
        document.body.removeChild(textArea);
    }
});
</script>
                
            </div>
        </div>

        <!-- JavaScript -->
        
<script src="/js/highlight.min.js"></script>

        
<script src="/js/highlightjs-line-numbers.js"></script>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ä»£ç é«˜äº®
            hljs.highlightAll();
            hljs.initLineNumbersOnLoad();
            
            const html = document.documentElement;
            const header = document.querySelector('.header');
            
            // å¤´éƒ¨å†…å®¹æ»šåŠ¨æ˜¾ç¤º/éšè—åŠŸèƒ½
            let lastScrollTop = 0;
            let scrollThreshold = 3; // æ»šåŠ¨é˜ˆå€¼ï¼Œé¿å…å¾®å°æ»šåŠ¨è§¦å‘
            
            function handleHeaderScroll() {
                if (!header) return;
                
                const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // è®¡ç®—æ»šåŠ¨è·ç¦»
                const scrollDifference = currentScrollTop - lastScrollTop;
                
                // å‘ä¸‹æ»šåŠ¨éšè—
                if (scrollDifference > scrollThreshold && currentScrollTop > 30) {
                    header.classList.add('hidden');
                }
                // å‘ä¸Šæ»šåŠ¨æ˜¾ç¤º
                else if (scrollDifference < -scrollThreshold) {
                    header.classList.remove('hidden');
                }
                // åœ¨é¡µé¢é¡¶éƒ¨æ—¶æ˜¾ç¤º
                else if (currentScrollTop <= 30) {
                    header.classList.remove('hidden');
                }
                
                lastScrollTop = currentScrollTop;
            }
            
            // ç›‘å¬æ»šåŠ¨äº‹ä»¶
            window.addEventListener('scroll', handleHeaderScroll, { passive: true });
            
            // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå¤´éƒ¨å†…å®¹
            if (header) {
                header.classList.remove('hidden');
            }
            
            // ç›®å½•åˆ‡æ¢æŒ‰é’®åŠŸèƒ½ï¼ˆä»…åœ¨æ–‡ç« é¡µé¢ï¼‰
            const tocToggleBtn = document.getElementById('tocToggleBtn');
            if (tocToggleBtn) {
                const postToc = document.getElementById('postToc');
                
                // ä»localStorageè·å–ç›®å½•çŠ¶æ€
                const tocHidden = localStorage.getItem('tocHidden') === 'true';
                if (tocHidden && postToc) {
                    postToc.classList.add('hidden');
                    tocToggleBtn.classList.add('hidden');
                }
                
                // ç‚¹å‡»åˆ‡æ¢ç›®å½•æ˜¾ç¤º/éšè—
                tocToggleBtn.addEventListener('click', function() {
                    if (postToc) {
                        const isHidden = postToc.classList.contains('hidden');
                        if (isHidden) {
                            postToc.classList.remove('hidden');
                            this.classList.remove('hidden');
                            localStorage.setItem('tocHidden', 'false');
                        } else {
                            postToc.classList.add('hidden');
                            this.classList.add('hidden');
                            localStorage.setItem('tocHidden', 'true');
                        }
                    }
                });
            }
        });
        </script>
    
</body></html>