<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport">
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹ - å­è§„å…¥æ¢§æ¡</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½ å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚ ç±»åŠ è½½å™¨JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰ æ‹“å±•ç±»åŠ è½½å™¨ï¼šExtension">
<meta property="og:type" content="article">
<meta property="og:title" content="ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹">
<meta property="og:url" content="https://www.lazydaily.cn/761386768996885/index.html">
<meta property="og:site_name" content="å­è§„å…¥æ¢§æ¡">
<meta property="og:description" content="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½ å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚ ç±»åŠ è½½å™¨JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰ æ‹“å±•ç±»åŠ è½½å™¨ï¼šExtension">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901134621820.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901135402519.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901160002516.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/20200901160256824.png">
<meta property="article:published_time" content="2024-08-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-20T07:21:30.943Z">
<meta property="article:author" content="z1gui">
<meta property="article:tag" content="java">
<meta property="article:tag" content="ç±»åŠ è½½å™¨">
<meta property="article:tag" content="åŒäº²å§”æ´¾æ¨¡å‹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lazydaily.cn/img/20200901134621820.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://www.lazydaily.cn/761386768996885/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.png">
  
  <!-- Google Fonts é¢„åŠ è½½ - ä¼˜åŒ–å­—ä½“åŠ è½½ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  
  <!-- é¢„åŠ è½½æ‰€æœ‰å­—ä½“ -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  
  <!-- å­—ä½“åŠ è½½ä¼˜åŒ–è„šæœ¬ -->
  <script>
    // å­—ä½“åŠ è½½ä¼˜åŒ–
    (function() {
      // æ£€æŸ¥æ˜¯å¦æ”¯æŒFont Loading API
      if ('fonts' in document) {
        // å¼‚æ­¥åŠ è½½å­—ä½“ï¼Œä¸é˜»å¡é¡µé¢æ¸²æŸ“
        setTimeout(function() {
          Promise.all([
            document.fonts.load('400 1em "JetBrains Mono"'),
            document.fonts.load('400 1em "Noto Serif"'),
            document.fonts.load('400 1em "Noto Serif SC"')
          ]).then(function() {
            document.documentElement.classList.add('fonts-loaded');
          }).catch(function() {
            document.documentElement.classList.add('fonts-fallback');
          });
        }, 0);
      } else {
        // ä¸æ”¯æŒFont Loading APIçš„æµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨ç³»ç»Ÿå­—ä½“
        document.documentElement.classList.add('fonts-fallback');
      }
    })();
  </script>
  
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

  
<link rel="stylesheet" href="/css/a11y-dark.min.css">

  
  <!-- å›¾ç‰‡æ‡’åŠ è½½ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // é¢„åŠ è½½é˜Ÿåˆ—
      const preloadQueue = [];
      let isProcessing = false;
      let processedImages = new Set();
      
      // åˆ›å»ºloadingæ•ˆæœ
      function createLoadingEffect(img) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å®¹å™¨
        let container = img.parentElement;
        if (!container || !container.classList.contains('image-container')) {
          // åˆ›å»ºå›¾ç‰‡å®¹å™¨
          container = document.createElement('div');
          container.className = 'image-container loading';
          
          // å°†å›¾ç‰‡åŒ…è£…åœ¨å®¹å™¨ä¸­
          img.parentNode.insertBefore(container, img);
          container.appendChild(img);
        } else {
          // å¦‚æœå·²æœ‰å®¹å™¨ï¼Œæ·»åŠ loadingç±»
          container.classList.add('loading');
        }
        
        return container;
      }
      
      // ç§»é™¤loadingæ•ˆæœ
      function removeLoadingEffect(container) {
        if (container && container.classList.contains('loading')) {
          container.classList.remove('loading');
        }
      }
      
      // å¤„ç†é¢„åŠ è½½é˜Ÿåˆ—
      function processPreloadQueue() {
        if (isProcessing || preloadQueue.length === 0) return;
        
        isProcessing = true;
        const img = preloadQueue.shift();
        
        if (img && img.dataset.src && !processedImages.has(img)) {
          processedImages.add(img);
          
          // æ·»åŠ loadingæ•ˆæœ
          const container = createLoadingEffect(img);
          
          img.src = img.dataset.src;
          
          img.addEventListener('load', function() {
            img.classList.add('loaded');
            removeLoadingEffect(container);
            isProcessing = false;
            // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
            setTimeout(processPreloadQueue, 10);
          });
          
          img.addEventListener('error', function() {
            removeLoadingEffect(container);
            isProcessing = false;
            // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
            setTimeout(processPreloadQueue, 10);
          });
        } else {
          isProcessing = false;
          // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
          setTimeout(processPreloadQueue, 10);
        }
      }
      
      // å¤„ç†æ‰€æœ‰å›¾ç‰‡
      function handleImages() {
        // é€‰æ‹©æ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡ï¼Œä½†æ’é™¤favicon
        const lazyImages = document.querySelectorAll('.lazy-image');
        const allImages = document.querySelectorAll('img');
        

        
        // å¦‚æœæ²¡æœ‰æ‡’åŠ è½½å›¾ç‰‡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„å›¾ç‰‡
        if (lazyImages.length === 0) {
          allImages.forEach(img => {
            // æ’é™¤favicon.png
            if (img.src && !img.src.includes('favicon.png') && !img.src.includes('github.png') && !img.src.includes('mail.png') && !img.src.includes('rss-fill.png') && !img.src.includes('Telegram.png') &&
                img.dataset.src && !img.classList.contains('lazy-image')) {
              // å¦‚æœæœ‰data-srcå±æ€§ï¼Œè¯´æ˜æ˜¯æ‡’åŠ è½½å›¾ç‰‡
              img.classList.add('lazy-image');
              
              // æ·»åŠ loadingæ•ˆæœ
              const container = createLoadingEffect(img);
              
              // ç«‹å³åŠ è½½å›¾ç‰‡
              img.src = img.dataset.src;
              
              // å›¾ç‰‡åŠ è½½å®Œæˆåçš„å¤„ç†
              img.addEventListener('load', function() {
                img.classList.add('loaded');
                removeLoadingEffect(container);
              });
              
              img.addEventListener('error', function() {
                removeLoadingEffect(container);
              });
            }
          });
          return;
        }
        
        // ä½¿ç”¨Intersection Observerå¤„ç†æ‡’åŠ è½½å›¾ç‰‡
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              
              // æ£€æŸ¥æ˜¯å¦æœ‰data-srcå±æ€§
              if (img.dataset.src && !processedImages.has(img)) {
                // å°†å›¾ç‰‡æ·»åŠ åˆ°é¢„åŠ è½½é˜Ÿåˆ—
                preloadQueue.push(img);
                processPreloadQueue();
              } else if (!img.dataset.src) {
                // å¦‚æœæ²¡æœ‰data-srcï¼Œç›´æ¥æ˜¾ç¤ºå›¾ç‰‡
                img.classList.add('loaded');
              }
              
              // åœæ­¢è§‚å¯Ÿè¿™ä¸ªå›¾ç‰‡
              observer.unobserve(img);
            }
          });
        }, {
          rootMargin: '400px 0px', // æå‰400pxå¼€å§‹åŠ è½½ï¼Œå¤§å¹…æå‡åŠ è½½é€Ÿåº¦
          threshold: 0.001 // é™ä½é˜ˆå€¼ï¼Œå›¾ç‰‡åˆšè¿›å…¥è§†å£å°±å¼€å§‹åŠ è½½
        });
        
        // å¼€å§‹è§‚å¯Ÿæ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡
        lazyImages.forEach(img => {
          // æ’é™¤favicon.png
          if (!img.src.includes('favicon.png') && !img.src.includes('github.png') && !img.src.includes('mail.png') && !img.src.includes('rss-fill.png') && !img.src.includes('Telegram.png')) {
            imageObserver.observe(img);
          }
        });
      }
      
      // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      handleImages();
      
      // å‡å°‘å»¶è¿Ÿæ—¶é—´ï¼Œæå‡å“åº”é€Ÿåº¦
      setTimeout(handleImages, 20);
    });
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="å­è§„å…¥æ¢§æ¡" type="application/atom+xml">
</head>

    <body class="is-post">
        <!-- ä¾§è¾¹æç¤ºæ¡ -->
        
        <div class="header-hint" id="headerHint"></div>
        
        
        <div class="paper">
            <div class="paper-main">
                <div class="header">
    <div class="header-nav-buttons">
        
            
            <a href="/" class="header-nav-btn " title="ä¸»é¡µ">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            </a>
        
            
            <a href="/archives" class="header-nav-btn " title="å½’æ¡£">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 16V8C20.9996 7.64927 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64927 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            </a>
        
            
            <a href="/about" class="header-nav-btn " title="å…³äº">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            </a>
        
            
            <a href="/use" class="header-nav-btn " title="è®¾å¤‡">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="3" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M8 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 17V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            </a>
        
            
            <a href="https://uhufoundme.sol.build/" class="header-nav-btn " title="ç¢ç¢å¿µ" target="&quot;_blank&quot;" rel="&quot;noopener" noreferrer&#34;="">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9 7H7V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7 17V15H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M17 7H15V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15 17H17V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            </a>
        
    </div>
</div>

                <div class="post-main">
    <!-- é˜…è¯»è¿›åº¦æ¡ -->
    <div class="reading-progress-bar" id="readingProgressBar"></div>
    
    
        <div class="post-main-title">
            ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹
        </div>
        <div class="post-meta">
            <div class="post-meta-left">
                2024å¹´09æœˆ01æ—¥ ï½œ 
                
                    <a href="/tags/java/" class="tag-link"># java</a>
                
                    <a href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/" class="tag-link"># ç±»åŠ è½½å™¨</a>
                
                    <a href="/tags/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B/" class="tag-link"># åŒäº²å§”æ´¾æ¨¡å‹</a>
                
            </div>
            <div class="post-meta-right">
                <span class="post-stats-minimal" id="postStats">
                    <span class="stat-value-minimal" id="wordCount" title="å­—æ•°ç»Ÿè®¡">-</span>
                    <span class="stat-separator-minimal">Â·</span>
                    <span class="stat-value-minimal" id="readingTime" title="é¢„è®¡é˜…è¯»æ—¶é•¿">-</span>
                </span>
            </div>
        </div>

        <div class="post-content-wrapper">
            <div class="post-content-main">
                <div class="post-md">
                    <h3 id="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰"><a href="#ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰" class="headerlink" title="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰"></a>ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ7ä¸ªé˜¶æ®µï¼‰</h3><p><strong>åŠ è½½-éªŒè¯-å‡†å¤‡-è§£æ-åˆå§‹åŒ–-ä½¿ç”¨-å¸è½½</strong></p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="ä¸€ä¸ªç±»çš„ç”Ÿå‘½å‘¨æœŸ" data-src="/img/20200901134621820.webp" loading="lazy" class="lazy-image"></div><br>å…¶ä¸­ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯ååˆ†é‡è¦çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ï¼Œæ˜¯ç”±JVMæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚</p>
<h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a><strong>ç±»åŠ è½½å™¨</strong></h3><p>JVMæä¾›ä¸‰å±‚ç±»åŠ è½½å™¨</p>
<p><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ï¼šBootstrap Class Loader ï¼Œæ˜¯C++å†™çš„ï¼Œè¿”å›ä¸ºNULLï¼ˆæ¯”å¦‚Stringç±»ï¼‰ï¼Œlib/ä¸‹çš„jaråŒ…ï¼Œæ¯”å¦‚rt.jar,jce.jarç­‰</p>
<p><strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>ï¼šExtension Class Loaderï¼Œjre/lib/extä¸‹çš„jaræˆ–è€…æ˜¯æŒ‡å®šçš„jar</p>
<p><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</strong>ï¼šApplication  Class Loaderï¼ŒåŠ è½½calsspathæŒ‡å®šå†…å®¹</p>
<p>å½“ç„¶è‡ªå·±ä¹Ÿå¯ä»¥å®šä¹‰åŠ è½½å™¨ï¼Œä¸ç®—å…¥JVMä¸­çš„ï¼Œ<strong>è‡ªå®šä¹‰åŠ è½½å™¨</strong>ï¼šCustom ClassLoaderï¼Œè‡ªå®šä¹‰åŠ è½½å™¨ï¼Œæ”¯æŒä¸€äº›ä¸ªæ€§åŒ–çš„æ‰©å±•åŠŸèƒ½</p>
<pre><code class="language-text">Xbootclasspath
è®¾ç½®å¯åŠ¨ç±»åŠ è½½å™¨çš„è·¯å¾„
</code></pre>
<h3 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a><strong>åŒäº²å§”æ´¾æ¨¡å‹</strong></h3><p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="åŒäº²å§”æ´¾æ¨¡å‹" data-src="/img/20200901135402519.webp" loading="lazy" class="lazy-image"></div><br>æ¯ä¸€å±‚çš„ç±»åŠ è½½å™¨éƒ½æœ‰ä¸Šå±‚çš„åŠ è½½å™¨ï¼Œç§°ä¸ºçˆ¶ç±»åŠ è½½å™¨ï¼ŒBootstrapåŠ è½½å™¨æœ€ä¸Šå±‚çš„ç±»åŠ è½½å™¨ï¼Œä¸»è¦åŠ è½½ä¸€äº›é‡è¦çš„ç±»ï¼Œå¦‚Objectç±»ï¼ŒStringç±»ç­‰ã€‚å½“ç±»éœ€è¦åŠ è½½çš„æ—¶å€™å­ç±»åŠ è½½å™¨ä¼šä¾æ¬¡å‘ä¸Šå§”æ‰˜çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå¹¶å‘ä¸Šè¯¢é—®æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœçˆ¶ç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œåˆ™å‘ä¸‹å°è¯•å­ç±»åŠ è½½å™¨æ˜¯å¦å¯åŠ è½½ï¼Œç›´åˆ°è¯¥ç±»è¢«åŠ è½½ï¼Œè¿‡ç¨‹ç»“æŸã€‚è¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å‹æœºåˆ¶ã€‚</p>
<p>æ€»ç»“ï¼š<strong>å‘ä¸Šå§”æ‰˜å¹¶è¯¢é—®ï¼Œå‘ä¸‹å°è¯•åŠ è½½</strong></p>
<p>ä¼˜åŠ¿ï¼š<strong>ç¨³å®š</strong>ï¼Œå½“è‡ªå·±é‡å†™äº†ä¸ªåŸºç¡€ç±»ï¼ˆObjectç±»ï¼ŒStringç±»ç­‰ï¼‰è¿›è¡ŒåŠ è½½çš„æ—¶å€™ï¼Œå­ç±»åŠ è½½å™¨ä¾æ¬¡å‘ä¸Šå§”æ‰˜åŸºç¡€ç±»ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ°äº†Bootstrapç±»åŠ è½½å™¨å‘ç°rt.jarä¸­æœ‰ï¼Œç„¶åå°±ç›´æ¥åŠ è½½ï¼Œè¿”å›åŠ è½½æˆåŠŸã€‚è¿™æ ·ä¿è¯äº†JVMè¿è¡Œçš„å®‰å…¨ç¨³å®šã€‚</p>
<p><strong>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨ Java è™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚</strong></p>
<h4 id="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹"><a href="#æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹"></a><strong>æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„ç¤ºä¾‹</strong></h4><p>è™½ç„¶åŒäº²å§”æ´¾æ¨¡å‹èƒ½å¤Ÿä¿è¯JVMç¨³å®šè¿è¡Œï¼Œä½†æœ‰äº›æ—¶å€™æ ¹æ®åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰“ç ´è¿™ç§æœºåˆ¶ã€‚</p>
<h5 id="1-Tomcaç±»åŠ è½½æœºåˆ¶"><a href="#1-Tomcaç±»åŠ è½½æœºåˆ¶" class="headerlink" title="1.Tomcaç±»åŠ è½½æœºåˆ¶"></a>1.Tomcaç±»åŠ è½½æœºåˆ¶</h5><p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="TomcatåŠ è½½æœºåˆ¶" data-src="/img/20200901160002516.webp" loading="lazy" class="lazy-image"></div></p>
<p>Tomcatä¸­è‡ªå®šä¹‰çš„CommonåŠ è½½å™¨ï¼šCatalinaç±»+Sharedç±»åŠ è½½å™¨</p>
<p>tomcaté€šè¿‡waråŒ…è¿›è¡Œçš„åº”ç”¨å‘å¸ƒï¼Œå…¶å®æ—¶è¿åäº†åŒäº²å§”æ´¾æœºåˆ¶åŸåˆ™ã€‚å› ä¸ºä¸åŒçš„é¡¹ç›®å¯èƒ½ç”¨åˆ°ä¸åŒç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹ï¼Œå³éœ€è¦ä¸åŒwebAppç±»åŠ è½½å™¨åŠ è½½ä¸åŒç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹ï¼Œéœ€è¦éš”ç¦»ï¼Œæ‰€ä»¥è¦ç ´ååŒäº²å§”æ´¾æ¨¡å‹ã€‚</p>
<p><strong>tomcatçš„è®¾è®¡å¦‚ä½•ç ´åäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ</strong></p>
<p>tomcatä¸­å­˜åœ¨ä¸‰ç§ç±»åŠ è½½å™¨ï¼ŒCommonåŠ è½½å™¨ï¼šCatalinaç±»+Sharedç±»åŠ è½½å™¨ï¼Œåœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p>
<p>1.é¦–å…ˆåˆ¤æ–­è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½äº†ï¼Œå¦‚æœè¢«åŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>2.å°è¯•é€šè¿‡Appcalition ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œä¸»è¦æ˜¯é¿å…ä¸€äº›åŸºç¡€ç±»ï¼ˆObjectï¼ŒStringç±»ï¼‰è¢«webä¸­çš„ç±»è¦†ç›–ï¼Œå¯¼è‡´ä¸å®‰å…¨ï¼Œå¦‚æœåŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>3.å¦‚æœå‰ä¸¤æ­¥éƒ½æ²¡æœ‰åŠ è½½åˆ°ç±»ï¼Œå°±å¯ç”¨webAppç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœè¢«åŠ è½½äº†å°±è¿”å›ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ï¼›</p>
<p>4.æœ€åè¿˜æ²¡æœ‰åŠ è½½çš„è¯ï¼Œå°±å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨Common ClassLoaderè¿›è¡ŒåŠ è½½ã€‚</p>
<p><strong>ä½†æ˜¯ä½ è‡ªå·±å†™ä¸€ä¸ª ArrayListæˆ–è€…HashMapæ—¶å€™ï¼Œæ”¾åœ¨åº”ç”¨ç›®å½•é‡Œï¼Œtomcat ä¾ç„¶ä¸ä¼šåŠ è½½ï¼ˆä¼šåœ¨ç¬¬äºŒæ­¥æ—¶é€šè¿‡Applicationç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼‰ã€‚Tomcaç±»åŠ è½½æœºåˆ¶åªæ˜¯è‡ªå®šä¹‰çš„åŠ è½½å™¨é¡ºåºä¸åŒï¼Œä½†å¯¹äºé¡¶å±‚æ¥è¯´ï¼Œè¿˜æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<h5 id="2-SPIï¼ˆService-Provider-Infrefaceï¼‰"><a href="#2-SPIï¼ˆService-Provider-Infrefaceï¼‰" class="headerlink" title="2.SPIï¼ˆService Provider Infrefaceï¼‰"></a>2.<strong>SPI</strong>ï¼ˆService Provider Infrefaceï¼‰</h5><p>Java ä¸­æœ‰ä¸€ä¸ª SPI æœºåˆ¶ï¼Œå…¨ç§°æ˜¯ Service Provider Interfaceï¼Œæ˜¯ Java æä¾›çš„ä¸€å¥—ç”¨æ¥è¢«ç¬¬ä¸‰æ–¹å®ç°æˆ–è€…æ‰©å±•çš„æœåŠ¡æä¾›æ¥å£ï¼Œè®¾è®¡æ¨¡å¼ï¼šåŸºäºæ¥å£çš„ç¼–ç¨‹ï¼Œæ˜¯æ¥å£+å®ç°ç±»+é…ç½®æ–‡ä»¶</p>
<p>å…¶ä¸­æœ€æœ‰ä»£è¡¨æ€§çš„ï¼Œ<strong>JDBCï¼Œæ•°æ®åº“è¿æ¥</strong></p>
<p><strong>å¦‚ä½•ç ´ç¯åŒäº²å§”æ´¾ï¼Ÿ</strong></p>
<p>åŸæœ¬åº”è¯¥æ˜¯é€šè¿‡BootStrap ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œæ²¡æœ‰ä»£ç è¿›è¡Œå®ç°åŠ è½½ï¼Œåªèƒ½è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œå³æ•´ä¸ªwebçš„Application ClassLoderï¼Œæ‰€ä»¥æœ€åå…¶å®åœ¨ä½¿ç”¨çš„Applicationç±»åŠ è½½å™¨åŠ è½½</p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="SPI" data-src="/img/20200901160256824.webp" loading="lazy" class="lazy-image"></div><br>æºç åˆ†æ</p>
<pre><code class="language-java">public class Test{
//æˆ‘ä»¬åœ¨JDBCè¿æ¥æ•°æ®åº“çš„æ—¶å€™å¾€å¾€é€šè¿‡ä¸€è¡Œä»£ç å°±èƒ½å®ç°
//Class.forName("xx");å¯ä»¥ä¸ç”¨å†™

    Connection conn= DriverManager.getConnection(url, user, password);
//å½“getConnectionè¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒDriverManagerä¸­æœ‰ä¸ªstaticé™æ€ä»£ç å—è¿›è¡Œæ‰§è¡Œ
    /**
     * Load the initial JDBC drivers by checking the System property
     * jdbc.properties and then use the {@code ServiceLoader} mechanism
     */
    static {
        loadInitialDrivers();
        println("JDBC DriverManager initialized");
    }
    //é™æ€ä»£ç å—æ‰§è¡Œçš„æ–¹æ³•loadInitialDrivers()
    private static void loadInitialDrivers() {
        String drivers;
        try {
            drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {
                public String run() {
                    return System.getProperty("jdbc.drivers");
                }
            });
        } catch (Exception ex) {
            drivers = null;
        }
        // If the driver is packaged as a Service Provider, load it.
        // Get all the drivers through the classloader
        // exposed as a java.sql.Driver.class service.
        // ServiceLoader.load() replaces the sun.misc.Providers()

        AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
            public Void run() {
                //æ³¨æ„è¿™é‡Œï¼ï¼ï¼åŠ è½½Driver.classä»£ç 
                ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);
                Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();

                /* Load these drivers, so that they can be instantiated.
                 * It may be the case that the driver class may not be there
                 * i.e. there may be a packaged driver with the service class
                 * as implementation of java.sql.Driver but the actual class
                 * may be missing. In that case a java.util.ServiceConfigurationError
                 * will be thrown at runtime by the VM trying to locate
                 * and load the service.
                 *
                 * Adding a try catch block to catch those runtime errors
                 * if driver not available in classpath but it's
                 * packaged as service and that service is there in classpath.
                 */
                try{
                    while(driversIterator.hasNext()) {
                        driversIterator.next();
                    }
                } catch(Throwable t) {
                    // Do nothing
                }
                return null;
            }
        });

        println("DriverManager.initialize: jdbc.drivers = " + drivers);

        if (drivers == null || drivers.equals("")) {
            return;
        }
        String[] driversList = drivers.split(":");
        println("number of Drivers:" + driversList.length);
        for (String aDriver : driversList) {
            try {
                println("DriverManager.Initialize: loading " + aDriver);
                Class.forName(aDriver, true,
                        ClassLoader.getSystemClassLoader());
            } catch (Exception ex) {
                println("DriverManager.Initialize: load failed: " + ex);
            }
        }
    }
    //è¿›å…¥åˆ°ServiceLoaderä¹‹åçš„ä»£ç 
//èƒ½å‘ç°ï¼Œè¿™ä¸ªåŠ è½½æ—¶æ˜¯è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè€Œè¿™ä¸ªåŠ è½½å™¨ä¸æ˜¯JVMä¸­BootStrapç±»åŠ è½½å™¨ï¼Œè€Œæ˜¯å‚å•†æä¾›çš„ï¼Œæ‰€ä»¥åŠ è½½çš„æ—¶å€™ä¸æ˜¯åœ¨BootStrapç±»åŠ è½½å™¨åŠ è½½ï¼Œåœ¨æ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹~
    public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) {
        ClassLoader cl = Thread.currentThread().getContextClassLoader();
        return ServiceLoader.load(service, cl);
    }
}

</code></pre>
<p>æ€»ç»“ï¼šé€šè¿‡æºç ä¸éš¾çœ‹å‡ºï¼ŒClass.forName(â€œxxâ€);èƒ½å†™ä¸”ä¸æŠ¥é”™ï¼Œè¯´æ˜åœ¨JVMé‡Œé¢æœ‰è¿™ä¸ªDriveç±»çš„åŠ è½½ä»£ç ï¼Œä½†æ˜¯åªæœ‰æ¥å£ï¼Œæ²¡æœ‰å®ç°ï¼Œå…·ä½“å®ç°æ˜¯å‚å•†æä¾›çš„ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸éµå¾ªåŒäº²å§”æ´¾æœºåˆ¶ã€‚</p>
<blockquote>
<p>å¯¹SPIæƒ³å¤šç‚¹äº†è§£ï¼Œå¯å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNDY0MTg2MA==&amp;mid=2247483935&amp;idx=1&amp;sn=e6da46cfe2df2812fd2b9e24253ec246&amp;chksm=97a53fb4a0d2b6a2896b5c0850e83a7852ad08fbe0939bb61d04982bc0d03d3f6da25ee56dbf&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzIxNDY0MTg2MA==&amp;mid=2247483935&amp;idx=1&amp;sn=e6da46cfe2df2812fd2b9e24253ec246&amp;chksm=97a53fb4a0d2b6a2896b5c0850e83a7852ad08fbe0939bb61d04982bc0d03d3f6da25ee56dbf&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<h5 id="3-OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰-å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚"><a href="#3-OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰-å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚" class="headerlink" title="3.OSGiâ€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰  å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚"></a>3.<strong>OSGi</strong>â€”â€”æ¨¡å—åŒ–ï¼ˆå¾®æœåŠ¡ï¼‰  å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½ã€‚</h5><p>åŸç†ï¼šä½¿ç±»ç›¸äº’ä¹‹é—´ä¸å¯è§ï¼Œç›¸å½“éœ¸é“ï¼ï¼ˆåç»­è¡¥å……ï¼‰</p>

                </div>
            </div>
            <div class="post-content-sidebar">
                
                <div class="post-toc" id="postToc">
                    <div class="toc-header">
                        <div class="toc-title">ç›®å½•</div>
                    </div>
                    <div class="toc-content"></div>
                </div>
            </div>
        </div>
    

<!-- åªåœ¨æ–‡ç« é¡µé¢æ˜¾ç¤ºåˆ†ç±»å’Œå¯¼èˆª -->

    <!-- åˆ†ç±»ä¿¡æ¯å’Œåˆ†äº«æŒ‰é’® -->
    
        <div class="post-categories-with-share">
            <div class="post-categories">
                åˆ†ç±»ï¼š
                
                    <a href="/categories/%E5%90%8E%E7%AB%AF/"> / åç«¯</a>
                
            </div>
            <div class="post-action-buttons">
                <button class="comment-toggle-btn" id="commentToggleBtn" title="æ˜¾ç¤º/éšè—è¯„è®º">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <button class="share-icon-btn" id="shareBtn" title="ç‚¹å‡»åˆ†äº«è¿™ç¯‡æ–‡ç« ">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                
            </div>
        </div>
    

   

    <!-- è¯„è®ºæŠ½å±‰å®¹å™¨ï¼ˆæŠ½å±‰åŠ¨ç”»åŒºåŸŸï¼‰ -->
    <div id="commentsDrawer" class="comments-drawer" aria-hidden="true">
        <!-- è¯„è®ºåŒºåŸŸ -->
        <div class="comments-section" id="commentsSection">
            
<div class="giscus-container">
    <script src="https://giscus.app/client.js" data-repo="z1gui/blog" data-repo-id="R_kgDOOezL6g" data-category="Announcements" data-category-id="DIC_kwDOOezL6s4CvusN" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="noborder_gray" data-lang="zh-CN" crossorigin="anonymous" async="">
    </script>
</div>


        </div>
    </div>

    <!-- ä¸‹ä¸€ç¯‡æ¨è -->
    
    <div class="next-post-recommendation">
        <div class="next-post-label">æ¥ä¸‹æ¥é˜…è¯»</div>
        <div class="next-post-content">
            <a href="/761386768996512/" class="next-post-title">javascriptä¸­ constï¼Œvarï¼Œletçš„åŒºåˆ«</a>
            <a href="/761386768996512/" class="next-post-excerpt">
                
                varã€constã€let åŒæ ·éƒ½æ˜¯å£°æ˜å˜é‡çš„å…³é”®è¯ã€‚ ä¸€ã€var å’Œ let åŒºåˆ«ä½œç”¨åŸŸvar çš„ä½œç”¨åŸŸåªèƒ½æ˜¯å…¨å±€æˆ–è€…æ˜¯æ•´ä¸ªå‡½æ•°å—ï¼Œè€Œ let çš„ä½œç”¨åŸŸæ—¢å¯ä»¥æ˜¯å…¨å±€å˜é‡æˆ–è€…æ˜¯æ•´ä¸ªå‡½æ•°ï¼Œè¿˜å¯ä»¥æ˜¯ if, while, switch é™å®šçš„ä»£ç å—ã€‚ function varTest &amp;123; 	 	var a = 1;   	&amp;123;     		var a = 2; // å‡½æ•°å—ä¸­ï¼ŒåŒä¸€ä¸ªå˜é‡  		console.loga; // 2   	&amp;125;   	 console.loga; // 2 &amp;125;  function letTest &amp;123;   	 let a = 1; ...
            </a>
        </div>
    </div>
    


</div>

<!-- å›¾ç‰‡å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="image-modal" id="imageModal">
    <img id="modalImage" src="" alt="å…¨å±å›¾ç‰‡">
</div>

<!-- åˆ†äº«æˆåŠŸå¼¹å‡ºé€šçŸ¥ -->
<div class="share-notification" id="shareNotification">
    <div class="share-notification-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
    </div>
</div>

<!-- ä»£ç å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="code-modal" id="codeModal">
    <div class="code-modal-content">
        <div class="code-modal-header">
            <div class="code-modal-title">ä»£ç æŸ¥çœ‹</div>
            <div class="code-modal-close" id="codeModalClose">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
        </div>
        <div class="code-modal-code">
            <pre><code id="modalCode"></code></pre>
        </div>
    </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const postImages = document.querySelectorAll('.post-md img');

    // ä¸ºå›¾ç‰‡æ·»åŠ è¯´æ˜æ–‡å­—ï¼ˆä¼˜å…ˆ data-captionï¼Œå…¶æ¬¡ altï¼Œæœ€å titleï¼‰
    // åªåœ¨æ–‡ç« é¡µé¢æ˜¾ç¤ºå›¾ç‰‡æ ‡æ³¨ï¼Œè®¾å¤‡é¡µé¢ä¸æ˜¾ç¤º
    if (document.body.classList.contains('is-post')) {
    postImages.forEach(img => {
        // è·³è¿‡ç¤¾äº¤é“¾æ¥ä¸­çš„å›¾æ ‡
        const isSocialIcon = img.closest('.social-links') !== null;
        if (isSocialIcon) return;

        // å·²æœ‰è¯´æ˜åˆ™ä¸é‡å¤æ·»åŠ ï¼ˆæ£€æµ‹ç´§é‚»çš„è¯´æ˜èŠ‚ç‚¹ï¼‰
        const container = img.closest('.image-container');
        const link = img.closest('a');
        const injector = link || container || img;
        const nextEl = injector.nextElementSibling;
        if (nextEl && nextEl.classList && nextEl.classList.contains('image-caption')) return;

        const captionText = (img.getAttribute('data-caption') || img.getAttribute('alt') || img.getAttribute('title') || '').trim();
        if (!captionText) return;

        const captionEl = document.createElement('div');
        captionEl.className = 'image-caption';
        captionEl.textContent = captionText;

        injector.insertAdjacentElement('afterend', captionEl);
    });
    }

    // ç‚¹å‡»å›¾ç‰‡æ‰“å¼€æ¨¡æ€æ¡†
    postImages.forEach(img => {
        // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦åœ¨ç¤¾äº¤é“¾æ¥ä¸­
        const isSocialIcon = img.closest('.social-links') !== null;
        if (!isSocialIcon) {
            img.addEventListener('click', function() {
                modal.classList.add('active');
                
                // è·å–åŸå§‹å›¾ç‰‡è·¯å¾„ï¼ˆå°†WebPè½¬æ¢å›åŸå§‹æ ¼å¼ï¼‰
                let originalSrc = this.src || this.dataset.src;
                
                // å¦‚æœæ˜¯WebPæ ¼å¼ï¼Œè½¬æ¢ä¸ºåŸå§‹æ ¼å¼
                if (originalSrc && originalSrc.includes('.webp')) {
                    // å°è¯•å¤šç§åŸå§‹æ ¼å¼
                    const possibleFormats = ['.png', '.jpg', '.jpeg'];
                    let foundOriginal = false;
                    
                    for (let format of possibleFormats) {
                        const testSrc = originalSrc.replace('.webp', format);
                        // è¿™é‡Œå¯ä»¥æ·»åŠ é¢„æ£€æŸ¥é€»è¾‘ï¼Œä½†ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ç›´æ¥å°è¯•åŠ è½½
                        if (!foundOriginal) {
                            originalSrc = testSrc;
                            foundOriginal = true;
                        }
                    }
                    
                    // å¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œä½¿ç”¨é»˜è®¤çš„.jpgæ ¼å¼
                    if (!foundOriginal) {
                        originalSrc = originalSrc.replace('.webp', '.jpg');
                    }
                }
                
                modalImg.src = originalSrc;
                document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
                
                // æ·»åŠ åŠ è½½çŠ¶æ€
                modalImg.onload = function() {
                    console.log('åŸå§‹å›¾ç‰‡åŠ è½½å®Œæˆ:', originalSrc);
                };
                
                modalImg.onerror = function() {
                    console.log('åŸå§‹å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ ¼å¼');
                    // å°è¯•å…¶ä»–å¯èƒ½çš„åŸå§‹æ ¼å¼
                    const webpSrc = this.src || this.dataset.src;
                    if (webpSrc && webpSrc.includes('.webp')) {
                        const formats = ['.png', '.jpeg', '.jpg'];
                        let currentFormatIndex = 0;
                        
                        const tryNextFormat = () => {
                            if (currentFormatIndex < formats.length) {
                                const testSrc = webpSrc.replace('.webp', formats[currentFormatIndex]);
                                modalImg.src = testSrc;
                                currentFormatIndex++;
                            } else {
                                console.log('æ‰€æœ‰åŸå§‹æ ¼å¼éƒ½å¤±è´¥ï¼Œä½¿ç”¨WebPç‰ˆæœ¬');
                                modalImg.src = webpSrc;
                            }
                        };
                        
                        // é‡æ–°ç»‘å®šé”™è¯¯å¤„ç†
                        modalImg.onerror = tryNextFormat;
                        tryNextFormat();
                    } else {
                        modalImg.src = webpSrc;
                    }
                }.bind(this);
            });
        }
    });

    // ç‚¹å‡»æ¨¡æ€æ¡†å…³é—­
    modal.addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
    });

    // æŒ‰ ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    // é˜…è¯»è¿›åº¦æ¡åŠŸèƒ½
    const progressBar = document.getElementById('readingProgressBar');
    if (progressBar) {
        function updateReadingProgress() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            
            // é™åˆ¶è¿›åº¦æ¡å®½åº¦åœ¨0-100%ä¹‹é—´
            const progressWidth = Math.min(Math.max(scrollPercent, 0), 100);
            progressBar.style.width = progressWidth + '%';
        }

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', updateReadingProgress);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¿›åº¦æ¡
        updateReadingProgress();
    }

    



    // è¿”å›é¡¶éƒ¨åŠŸèƒ½
    const backToTopBtn = document.getElementById('backToTopBtn');
    if (backToTopBtn) {
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    // ä»£ç å—å…¨å±åŠŸèƒ½
    const codeModal = document.getElementById('codeModal');
    const modalCode = document.getElementById('modalCode');
    const codeModalClose = document.getElementById('codeModalClose');

    // ä¸ºæ‰€æœ‰ä»£ç å—æ·»åŠ å…¨å±æŒ‰é’®
    const codeBlocks = document.querySelectorAll('.post-md pre');
    codeBlocks.forEach(pre => {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰æŒ‰é’®ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
        if (!pre.querySelector('.code-fullscreen-btn')) {
            const fullscreenBtn = document.createElement('div');
            fullscreenBtn.className = 'code-fullscreen-btn';
            fullscreenBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H5C3.89543 3 3 3.89543 3 5V8M21 8V5C21 3.89543 20.1046 3 19 3H16M16 21H19C20.1046 21 21 20.1046 21 19V16M3 16V19C3 20.1046 3.89543 21 5 21H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            fullscreenBtn.title = 'å…¨å±æŸ¥çœ‹ä»£ç ';
            
            // ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå…¨å±ä»£ç 
            fullscreenBtn.addEventListener('click', function() {
                const codeElement = pre.querySelector('code');
                if (codeElement) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å·²ç»åº”ç”¨äº†è¡Œå·çš„ä»£ç å—
                    const hljsTable = pre.querySelector('table.hljs-ln');
                    
                    let codeContent;
                    let startLineNumber = 1;
                    
                    if (hljsTable) {
                        // å¦‚æœæœ‰è¡Œå·è¡¨æ ¼ï¼Œæå–çº¯ä»£ç å†…å®¹å’Œèµ·å§‹è¡Œå·
                        const codeLines = hljsTable.querySelectorAll('.hljs-ln-code');
                        codeContent = Array.from(codeLines).map(line => {
                            // æå–æ¯è¡Œçš„æ–‡æœ¬å†…å®¹ï¼Œä¿æŒåŸå§‹æ ¼å¼
                            return line.textContent || line.innerText || ' ';
                        }).join('\n');
                        
                        // è·å–èµ·å§‹è¡Œå·
                        const firstNumberCell = hljsTable.querySelector('.hljs-ln-numbers');
                        if (firstNumberCell) {
                            const lineAttr = firstNumberCell.getAttribute('data-line-number');
                            if (lineAttr) {
                                startLineNumber = parseInt(lineAttr) || 1;
                            }
                        }
                    } else {
                        // æ™®é€šä»£ç å—ï¼Œç›´æ¥è·å–æ–‡æœ¬å†…å®¹
                        codeContent = codeElement.textContent || codeElement.innerText;
                    }
                    
                    const codeLanguage = getCodeLanguage(codeElement);
                    
                    // è®¾ç½®æ¨¡æ€æ¡†ä¸­çš„ä»£ç å†…å®¹
                    modalCode.textContent = codeContent;
                    modalCode.className = codeElement.className; // ä¿æŒä»£ç é«˜äº®çš„ç±»å
                    
                    // å¦‚æœåŸä»£ç æœ‰è‡ªå®šä¹‰èµ·å§‹è¡Œå·ï¼Œè®¾ç½®dataå±æ€§
                    if (startLineNumber !== 1) {
                        modalCode.setAttribute('data-ln-start-from', startLineNumber);
                    } else {
                        modalCode.removeAttribute('data-ln-start-from');
                    }
                    
                    // æ›´æ–°æ ‡é¢˜
                    const modalTitle = document.querySelector('.code-modal-title');
                    if (codeLanguage) {
                        modalTitle.textContent = `ä»£ç æŸ¥çœ‹ - ${codeLanguage}`;
                    } else {
                        modalTitle.textContent = 'ä»£ç æŸ¥çœ‹';
                    }
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    codeModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    // é‡æ–°åº”ç”¨ä»£ç é«˜äº®å’Œè¡Œå·
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightElement(modalCode);
                        
                        // åº”ç”¨è¡Œå·
                        if (typeof hljs.lineNumbersBlock !== 'undefined') {
                            hljs.lineNumbersBlock(modalCode, {
                                startFrom: startLineNumber
                            });
                        }
                    }
                }
            });
            
            pre.appendChild(fullscreenBtn);
        }
    });

    // è·å–ä»£ç è¯­è¨€
    function getCodeLanguage(codeElement) {
        const className = codeElement.className;
        const languageMatch = className.match(/language-(\w+)|hljs-(\w+)|\b(\w+)$/);
        if (languageMatch) {
            return languageMatch[1] || languageMatch[2] || languageMatch[3];
        }
        return '';
    }

    // å…³é—­ä»£ç å…¨å±æ¨¡æ€æ¡†
    function closeCodeModal() {
        codeModal.classList.remove('active');
        document.body.style.overflow = '';
    }

    // ç‚¹å‡»å…³é—­æŒ‰é’®
    if (codeModalClose) {
        codeModalClose.addEventListener('click', closeCodeModal);
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­ï¼ˆç‚¹å‡»å†…å®¹åŒºåŸŸä¸å…³é—­ï¼‰
    codeModal.addEventListener('click', function(e) {
        if (e.target === codeModal) {
            closeCodeModal();
        }
    });

    // æŒ‰ ESC é”®å…³é—­ä»£ç æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (codeModal.classList.contains('active')) {
                closeCodeModal();
            }
        }
    });

    // åˆ†äº«åŠŸèƒ½
    const shareBtn = document.getElementById('shareBtn');
    if (shareBtn) {
        shareBtn.addEventListener('click', function() {
            // è·å–æ–‡ç« ä¿¡æ¯
            const title = document.querySelector('.post-main-title')?.textContent?.trim() || 'æœªçŸ¥æ ‡é¢˜';
            const date = document.querySelector('.post-meta')?.textContent?.match(/\d{4}-\d{2}-\d{2}/)?.[0] || '';
            const url = window.location.href;
            
            // è·å–æ–‡ç« å‰å‡ è¡Œå†…å®¹ï¼ˆæ’é™¤æ ‡é¢˜ã€å…ƒä¿¡æ¯ç­‰ï¼‰
            const postContent = document.querySelector('.post-md');
            let content = '';
            if (postContent) {
                // è·å–æ‰€æœ‰æ®µè½å’Œæ–‡æœ¬å†…å®¹
                const paragraphs = postContent.querySelectorAll('p, h1, h2, h3, h4, h5, h6');
                const contentArray = [];
                
                for (let i = 0; i < Math.min(paragraphs.length, 3); i++) {
                    const text = paragraphs[i].textContent?.trim();
                    if (text && text.length > 0) {
                        contentArray.push(text);
                    }
                }
                
                content = contentArray.join('\n\n');
                
                // å¦‚æœå†…å®¹å¤ªé•¿ï¼Œæˆªå–å‰100ä¸ªå­—ç¬¦
                if (content.length > 100) {
                    content = content.substring(0, 100) + '...';
                }
            }
            
            // æ„å»ºåˆ†äº«å†…å®¹
            let shareText = `æ–‡ç« æ ‡é¢˜ï¼š ${title}`;
            if (date) {
                shareText += `\nå‘å¸ƒæ—¶é—´ï¼š ${date}`;
            }
            if (content) {
                shareText += `\n\n${content}`;
            }
            shareText += `\n\nğŸ”— ${url}`;
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard && window.isSecureContext) {
                // ä½¿ç”¨ç°ä»£ Clipboard API
                navigator.clipboard.writeText(shareText).then(function() {
                    showShareSuccess();
                }).catch(function(err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(shareText);
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyTextToClipboard(shareText);
            }
        });
    }
    
    // æ˜¾ç¤ºåˆ†äº«æˆåŠŸæç¤º
    function showShareSuccess() {
        const notification = document.getElementById('shareNotification');
        if (notification) {
            notification.classList.add('show');
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(function() {
                notification.classList.remove('show');
            }, 3000);
        }
    }
    
    // é™çº§å¤åˆ¶æ–¹æ¡ˆ
    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showShareSuccess();
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
            }
        } catch (err) {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
        }
        
        document.body.removeChild(textArea);
    }
    
    // å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é•¿è®¡ç®—
    function calculatePostStats() {
        const postContent = document.querySelector('.post-md');
        if (!postContent) return;
        
        // è·å–çº¯æ–‡æœ¬å†…å®¹
        let textContent = postContent.textContent || postContent.innerText || '';
        
        // ç§»é™¤å¤šä½™çš„ç©ºç™½å­—ç¬¦
        textContent = textContent.replace(/\s+/g, ' ').trim();
        
        // è®¡ç®—ä¸­æ–‡å­—ç¬¦æ•°ï¼ˆåŒ…æ‹¬ä¸­æ–‡æ ‡ç‚¹ï¼‰
        const chineseChars = textContent.match(/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/g);
        const chineseCount = chineseChars ? chineseChars.length : 0;
        
        // è®¡ç®—è‹±æ–‡å•è¯æ•°
        const englishWords = textContent.match(/[a-zA-Z]+/g);
        const englishWordCount = englishWords ? englishWords.length : 0;
        
        // è®¡ç®—æ•°å­—
        const numbers = textContent.match(/\d+/g);
        const numberCount = numbers ? numbers.length : 0;
        
        // æ€»å­—æ•° = ä¸­æ–‡å­—ç¬¦æ•° + è‹±æ–‡å•è¯æ•° + æ•°å­—ä¸ªæ•°
        const totalWords = chineseCount + englishWordCount + numberCount;
        
        // æ›´æ–°å­—æ•°æ˜¾ç¤º
        const wordCountElement = document.getElementById('wordCount');
        if (wordCountElement) {
            wordCountElement.textContent = `${totalWords.toLocaleString()} å­—`;
            // æ›´æ–°titleå±æ€§æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            wordCountElement.title = `å­—æ•°ç»Ÿè®¡ï¼š${totalWords.toLocaleString()} å­—\nä¸­æ–‡å­—ç¬¦ï¼š${chineseCount}\nè‹±æ–‡å•è¯ï¼š${englishWordCount}\næ•°å­—ï¼š${numberCount}`;
        }
        
        // è®¡ç®—é˜…è¯»æ—¶é•¿ï¼ˆä¸­æ–‡æŒ‰300å­—/åˆ†é’Ÿï¼Œè‹±æ–‡æŒ‰200è¯/åˆ†é’Ÿè®¡ç®—ï¼‰
        const chineseReadingTime = Math.ceil(chineseCount / 300);
        const englishReadingTime = Math.ceil(englishWordCount / 200);
        const totalReadingTime = Math.max(chineseReadingTime, englishReadingTime, 1); // è‡³å°‘1åˆ†é’Ÿ
        
        // æ›´æ–°é˜…è¯»æ—¶é•¿æ˜¾ç¤º
        const readingTimeElement = document.getElementById('readingTime');
        if (readingTimeElement) {
            let displayText = '';
            if (totalReadingTime < 60) {
                displayText = `${totalReadingTime} åˆ†é’Ÿ`;
            } else {
                const hours = Math.floor(totalReadingTime / 60);
                const minutes = totalReadingTime % 60;
                if (minutes === 0) {
                    displayText = `${hours} å°æ—¶`;
                } else {
                    displayText = `${hours} å°æ—¶ ${minutes} åˆ†é’Ÿ`;
                }
            }
            readingTimeElement.textContent = displayText;
            // æ›´æ–°titleå±æ€§æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            readingTimeElement.title = `é¢„è®¡é˜…è¯»æ—¶é•¿ï¼š${displayText}\nåŸºäºä¸­æ–‡300å­—/åˆ†é’Ÿï¼Œè‹±æ–‡200è¯/åˆ†é’Ÿè®¡ç®—`;
        }
        
        // æ·»åŠ è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè¯•ï¼‰
        console.log('æ–‡ç« ç»Ÿè®¡:', {
            ä¸­æ–‡å­—ç¬¦: chineseCount,
            è‹±æ–‡å•è¯: englishWordCount,
            æ•°å­—ä¸ªæ•°: numberCount,
            æ€»å­—æ•°: totalWords,
            é¢„è®¡é˜…è¯»æ—¶é•¿: totalReadingTime + ' åˆ†é’Ÿ'
        });
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåè®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    calculatePostStats();
    
    // è¯„è®ºåŒºåŸŸæ˜¾ç¤º/éšè—åŠŸèƒ½ï¼ˆé¡¶éƒ¨æŒ‰é’®ä»å¯ç”¨ï¼‰
    const commentToggleBtn = document.getElementById('commentToggleBtn');
    const commentsSection = document.getElementById('commentsSection');
    const commentsDrawer = document.getElementById('commentsDrawer');
    const commentsToggleBar = document.getElementById('commentsToggleBar');
    
    function openComments() {
        if (commentsDrawer) {
            commentsDrawer.classList.add('open');
            commentsDrawer.setAttribute('aria-hidden', 'false');
        }
        if (commentsToggleBar) {
            commentsToggleBar.setAttribute('aria-expanded', 'true');
            commentsToggleBar.textContent = 'éšè—è¯„è®º';
        }
        if (commentToggleBtn) {
            commentToggleBtn.setAttribute('title', 'éšè—è¯„è®º');
            commentToggleBtn.style.background = 'var(--font-color-0, #ff4444)';
            commentToggleBtn.style.borderColor = 'var(--font-color-0, #ff4444)';
            commentToggleBtn.style.color = 'white';
        }
    }
    
    function closeComments() {
        if (commentsDrawer) {
            commentsDrawer.classList.remove('open');
            commentsDrawer.setAttribute('aria-hidden', 'true');
        }
        if (commentsToggleBar) {
            commentsToggleBar.setAttribute('aria-expanded', 'false');
            commentsToggleBar.textContent = 'æ˜¾ç¤ºè¯„è®º';
        }
        if (commentToggleBtn) {
            commentToggleBtn.setAttribute('title', 'æ˜¾ç¤ºè¯„è®º');
            commentToggleBtn.style.background = '';
            commentToggleBtn.style.borderColor = '';
            commentToggleBtn.style.color = '';
        }
    }

    if (commentsDrawer && commentsToggleBar) {
        closeComments(); // é»˜è®¤å…³é—­æŠ½å±‰
        commentsToggleBar.addEventListener('click', function() {
            if (commentsDrawer.classList.contains('open')) {
                closeComments();
            } else {
                openComments();
            }
        });
    }

    if (commentToggleBtn && commentsDrawer) {
        commentToggleBtn.addEventListener('click', function() {
            if (commentsDrawer.classList.contains('open')) {
                closeComments();
            } else {
                openComments();
            }
        });
    }
});
</script>

                
            </div>
        </div>

        <!-- JavaScript -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const html = document.documentElement;
            const header = document.querySelector('.header');
            const headerHint = document.getElementById('headerHint');
            
            // å¤§å±æ–‡ç« é¡µçš„headerè‡ªåŠ¨éšè—åŠŸèƒ½
            if (document.body.classList.contains('is-post') && window.innerWidth >= 1025) {
                let headerTimeout;
                
                // é¼ æ ‡æ‚¬åœåœ¨headerä¸Šæ—¶æ˜¾ç¤º
                if (header) {
                    header.addEventListener('mouseenter', function() {
                        clearTimeout(headerTimeout);
                        header.classList.add('show');
                        if (headerHint) {
                            headerHint.classList.add('header-visible');
                        }
                    });
                    
                    header.addEventListener('mouseleave', function() {
                        headerTimeout = setTimeout(function() {
                            header.classList.remove('show');
                            if (headerHint) {
                                headerHint.classList.remove('header-visible');
                            }
                        }, 300);
                    });
                }
                
                // é¼ æ ‡æ‚¬åœåœ¨æç¤ºæ¡ä¸Šæ—¶æ˜¾ç¤ºheader
                if (headerHint) {
                    headerHint.addEventListener('mouseenter', function() {
                        clearTimeout(headerTimeout);
                        if (header) {
                            header.classList.add('show');
                            headerHint.classList.add('header-visible');
                        }
                    });
                    
                    headerHint.addEventListener('mouseleave', function() {
                        headerTimeout = setTimeout(function() {
                            if (header) {
                                header.classList.remove('show');
                                headerHint.classList.remove('header-visible');
                            }
                        }, 300);
                    });
                }
            }
            
            // æ—§çš„ç‚¹å‡»åˆ‡æ¢é€»è¾‘ï¼ˆéå¤§å±æ–‡ç« é¡µä¿ç•™ï¼‰
            function handleHeaderClick() {
                if (!header) return;

                // åœ¨éæ–‡ç« é¡µæ—¶ä¸æ‰§è¡Œéšè—æ“ä½œ
                if (!document.body.classList.contains('is-post')) {
                    return;
                }
                
                // å¤§å±æ¨¡å¼ä¸‹ä¸ä½¿ç”¨ç‚¹å‡»åˆ‡æ¢
                if (window.innerWidth >= 1025) {
                    return;
                }

                // å°å±æ¨¡å¼ï¼šç‚¹å‡»å¤´éƒ¨æ—¶ï¼Œåˆ‡æ¢å¤´éƒ¨æ˜¾ç¤º/éšè—
                if (header.classList.contains('hidden')) {
                    header.classList.remove('hidden');
                } else {
                    header.classList.add('hidden');
                }
            }
            
            // ç›‘å¬äº‹ä»¶
            if(header){
                header.addEventListener('click', handleHeaderClick);
            }
            
            

            // è®¾å¤‡é¡µé¢ 3D è½®æ’­åˆå§‹åŒ–
            if (document.body.classList.contains('is-use')) {
                const container = document.querySelector('.paper-main');
                if (container) {
                    const deviceCards = Array.from(container.querySelectorAll('.device-card'));
                    if (deviceCards.length > 0) {
                        const carousel = document.createElement('div');
                        carousel.className = 'device-carousel';
                        const track = document.createElement('div');
                        track.className = 'device-carousel-track';

                        // å…ˆæŠŠè½®æ’­æ’å…¥åˆ°ç¬¬ä¸€ä¸ªå¡ç‰‡çš„çˆ¶çº§ä¸­ï¼Œä½äºé¦–ä¸ªå¡ç‰‡ä¹‹å‰
                        const firstCard = deviceCards[0];
                        const parentNode = firstCard.parentNode;
                        if (parentNode) {
                            parentNode.insertBefore(carousel, firstCard);
                        }

                        deviceCards.forEach((card) => {
                            const slide = document.createElement('div');
                            slide.className = 'device-slide';
                            slide.appendChild(card);
                            track.appendChild(slide);
                        });

                        const nav = document.createElement('div');
                        nav.className = 'device-carousel-nav';
                        const prevBtn = document.createElement('button');
                        prevBtn.className = 'device-carousel-btn device-prev';
                        prevBtn.setAttribute('aria-label', 'ä¸Šä¸€é¡¹');
                        prevBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                        const nextBtn = document.createElement('button');
                        nextBtn.className = 'device-carousel-btn device-next';
                        nextBtn.setAttribute('aria-label', 'ä¸‹ä¸€é¡¹');
                        nextBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                        nav.appendChild(prevBtn);
                        nav.appendChild(nextBtn);

                        const pagination = document.createElement('div');
                        pagination.className = 'device-carousel-pagination';
                        const dots = deviceCards.map(() => {
                            const dot = document.createElement('div');
                            dot.className = 'device-dot';
                            pagination.appendChild(dot);
                            return dot;
                        });

                        const controls = document.createElement('div');
                        controls.className = 'device-carousel-controls';
                        
                        const leftNav = document.createElement('div');
                        leftNav.className = 'device-carousel-nav';
                        leftNav.appendChild(prevBtn);
                        
                        const rightNav = document.createElement('div');
                        rightNav.className = 'device-carousel-nav';
                        rightNav.appendChild(nextBtn);
                        
                        controls.appendChild(leftNav);
                        controls.appendChild(pagination);
                        controls.appendChild(rightNav);

                        carousel.appendChild(track);
                        carousel.appendChild(controls);

                        let current = 0;
                        const total = deviceCards.length;

                        function layout() {
                            const slides = Array.from(track.children);
                            slides.forEach((slide, i) => {
                                const offset = ((i - current + total) % total);
                                let translateX = 0;
                                let translateZ = 0;
                                let rotateY = 0;
                                let zIndex = 0;
                                // ä»…æ˜¾ç¤ºå½“å‰ä¸ä¸¤ä¾§ç›¸é‚»ï¼Œå…±3é¡¹
                                if (offset === 0) {
                                    translateX = -50;
                                    translateZ = 120;
                                    rotateY = 0;
                                    zIndex = 3;
                                    slide.classList.add('active');
                                    slide.classList.remove('hidden');
                                    slide.classList.remove('side');
                                } else if (offset === 1) {
                                    translateX = 20;
                                    translateZ = 0;
                                    rotateY = -20;
                                    zIndex = 2;
                                    slide.classList.remove('active');
                                    slide.classList.remove('hidden');
                                    slide.classList.add('side');
                                } else if (offset === total - 1) {
                                    translateX = -120;
                                    translateZ = 0;
                                    rotateY = 20;
                                    zIndex = 2;
                                    slide.classList.remove('active');
                                    slide.classList.remove('hidden');
                                    slide.classList.add('side');
                                } else {
                                    translateX = (offset < total / 2 ? 160 : -240);
                                    translateZ = -120;
                                    rotateY = offset < total / 2 ? -30 : 30;
                                    zIndex = 1;
                                    slide.classList.remove('active');
                                    slide.classList.add('hidden');
                                    slide.classList.remove('side');
                                }
                                slide.style.zIndex = zIndex.toString();
                                slide.style.transform = `translate3d(${translateX}%, 0, ${translateZ}px) rotateY(${rotateY}deg)`;
                            });
                            dots.forEach((dot, i) => { dot.classList.toggle('active', i === current); });
                        }

                        function go(delta) { current = (current + delta + total) % total; layout(); }

                        prevBtn.addEventListener('click', () => go(-1));
                        nextBtn.addEventListener('click', () => go(1));
                        dots.forEach((dot, i) => dot.addEventListener('click', () => { current = i; layout(); }));

                        carousel.setAttribute('tabindex', '0');
                        carousel.addEventListener('keydown', (e) => { if (e.key === 'ArrowLeft') go(-1); if (e.key === 'ArrowRight') go(1); });
                        let startX = 0;
                        carousel.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive: true });
                        carousel.addEventListener('touchend', (e) => {
                            const dx = e.changedTouches[0].clientX - startX;
                            if (dx > 40) go(-1);
                            if (dx < -40) go(1);
                        }, { passive: true });

                        layout();

                        // ç‚¹å‡»å·¦å³ä¾§å¡ç‰‡åˆ‡æ¢
                        track.addEventListener('click', (e) => {
                            const slides = Array.from(track.children);
                            const clickedSlide = e.target.closest('.device-slide');
                            if (!clickedSlide) return;
                            const index = slides.indexOf(clickedSlide);
                            if (index === -1) return;
                            const offset = ((index - current + total) % total);
                            if (offset === 1) go(1);
                            if (offset === total - 1) go(-1);
                        });

                        // ç¦ç”¨éæ¿€æ´»å¡ç‰‡çš„å›¾ç‰‡ç‚¹å‡»æ”¾å¤§
                        track.addEventListener('click', (e) => {
                            if (e.target.tagName === 'IMG') {
                                const slide = e.target.closest('.device-slide');
                                if (!slide || !slide.classList.contains('active')) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                }
                            }
                        });
                    }
                }
            }
        });
        </script>
        
        <!-- å¼‚æ­¥åŠ è½½ä»£ç é«˜äº® -->
        
        <script async="" src="/js/highlight.min.js"></script>
        <script async="" src="/js/highlightjs-line-numbers.js"></script>
        <script>
        // ç­‰å¾…ä»£ç é«˜äº®åº“åŠ è½½å®Œæˆååˆå§‹åŒ–
        function initHighlight() {
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
                hljs.initLineNumbersOnLoad();
            } else {
                setTimeout(initHighlight, 100);
            }
        }
        document.addEventListener('DOMContentLoaded', initHighlight);
        </script>
        
        

        <!-- å¼‚æ­¥åŠ è½½ç›®å½•åŠŸèƒ½ -->
        <script async="" src="/js/toc.js"></script>
    
</body></html>