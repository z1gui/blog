<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport">
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>Planet配置Web3域名 - 子规入梧桐</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="Planet 项目是 V 站站长 Livid 很早之前启动的项目。最近 V 站也出了 $V2EX 币， Livid 也一直在推动区块链和 Web3 在 V 站的快速应用。跟着这个趋势，我也学习了很多这方面的知识。   Planet 是一款免费的开源 macOS 应用程序，用于发布和关注 Web 内容。它不依赖于中央服务器或服务，而是使用 IPFS 进行点对点内容分发。您可以将您的内容链接到以太坊名">
<meta property="og:type" content="article">
<meta property="og:title" content="Planet配置Web3域名">
<meta property="og:url" content="https://www.lazydaily.cn/6885322357796359/index.html">
<meta property="og:site_name" content="子规入梧桐">
<meta property="og:description" content="Planet 项目是 V 站站长 Livid 很早之前启动的项目。最近 V 站也出了 $V2EX 币， Livid 也一直在推动区块链和 Web3 在 V 站的快速应用。跟着这个趋势，我也学习了很多这方面的知识。   Planet 是一款免费的开源 macOS 应用程序，用于发布和关注 Web 内容。它不依赖于中央服务器或服务，而是使用 IPFS 进行点对点内容分发。您可以将您的内容链接到以太坊名">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lazydaily.cn/img/image-202588319698.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/image-202588559199.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/image-202588839176.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/image-2025882636315.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/image-2025884737529.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/telegram-cloud-photo-size-5-6098227393199198658-y.jpg">
<meta property="article:published_time" content="2025-08-07T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-08T11:08:01.272Z">
<meta property="article:author" content="z1gui">
<meta property="article:tag" content="Planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lazydaily.cn/img/image-202588319698.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://www.lazydaily.cn/6885322357796359/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.png">
  
  <!-- Google Fonts 预加载 - 优化字体加载 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  
  <!-- 预加载所有字体 -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  
  <!-- 字体加载优化脚本 -->
  <script>
    // 字体加载优化
    (function() {
      // 检查是否支持Font Loading API
      if ('fonts' in document) {
        // 异步加载字体，不阻塞页面渲染
        setTimeout(function() {
          Promise.all([
            document.fonts.load('400 1em "JetBrains Mono"'),
            document.fonts.load('400 1em "Noto Serif"'),
            document.fonts.load('400 1em "Noto Serif SC"')
          ]).then(function() {
            document.documentElement.classList.add('fonts-loaded');
          }).catch(function() {
            document.documentElement.classList.add('fonts-fallback');
          });
        }, 0);
      } else {
        // 不支持Font Loading API的浏览器，直接使用系统字体
        document.documentElement.classList.add('fonts-fallback');
      }
    })();
  </script>
  
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

  
<link rel="stylesheet" href="/css/a11y-dark.min.css">

  
  <!-- 图片懒加载 -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 预加载队列
      const preloadQueue = [];
      let isProcessing = false;
      let processedImages = new Set();
      
      // 创建loading效果
      function createLoadingEffect(img) {
        // 检查是否已经有容器
        let container = img.parentElement;
        if (!container || !container.classList.contains('image-container')) {
          // 创建图片容器
          container = document.createElement('div');
          container.className = 'image-container loading';
          
          // 将图片包装在容器中
          img.parentNode.insertBefore(container, img);
          container.appendChild(img);
        } else {
          // 如果已有容器，添加loading类
          container.classList.add('loading');
        }
        
        return container;
      }
      
      // 移除loading效果
      function removeLoadingEffect(container) {
        if (container && container.classList.contains('loading')) {
          container.classList.remove('loading');
        }
      }
      
      // 处理预加载队列
      function processPreloadQueue() {
        if (isProcessing || preloadQueue.length === 0) return;
        
        isProcessing = true;
        const img = preloadQueue.shift();
        
        if (img && img.dataset.src && !processedImages.has(img)) {
          processedImages.add(img);
          
          // 添加loading效果
          const container = createLoadingEffect(img);
          
          img.src = img.dataset.src;
          
          img.addEventListener('load', function() {
            img.classList.add('loaded');
            removeLoadingEffect(container);
            isProcessing = false;
            // 继续处理队列中的下一张图片
            setTimeout(processPreloadQueue, 10);
          });
          
          img.addEventListener('error', function() {
            removeLoadingEffect(container);
            isProcessing = false;
            // 继续处理队列中的下一张图片
            setTimeout(processPreloadQueue, 10);
          });
        } else {
          isProcessing = false;
          // 继续处理队列中的下一张图片
          setTimeout(processPreloadQueue, 10);
        }
      }
      
      // 处理所有图片
      function handleImages() {
        // 选择所有懒加载图片，但排除favicon
        const lazyImages = document.querySelectorAll('.lazy-image');
        const allImages = document.querySelectorAll('img');
        
        console.log('找到图片数量:', allImages.length, '懒加载图片数量:', lazyImages.length);
        
        // 如果没有懒加载图片，检查是否有需要处理的图片
        if (lazyImages.length === 0) {
          allImages.forEach(img => {
            // 排除favicon.png
            if (img.src && !img.src.includes('favicon.png') && !img.src.includes('favicon1.png') && 
                img.dataset.src && !img.classList.contains('lazy-image')) {
              // 如果有data-src属性，说明是懒加载图片
              img.classList.add('lazy-image');
              
              // 添加loading效果
              const container = createLoadingEffect(img);
              
              // 立即加载图片
              img.src = img.dataset.src;
              
              // 图片加载完成后的处理
              img.addEventListener('load', function() {
                img.classList.add('loaded');
                removeLoadingEffect(container);
              });
              
              img.addEventListener('error', function() {
                removeLoadingEffect(container);
              });
            }
          });
          return;
        }
        
        // 使用Intersection Observer处理懒加载图片
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              
              // 检查是否有data-src属性
              if (img.dataset.src && !processedImages.has(img)) {
                // 将图片添加到预加载队列
                preloadQueue.push(img);
                processPreloadQueue();
              } else if (!img.dataset.src) {
                // 如果没有data-src，直接显示图片
                img.classList.add('loaded');
              }
              
              // 停止观察这个图片
              observer.unobserve(img);
            }
          });
        }, {
          rootMargin: '400px 0px', // 提前400px开始加载，大幅提升加载速度
          threshold: 0.001 // 降低阈值，图片刚进入视口就开始加载
        });
        
        // 开始观察所有懒加载图片
        lazyImages.forEach(img => {
          // 排除favicon.png
          if (!img.src.includes('favicon.png') && !img.src.includes('favicon1.png')) {
            imageObserver.observe(img);
          }
        });
      }
      
      // 立即执行一次
      handleImages();
      
      // 减少延迟时间，提升响应速度
      setTimeout(handleImages, 20);
    });
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="子规入梧桐" type="application/atom+xml">
</head>

    <body>
        <div class="paper">
            <div class="paper-main">
                <div class="header">
    <div class="header-content">
        <!-- 头像和主标题一起可点击 -->
        <a href="/" class="header-home-link">
            <div class="hero-header">
                <div class="hero-header-visual">
                    <div class="hero-header-graphic">
                        <img src="/img/favicon.png" alt="Logo" width="30" height="30">
                    </div>
                </div>
                <div class="hero-header-text">
                    <h1 class="hero-header-title">子规入梧桐</h1>
                </div>
            </div>
        </a>
        <!-- 导航栏 -->
        <ul class="nav">
            
            <li>
                
                <a href="/" class="">
                   主页
                   
                </a>
            </li>
            
            <li>
                
                <a href="/archives" class="">
                   归档
                   
                </a>
            </li>
            
            <li>
                
                <a href="/about" class="">
                   关于
                   
                </a>
            </li>
            
            <li>
                
                <a href="/use" class="">
                   设备
                   
                </a>
            </li>
            
            <li>
                
                <a href="https://uhufoundme.sol.build/" class="" target="&quot;_blank&quot;" rel="&quot;noopener" noreferrer&#34;="">
                   碎碎念
                   
                   <span class="external-link-icon">🔗</span>
                   
                </a>
            </li>
            
        </ul>
    </div>
</div>

                <div class="post-main">
    <!-- 阅读进度条 -->
    <div class="reading-progress-bar" id="readingProgressBar"></div>
    
    
        <div class="post-main-title">
            Planet配置Web3域名
        </div>
        <div class="post-meta">
            2025-08-08 ｜ 
            
                <a href="/tags/Planet/"># Planet</a>
            
        </div>

        <div class="post-content-wrapper">
            <div class="post-content-main">
                <div class="post-md">
                    <p>Planet 项目是 V 站站长 Livid 很早之前启动的项目。最近 V 站也出了 $V2EX 币， Livid 也一直在推动区块链和 Web3 在 V 站的快速应用。跟着这个趋势，我也学习了很多这方面的知识。</p>
<blockquote>
<p> Planet 是一款免费的开源 macOS 应用程序，用于发布和关注 Web 内容。它不依赖于中央服务器或服务，而是使用 IPFS 进行点对点内容分发。您可以将您的内容链接到以太坊名称（例如，planetable.eth），以便其他人可以使用您的 .eth 名称在 Planet 上关注您，或通过 eth.limo 或 eth.sucks 等网关访问您的 ENS 网站。由于 IPFS 和 ENS 都是去中心化的，因此 Planet 可以帮助您以去中心化的方式构建和关注网站。</p>
</blockquote>
<p>了解到 Planet 的特性以及原理后，我发现 Planet 很适合做日志，随记，心情，备忘录的 Posts。正好我当前 Web2 的博客网站上没有类似的功能，索性把 Planet 的 Web 集成到博客网站上。我火速给自己搭建了 Web，并在此 Web 上链接了 Web3 的域名。你可以点击导航栏上的 『碎碎念🔗』或者直接访问我的 Web3 域名『 <a target="_blank" rel="noopener" href="https://uhufoundme.sol.build/">https://uhufoundme.sol.build/</a> 』，跳转到我的日常更新 Posts。</p>
<p>言归正题，Planet 应用能够轻松将 Web 内容发布在链上，并通过 IPFS 生成的 IPNS 访问链上内容。但是这个 IPNS 是随机的哈希值，难记，不易传播，所以就需要链接一个 Web3 域名。这里有两种方案，一种是直接买一个 Web3 的域名，类似 .eth 或者 .sol 的。另一种是 Web2 域名开启 IPNS，支持链上内容的绑定。因为我本来就有个 Web2 域名，所以一开始我想开通 IPNS 就不用再折腾了。这里吐槽一下，阿里云域名开通 IPNS 要￥120，而 .eth 域名每月几美刀，.sol 冷门域名 1 刀就可以永久拥有，那就用 .sol 吧。</p>
<h2 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h2><blockquote>
<p>Solana域名服务（SNS）的目标是提供一种去中心化且可负担的方式，将域名（.sol）和链上数据连接起来。这些链上数据可以是SOL地址、 IPFS CID、图片、文本、或者任何其它的东西。</p>
</blockquote>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="image-202588319698.png" data-src="/img/image-202588319698.png" loading="lazy" class="lazy-image"></div></p>
<p>在 <a target="_blank" rel="noopener" href="https://www.sns.id/zh-Hans">Solana</a> 上购买域名需要通过 Web3钱包登录，该网站支持多种钱包，我使用的是 phantom 钱包。登录之后就可以直接在页面上搜索想要的域名，其中大部分的域名都在 20 USDC（大概 $20），一些冷门的域名可以 1 USDC 捡到，可以多试试。</p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="image-202588559199.png" data-src="/img/image-202588559199.png" loading="lazy" class="lazy-image"></div></p>
<p>支付时候也有多种方式，可以用 SOL，USDC，USDT 或者其他虚拟货币，甚至可以用信用卡。在这里，不讨论如何充值虚拟货币，如果有疑问可以 google。需要注意的是，<strong>所有链上操作都需要有手续费，在充币或者兑换时候要考虑多买多充</strong>。</p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="image-202588839176.png" data-src="/img/image-202588839176.png" loading="lazy" class="lazy-image"></div></p>
<h2 id="绑定-IPNS"><a href="#绑定-IPNS" class="headerlink" title="绑定 IPNS"></a>绑定 IPNS</h2><p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="image-2025882636315.png" data-src="/img/image-2025882636315.png" loading="lazy" class="lazy-image"></div></p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="image-2025884737529.png" data-src="/img/image-2025884737529.png" loading="lazy" class="lazy-image"></div></p>
<p>在购买之后，就可以去我的域名里面配置，将 Planet 上复制的 IPNS 复制配置好即可。这里我出现了下图的问题，一开始也不清楚什么情况。请教了一下 Livid 之后，才知道是因为绑定操作也是需要消耗 gas 的，我钱包里面 SOL 不够。然后 Livid 给我空投 0.1 SOL 之后就绑定成功。</p>
<p><div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="telegram-cloud-photo-size-5-6098227393199198658-y.jpg" data-src="/img/telegram-cloud-photo-size-5-6098227393199198658-y.jpg" loading="lazy" class="lazy-image"></div></p>
<p>这样就可以通过 <a target="_blank" rel="noopener" href="https://uhufoundme.sol.build/">https://uhufoundme.sol.build/</a> 访问了。在这个过程中，感谢 Livid 大佬的答疑以及空投。</p>
<p>得益于 IPFS 这种 P2P 的方式，在 Planet 中 Send 之后就发布在 Web 上，不需要额外的去服务器上发布内容。这种便捷的方式对我来说更适合去记录即时的灵感和感受。所以我决定在 <a target="_blank" rel="noopener" href="https://uhufoundme.sol.build/">https://uhufoundme.sol.build/</a> 更新些更随意，更生活的内容，在 <a href="https://www.lazydaily.cn/">https://www.lazydaily.cn/</a> 更新些更严谨，更有质量的内容。你也可以通过不同的地址来关注感兴趣的内容。</p>

                </div>
            </div>
            <div class="post-content-sidebar">
                <div class="toc-toggle-btn" id="tocToggleBtn" title="显示目录">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </div>
                <div class="post-toc" id="postToc">
                    <div class="toc-header">
                        <div class="toc-title">目录</div>
                    </div>
                    <div class="toc-content"></div>
                </div>
            </div>
        </div>
    

<!-- 只在文章页面显示分类和导航 -->

    <!-- 分类信息 -->
    
        <div class="post-categories">
            分类：
            
                <a href="/categories/Web3/"> / Web3</a>
            
        </div>
    

    <!-- 分享按钮 -->
    <div class="post-share">
        <button class="share-btn" id="shareBtn" title="分享文章">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 5.12548 15.0077 5.24917 15.0227 5.37061L8.08264 9.26727C7.54305 8.48822 6.60487 8 5.5 8C4.11929 8 3 9.11929 3 10.5C3 11.8807 4.11929 13 5.5 13C6.60487 13 7.54305 12.5118 8.08264 11.7327L15.0227 15.6294C15.0077 15.7508 15 15.8745 15 16C15 17.6569 16.3431 19 18 19C19.6569 19 21 17.6569 21 16C21 14.3431 19.6569 13 18 13C16.8951 13 15.9569 13.4882 15.4174 14.2673L8.47736 10.3706C8.49232 10.2492 8.5 10.1255 8.5 10C8.5 9.87452 8.49232 9.75083 8.47736 9.62939L15.4174 5.73273C15.9569 6.51178 16.8951 7 18 7C19.6569 7 21 5.65685 21 4C21 2.34315 19.6569 1 18 1C16.3431 1 15 2.34315 15 4C15 4.12548 15.0077 4.24917 15.0227 4.37061L8.08264 8.26727C7.54305 7.48822 6.60487 7 5.5 7C3.567 7 2 8.567 2 10.5C2 12.433 3.567 14 5.5 14C6.60487 14 7.54305 13.5118 8.08264 12.7327L15.0227 16.6294C15.0077 16.7508 15 16.8745 15 17C15 18.6569 16.3431 20 18 20C19.6569 20 21 18.6569 21 17C21 15.3431 19.6569 14 18 14C16.8951 14 15.9569 14.4882 15.4174 15.2673L8.47736 11.3706C8.49232 11.2492 8.5 11.1255 8.5 11C8.5 10.8745 8.49232 10.7508 8.47736 10.6294L15.4174 6.73273C15.9569 7.51178 16.8951 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            分享
        </button>
    </div>

    <!-- 添加上一篇和下一篇导航 -->
    <div class="post-navigation">
        <div class="post-nav-prev">
            
        </div>
        <div class="post-nav-next">
            
                <span class="nav-label">下一篇</span>
                <a href="/761386768996888/" class="nav-title">「持续更新」AI辅助编程使用心得</a>
            
        </div>
    </div>

</div>

<!-- 图片全屏显示模态框 -->
<div class="image-modal" id="imageModal">
    <img id="modalImage" src="" alt="全屏图片">
</div>

<!-- 代码全屏显示模态框 -->
<div class="code-modal" id="codeModal">
    <div class="code-modal-content">
        <div class="code-modal-header">
            <div class="code-modal-title">代码查看</div>
            <div class="code-modal-close" id="codeModalClose">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
        </div>
        <div class="code-modal-code">
            <pre><code id="modalCode"></code></pre>
        </div>
    </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const postImages = document.querySelectorAll('.post-md img');

    // 点击图片打开模态框
    postImages.forEach(img => {
        // 检查图片是否在社交链接中
        const isSocialIcon = img.closest('.social-links') !== null;
        if (!isSocialIcon) {
            img.addEventListener('click', function() {
                modal.classList.add('active');
                modalImg.src = this.src;
                document.body.style.overflow = 'hidden'; // 防止背景滚动
            });
        }
    });

    // 点击模态框关闭
    modal.addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // 恢复背景滚动
    });

    // 按 ESC 键关闭模态框
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    // 阅读进度条功能
    const progressBar = document.getElementById('readingProgressBar');
    if (progressBar) {
        function updateReadingProgress() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            
            // 限制进度条宽度在0-100%之间
            const progressWidth = Math.min(Math.max(scrollPercent, 0), 100);
            progressBar.style.width = progressWidth + '%';
        }

        // 监听滚动事件
        window.addEventListener('scroll', updateReadingProgress);
        
        // 页面加载时初始化进度条
        updateReadingProgress();
    }



    // 目录功能已移至工具栏统一管理

    // 代码块全屏功能
    const codeModal = document.getElementById('codeModal');
    const modalCode = document.getElementById('modalCode');
    const codeModalClose = document.getElementById('codeModalClose');

    // 为所有代码块添加全屏按钮
    const codeBlocks = document.querySelectorAll('.post-md pre');
    codeBlocks.forEach(pre => {
        // 检查是否已经有按钮（避免重复添加）
        if (!pre.querySelector('.code-fullscreen-btn')) {
            const fullscreenBtn = document.createElement('div');
            fullscreenBtn.className = 'code-fullscreen-btn';
            fullscreenBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H5C3.89543 3 3 3.89543 3 5V8M21 8V5C21 3.89543 20.1046 3 19 3H16M16 21H19C20.1046 21 21 20.1046 21 19V16M3 16V19C3 20.1046 3.89543 21 5 21H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            fullscreenBtn.title = '全屏查看代码';
            
            // 点击按钮显示全屏代码
            fullscreenBtn.addEventListener('click', function() {
                const codeElement = pre.querySelector('code');
                if (codeElement) {
                    // 检查是否是已经应用了行号的代码块
                    const hljsTable = pre.querySelector('table.hljs-ln');
                    
                    let codeContent;
                    let startLineNumber = 1;
                    
                    if (hljsTable) {
                        // 如果有行号表格，提取纯代码内容和起始行号
                        const codeLines = hljsTable.querySelectorAll('.hljs-ln-code');
                        codeContent = Array.from(codeLines).map(line => {
                            // 提取每行的文本内容，保持原始格式
                            return line.textContent || line.innerText || ' ';
                        }).join('\n');
                        
                        // 获取起始行号
                        const firstNumberCell = hljsTable.querySelector('.hljs-ln-numbers');
                        if (firstNumberCell) {
                            const lineAttr = firstNumberCell.getAttribute('data-line-number');
                            if (lineAttr) {
                                startLineNumber = parseInt(lineAttr) || 1;
                            }
                        }
                    } else {
                        // 普通代码块，直接获取文本内容
                        codeContent = codeElement.textContent || codeElement.innerText;
                    }
                    
                    const codeLanguage = getCodeLanguage(codeElement);
                    
                    // 设置模态框中的代码内容
                    modalCode.textContent = codeContent;
                    modalCode.className = codeElement.className; // 保持代码高亮的类名
                    
                    // 如果原代码有自定义起始行号，设置data属性
                    if (startLineNumber !== 1) {
                        modalCode.setAttribute('data-ln-start-from', startLineNumber);
                    } else {
                        modalCode.removeAttribute('data-ln-start-from');
                    }
                    
                    // 更新标题
                    const modalTitle = document.querySelector('.code-modal-title');
                    if (codeLanguage) {
                        modalTitle.textContent = `代码查看 - ${codeLanguage}`;
                    } else {
                        modalTitle.textContent = '代码查看';
                    }
                    
                    // 显示模态框
                    codeModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    // 重新应用代码高亮和行号
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightElement(modalCode);
                        
                        // 应用行号
                        if (typeof hljs.lineNumbersBlock !== 'undefined') {
                            hljs.lineNumbersBlock(modalCode, {
                                startFrom: startLineNumber
                            });
                        }
                    }
                }
            });
            
            pre.appendChild(fullscreenBtn);
        }
    });

    // 获取代码语言
    function getCodeLanguage(codeElement) {
        const className = codeElement.className;
        const languageMatch = className.match(/language-(\w+)|hljs-(\w+)|\b(\w+)$/);
        if (languageMatch) {
            return languageMatch[1] || languageMatch[2] || languageMatch[3];
        }
        return '';
    }

    // 关闭代码全屏模态框
    function closeCodeModal() {
        codeModal.classList.remove('active');
        document.body.style.overflow = '';
    }

    // 点击关闭按钮
    if (codeModalClose) {
        codeModalClose.addEventListener('click', closeCodeModal);
    }

    // 点击模态框背景关闭（点击内容区域不关闭）
    codeModal.addEventListener('click', function(e) {
        if (e.target === codeModal) {
            closeCodeModal();
        }
    });

    // 按 ESC 键关闭代码模态框
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (codeModal.classList.contains('active')) {
                closeCodeModal();
            }
        }
    });

    // 分享功能
    const shareBtn = document.getElementById('shareBtn');
    if (shareBtn) {
        shareBtn.addEventListener('click', function() {
            // 获取文章信息
            const title = document.querySelector('.post-main-title')?.textContent?.trim() || '未知标题';
            const date = document.querySelector('.post-meta')?.textContent?.match(/\d{4}-\d{2}-\d{2}/)?.[0] || '';
            const url = window.location.href;
            
            // 获取文章前几行内容（排除标题、元信息等）
            const postContent = document.querySelector('.post-md');
            let content = '';
            if (postContent) {
                // 获取所有段落和文本内容
                const paragraphs = postContent.querySelectorAll('p, h1, h2, h3, h4, h5, h6');
                const contentArray = [];
                
                for (let i = 0; i < Math.min(paragraphs.length, 3); i++) {
                    const text = paragraphs[i].textContent?.trim();
                    if (text && text.length > 0) {
                        contentArray.push(text);
                    }
                }
                
                content = contentArray.join('\n\n');
                
                // 如果内容太长，截取前100个字符
                if (content.length > 100) {
                    content = content.substring(0, 100) + '...';
                }
            }
            
            // 构建分享内容
            let shareText = `文章标题： ${title}`;
            if (date) {
                shareText += `\n发布时间： ${date}`;
            }
            if (content) {
                shareText += `\n\n${content}`;
            }
            shareText += `\n\n🔗 ${url}`;
            
            // 复制到剪贴板
            if (navigator.clipboard && window.isSecureContext) {
                // 使用现代 Clipboard API
                navigator.clipboard.writeText(shareText).then(function() {
                    showShareSuccess();
                }).catch(function(err) {
                    console.error('复制失败:', err);
                    fallbackCopyTextToClipboard(shareText);
                });
            } else {
                // 降级方案
                fallbackCopyTextToClipboard(shareText);
            }
        });
    }
    
    // 显示分享成功提示
    function showShareSuccess() {
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            const originalText = shareBtn.innerHTML;
            shareBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                已复制
            `;
            shareBtn.classList.add('copied');
            
            setTimeout(function() {
                shareBtn.innerHTML = originalText;
                shareBtn.classList.remove('copied');
            }, 2000);
        }
    }
    
    // 降级复制方案
    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showShareSuccess();
            } else {
                alert('复制失败，请手动复制以下内容：\n\n' + text);
            }
        } catch (err) {
            console.error('复制失败:', err);
            alert('复制失败，请手动复制以下内容：\n\n' + text);
        }
        
        document.body.removeChild(textArea);
    }
});
</script>
                
            </div>
        </div>

        <!-- JavaScript -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const html = document.documentElement;
            const header = document.querySelector('.header');
            
            // 头部内容滚动显示/隐藏功能
            let lastScrollTop = 0;
            let scrollThreshold = 3; // 滚动阈值，避免微小滚动触发
            
            function handleHeaderScroll() {
                if (!header) return;
                
                const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // 计算滚动距离
                const scrollDifference = currentScrollTop - lastScrollTop;
                
                // 向下滚动隐藏
                if (scrollDifference > scrollThreshold && currentScrollTop > 30) {
                    header.classList.add('hidden');
                }
                // 向上滚动显示
                else if (scrollDifference < -scrollThreshold) {
                    header.classList.remove('hidden');
                }
                // 在页面顶部时显示
                else if (currentScrollTop <= 30) {
                    header.classList.remove('hidden');
                }
                
                lastScrollTop = currentScrollTop;
            }
            
            // 监听滚动事件
            window.addEventListener('scroll', handleHeaderScroll, { passive: true });
            
            // 页面加载时显示头部内容
            if (header) {
                header.classList.remove('hidden');
            }
            
            // 目录切换按钮功能（仅在文章页面）
            const tocToggleBtn = document.getElementById('tocToggleBtn');
            if (tocToggleBtn) {
                const postToc = document.getElementById('postToc');
                
                // 从localStorage获取目录状态
                const tocHidden = localStorage.getItem('tocHidden') === 'true';
                if (tocHidden && postToc) {
                    postToc.classList.add('hidden');
                    tocToggleBtn.classList.add('hidden');
                }
                
                // 点击切换目录显示/隐藏
                tocToggleBtn.addEventListener('click', function() {
                    if (postToc) {
                        const isHidden = postToc.classList.contains('hidden');
                        if (isHidden) {
                            postToc.classList.remove('hidden');
                            this.classList.remove('hidden');
                            localStorage.setItem('tocHidden', 'false');
                        } else {
                            postToc.classList.add('hidden');
                            this.classList.add('hidden');
                            localStorage.setItem('tocHidden', 'true');
                        }
                    }
                });
            }
        });
        </script>
        
        <!-- 异步加载代码高亮 -->
        
        <script async="" src="/js/highlight.min.js"></script>
        <script async="" src="/js/highlightjs-line-numbers.js"></script>
        <script>
        // 等待代码高亮库加载完成后初始化
        function initHighlight() {
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
                hljs.initLineNumbersOnLoad();
            } else {
                setTimeout(initHighlight, 100);
            }
        }
        document.addEventListener('DOMContentLoaded', initHighlight);
        </script>
        
        
        <!-- 异步加载目录功能 -->
        <script async="" src="/js/toc.js"></script>
    
</body></html>