<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport">
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>èŠèŠJava IOçš„é‚£äº›äº‹ - å­è§„å…¥æ¢§æ¡</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="BIO NIO AIO    IOæ¨¡å‹ åŒæ­¥é˜»å¡ åŒæ­¥éé˜»å¡ï¼ˆå¤šè·¯å¤ç”¨ï¼‰ å¼‚æ­¥éé˜»å¡   ç¼–ç¨‹éš¾åº¦ ç®€å• å¤æ‚ å¤æ‚   å¯é æ€§ å·® å¥½ å¥½   ååé‡ ä½ é«˜ é«˜   é˜…å‰é¡»çŸ¥é˜»å¡ IO å’Œ éé˜»å¡ IO è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ ç¨‹åºçº§åˆ« çš„ã€‚ä¸»è¦æè¿°æ˜¯ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»Ÿ IO æ“ä½œä¹‹åï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆç¨‹åºå¦‚ä½•å¤„ç†é—®é¢˜ï¼šå‰è€…ç­‰å¾…ï¼Œåè€…ç»§ç»­æ‰§è¡Œï¼ˆå¹¶ä¸”ä½¿ç”¨çº¿ç¨‹ä¸€ç›´è½®è¯¢ï¼Œç›´åˆ°æœ‰ IO èµ„">
<meta property="og:type" content="article">
<meta property="og:title" content="èŠèŠJava IOçš„é‚£äº›äº‹">
<meta property="og:url" content="https://www.lazydaily.cn/761386768996841/index.html">
<meta property="og:site_name" content="å­è§„å…¥æ¢§æ¡">
<meta property="og:description" content="BIO NIO AIO    IOæ¨¡å‹ åŒæ­¥é˜»å¡ åŒæ­¥éé˜»å¡ï¼ˆå¤šè·¯å¤ç”¨ï¼‰ å¼‚æ­¥éé˜»å¡   ç¼–ç¨‹éš¾åº¦ ç®€å• å¤æ‚ å¤æ‚   å¯é æ€§ å·® å¥½ å¥½   ååé‡ ä½ é«˜ é«˜   é˜…å‰é¡»çŸ¥é˜»å¡ IO å’Œ éé˜»å¡ IO è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ ç¨‹åºçº§åˆ« çš„ã€‚ä¸»è¦æè¿°æ˜¯ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»Ÿ IO æ“ä½œä¹‹åï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆç¨‹åºå¦‚ä½•å¤„ç†é—®é¢˜ï¼šå‰è€…ç­‰å¾…ï¼Œåè€…ç»§ç»­æ‰§è¡Œï¼ˆå¹¶ä¸”ä½¿ç”¨çº¿ç¨‹ä¸€ç›´è½®è¯¢ï¼Œç›´åˆ°æœ‰ IO èµ„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lazydaily.cn/img/acea8af4268c8d552741ccebcb2d34ec_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/0fb77c535fcbf8f4264b6eff292fd210_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/ed84ace61748c9dbdaf3f9718f21ff21_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/a8f0d4502adb087892e11866bdac7d57_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/5ee1af7a6012fd34b62704d5b2867320_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/5cd2995739f1b0e1f4b355a2471c38aa_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/0d87f8ba4e770fbdcd6c6fc61fb84862_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/f6ef08bdd8b4ff67a419bfe9b7dbc0f2_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/94530647a3be7da4d2de055fff8bacaf_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/0b37a3b751ec9aa08efa75ace30e23c4_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/10d0080498aba2649f1c04067965b579_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/37b1874d4aabb48cd6b511cba09fa70b_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/870a39b7312d1d18324d3aefa613ab37_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/3a01157436842562f7f21f8b4c4549d4_MD5.png">
<meta property="og:image" content="https://www.lazydaily.cn/img/2ff37cd0e1f5f734f8d6209396a08897_MD5.png">
<meta property="article:published_time" content="2024-11-30T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-20T07:21:35.911Z">
<meta property="article:author" content="z1gui">
<meta property="article:tag" content="java">
<meta property="article:tag" content="IO">
<meta property="article:tag" content="NIO">
<meta property="article:tag" content="BIO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lazydaily.cn/img/acea8af4268c8d552741ccebcb2d34ec_MD5.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://www.lazydaily.cn/761386768996841/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.png">
  
  <!-- Google Fonts é¢„åŠ è½½ - ä¼˜åŒ–å­—ä½“åŠ è½½ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  
  <!-- é¢„åŠ è½½æ‰€æœ‰å­—ä½“ -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;1,400&amp;family=Noto+Serif:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&amp;family=Noto+Serif+SC:wght@400;700;900&amp;display=swap">
  
  <!-- å­—ä½“åŠ è½½ä¼˜åŒ–è„šæœ¬ -->
  <script>
    // å­—ä½“åŠ è½½ä¼˜åŒ–
    (function() {
      // æ£€æŸ¥æ˜¯å¦æ”¯æŒFont Loading API
      if ('fonts' in document) {
        // å¼‚æ­¥åŠ è½½å­—ä½“ï¼Œä¸é˜»å¡é¡µé¢æ¸²æŸ“
        setTimeout(function() {
          Promise.all([
            document.fonts.load('400 1em "JetBrains Mono"'),
            document.fonts.load('400 1em "Noto Serif"'),
            document.fonts.load('400 1em "Noto Serif SC"')
          ]).then(function() {
            document.documentElement.classList.add('fonts-loaded');
          }).catch(function() {
            document.documentElement.classList.add('fonts-fallback');
          });
        }, 0);
      } else {
        // ä¸æ”¯æŒFont Loading APIçš„æµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨ç³»ç»Ÿå­—ä½“
        document.documentElement.classList.add('fonts-fallback');
      }
    })();
  </script>
  
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

  
<link rel="stylesheet" href="/css/a11y-dark.min.css">

  
  <!-- å›¾ç‰‡æ‡’åŠ è½½ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // é¢„åŠ è½½é˜Ÿåˆ—
      const preloadQueue = [];
      let isProcessing = false;
      let processedImages = new Set();
      
      // åˆ›å»ºloadingæ•ˆæœ
      function createLoadingEffect(img) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å®¹å™¨
        let container = img.parentElement;
        if (!container || !container.classList.contains('image-container')) {
          // åˆ›å»ºå›¾ç‰‡å®¹å™¨
          container = document.createElement('div');
          container.className = 'image-container loading';
          
          // å°†å›¾ç‰‡åŒ…è£…åœ¨å®¹å™¨ä¸­
          img.parentNode.insertBefore(container, img);
          container.appendChild(img);
        } else {
          // å¦‚æœå·²æœ‰å®¹å™¨ï¼Œæ·»åŠ loadingç±»
          container.classList.add('loading');
        }
        
        return container;
      }
      
      // ç§»é™¤loadingæ•ˆæœ
      function removeLoadingEffect(container) {
        if (container && container.classList.contains('loading')) {
          container.classList.remove('loading');
        }
      }
      
      // å¤„ç†é¢„åŠ è½½é˜Ÿåˆ—
      function processPreloadQueue() {
        if (isProcessing || preloadQueue.length === 0) return;
        
        isProcessing = true;
        const img = preloadQueue.shift();
        
        if (img && img.dataset.src && !processedImages.has(img)) {
          processedImages.add(img);
          
          // æ·»åŠ loadingæ•ˆæœ
          const container = createLoadingEffect(img);
          
          img.src = img.dataset.src;
          
          img.addEventListener('load', function() {
            img.classList.add('loaded');
            removeLoadingEffect(container);
            isProcessing = false;
            // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
            setTimeout(processPreloadQueue, 10);
          });
          
          img.addEventListener('error', function() {
            removeLoadingEffect(container);
            isProcessing = false;
            // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
            setTimeout(processPreloadQueue, 10);
          });
        } else {
          isProcessing = false;
          // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€å¼ å›¾ç‰‡
          setTimeout(processPreloadQueue, 10);
        }
      }
      
      // å¤„ç†æ‰€æœ‰å›¾ç‰‡
      function handleImages() {
        // é€‰æ‹©æ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡ï¼Œä½†æ’é™¤favicon
        const lazyImages = document.querySelectorAll('.lazy-image');
        const allImages = document.querySelectorAll('img');
        

        
        // å¦‚æœæ²¡æœ‰æ‡’åŠ è½½å›¾ç‰‡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„å›¾ç‰‡
        if (lazyImages.length === 0) {
          allImages.forEach(img => {
            // æ’é™¤favicon.png
            if (img.src && !img.src.includes('favicon.png') && !img.src.includes('github.png') && !img.src.includes('mail.png') && !img.src.includes('rss-fill.png') && 
                img.dataset.src && !img.classList.contains('lazy-image')) {
              // å¦‚æœæœ‰data-srcå±æ€§ï¼Œè¯´æ˜æ˜¯æ‡’åŠ è½½å›¾ç‰‡
              img.classList.add('lazy-image');
              
              // æ·»åŠ loadingæ•ˆæœ
              const container = createLoadingEffect(img);
              
              // ç«‹å³åŠ è½½å›¾ç‰‡
              img.src = img.dataset.src;
              
              // å›¾ç‰‡åŠ è½½å®Œæˆåçš„å¤„ç†
              img.addEventListener('load', function() {
                img.classList.add('loaded');
                removeLoadingEffect(container);
              });
              
              img.addEventListener('error', function() {
                removeLoadingEffect(container);
              });
            }
          });
          return;
        }
        
        // ä½¿ç”¨Intersection Observerå¤„ç†æ‡’åŠ è½½å›¾ç‰‡
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              
              // æ£€æŸ¥æ˜¯å¦æœ‰data-srcå±æ€§
              if (img.dataset.src && !processedImages.has(img)) {
                // å°†å›¾ç‰‡æ·»åŠ åˆ°é¢„åŠ è½½é˜Ÿåˆ—
                preloadQueue.push(img);
                processPreloadQueue();
              } else if (!img.dataset.src) {
                // å¦‚æœæ²¡æœ‰data-srcï¼Œç›´æ¥æ˜¾ç¤ºå›¾ç‰‡
                img.classList.add('loaded');
              }
              
              // åœæ­¢è§‚å¯Ÿè¿™ä¸ªå›¾ç‰‡
              observer.unobserve(img);
            }
          });
        }, {
          rootMargin: '400px 0px', // æå‰400pxå¼€å§‹åŠ è½½ï¼Œå¤§å¹…æå‡åŠ è½½é€Ÿåº¦
          threshold: 0.001 // é™ä½é˜ˆå€¼ï¼Œå›¾ç‰‡åˆšè¿›å…¥è§†å£å°±å¼€å§‹åŠ è½½
        });
        
        // å¼€å§‹è§‚å¯Ÿæ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡
        lazyImages.forEach(img => {
          // æ’é™¤favicon.png
          if (!img.src.includes('favicon.png') && !img.src.includes('github.png') && !img.src.includes('mail.png') && !img.src.includes('rss-fill.png')) {
            imageObserver.observe(img);
          }
        });
      }
      
      // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      handleImages();
      
      // å‡å°‘å»¶è¿Ÿæ—¶é—´ï¼Œæå‡å“åº”é€Ÿåº¦
      setTimeout(handleImages, 20);
    });
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="å­è§„å…¥æ¢§æ¡" type="application/atom+xml">
</head>

    <body>
        <div class="paper">
            <div class="paper-main">
                <div class="header">
    <div class="header-content">
        <!-- å¤´åƒå’Œä¸»æ ‡é¢˜ä¸€èµ·å¯ç‚¹å‡» -->
        <a href="/" class="header-home-link">
            <div class="hero-header">
                <div class="hero-header-visual">
                    <div class="hero-header-graphic">
                        <img src="/img/favicon.png" alt="Logo" width="30" height="30">
                    </div>
                </div>
                <div class="hero-header-text">
                    <h1 class="hero-header-title">å­è§„å…¥æ¢§æ¡</h1>
                </div>
            </div>
        </a>
        <!-- å¯¼èˆªæ  -->
        <ul class="nav">
            
            <li>
                
                <a href="/" class="">
                   ä¸»é¡µ
                   
                </a>
            </li>
            
            <li>
                
                <a href="/archives" class="">
                   å½’æ¡£
                   
                </a>
            </li>
            
            <li>
                
                <a href="/about" class="">
                   å…³äº
                   
                </a>
            </li>
            
            <li>
                
                <a href="/use" class="">
                   è®¾å¤‡
                   
                </a>
            </li>
            
            <li>
                
                <a href="https://uhufoundme.sol.build/" class="" target="&quot;_blank&quot;" rel="&quot;noopener" noreferrer&#34;="">
                   ç¢ç¢å¿µ
                   
                   <span class="external-link-icon">ğŸ”—</span>
                   
                </a>
            </li>
            
        </ul>
    </div>
</div>

                <div class="post-main">
    <!-- é˜…è¯»è¿›åº¦æ¡ -->
    <div class="reading-progress-bar" id="readingProgressBar"></div>
    
    
        <div class="post-main-title">
            èŠèŠJava IOçš„é‚£äº›äº‹
        </div>
        <div class="post-meta">
            2024-12-01 ï½œ 
            
                <a href="/tags/java/"># java</a>
            
                <a href="/tags/IO/"># IO</a>
            
                <a href="/tags/NIO/"># NIO</a>
            
                <a href="/tags/BIO/"># BIO</a>
            
        </div>

        <div class="post-content-wrapper">
            <div class="post-content-main">
                <div class="post-md">
                    <table>
<thead>
<tr>
<th align="center"></th>
<th align="center">BIO</th>
<th align="center">NIO</th>
<th align="center">AIO</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IOæ¨¡å‹</td>
<td align="center">åŒæ­¥é˜»å¡</td>
<td align="center">åŒæ­¥éé˜»å¡ï¼ˆå¤šè·¯å¤ç”¨ï¼‰</td>
<td align="center">å¼‚æ­¥éé˜»å¡</td>
</tr>
<tr>
<td align="center">ç¼–ç¨‹éš¾åº¦</td>
<td align="center">ç®€å•</td>
<td align="center">å¤æ‚</td>
<td align="center">å¤æ‚</td>
</tr>
<tr>
<td align="center">å¯é æ€§</td>
<td align="center">å·®</td>
<td align="center">å¥½</td>
<td align="center">å¥½</td>
</tr>
<tr>
<td align="center">ååé‡</td>
<td align="center">ä½</td>
<td align="center">é«˜</td>
<td align="center">é«˜</td>
</tr>
</tbody></table>
<h1 id="é˜…å‰é¡»çŸ¥"><a href="#é˜…å‰é¡»çŸ¥" class="headerlink" title="é˜…å‰é¡»çŸ¥"></a>é˜…å‰é¡»çŸ¥</h1><p><code>é˜»å¡ IO</code> å’Œ <code>éé˜»å¡ IO</code></p>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ <code>ç¨‹åºçº§åˆ«</code> çš„ã€‚ä¸»è¦æè¿°æ˜¯ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»Ÿ IO æ“ä½œä¹‹åï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆç¨‹åºå¦‚ä½•å¤„ç†é—®é¢˜ï¼šå‰è€…ç­‰å¾…ï¼Œåè€…ç»§ç»­æ‰§è¡Œï¼ˆå¹¶ä¸”ä½¿ç”¨çº¿ç¨‹ä¸€ç›´è½®è¯¢ï¼Œç›´åˆ°æœ‰ IO èµ„æºå‡†å¤‡å¥½ï¼‰</p>
<p><code>åŒæ­¥ IO </code> å’Œ <code>éåŒæ­¥IO</code></p>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯<code>æ“ä½œç³»ç»Ÿçº§åˆ«</code>çš„ã€‚ä¸»è¦æè¿°çš„æ˜¯æ“ä½œç³»ç»Ÿåœ¨æ”¶åˆ°ç¨‹åºè¯·æ±‚ IO æ“ä½œåï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¯¥å¦‚ä½•ç›¸åº”ç¨‹åºçš„é—®é¢˜ï¼šå‰è€…ä¸å“åº”ï¼Œåè€…è¿”å›ä¸€ä¸ªæ ‡è®°ï¼Œå½“ IO èµ„æºå‡†å¤‡å¥½ä¹‹åï¼Œåœ¨ç”¨äº‹ä»¶æœºåˆ¶è¿”å›ç»™ç¨‹åºã€‚</p>
<h1 id="ä¸€ã€BIOï¼ˆBlocking-I-Oï¼‰"><a href="#ä¸€ã€BIOï¼ˆBlocking-I-Oï¼‰" class="headerlink" title="ä¸€ã€BIOï¼ˆBlocking I/Oï¼‰"></a>ä¸€ã€BIOï¼ˆBlocking I/Oï¼‰</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Java BIOï¼šåŒæ­¥å¹¶é˜»å¡ï¼ˆä¼ ç»Ÿé˜»å¡æ€§ï¼‰ï¼Œåº”ç”¨ç¨‹åºä¸­è¿›ç¨‹åœ¨å‘èµ· IO è°ƒç”¨åè‡³å†…æ ¸æ‰§è¡Œ IO æ“ä½œè¿”å›ç»“æœä¹‹å‰ï¼Œè‹¥å‘èµ·ç³»ç»Ÿè°ƒç”¨çš„çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåˆ™æ­¤æ¬¡ IO æ“ä½œä¸ºé˜»å¡ IOã€‚é˜»å¡ IO ç®€ç§° BIOï¼ŒBlocking IOã€‚</p>
<p>ä»¥å‰å¤§å¤šæ•°ç½‘ç»œé€šä¿¡æ–¹å¼éƒ½æ˜¯é˜»å¡æ¨¡å¼ï¼Œå³ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚åï¼Œå®¢æˆ·ç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼ˆä¸ä¼šå†åšå…¶ä»–äº‹æƒ…ï¼‰ï¼Œç›´åˆ°æœåŠ¡å™¨ç«¯è¿”å›ç»“æœæˆ–è€…ç½‘ç»œå‡ºç°é—®é¢˜ã€‚</li>
<li>æœåŠ¡ç«¯åŒæ ·çš„ï¼Œå½“åœ¨å¤„ç†æŸä¸ªå®¢æˆ·ç«¯ A å‘æ¥çš„è¯·æ±‚æ˜¯ï¼Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯ B å‘æ¥çš„è¯·æ±‚ä¼šç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å™¨ç«¯çš„è¿™ä¸ªå¤„ç†çº¿ç¨‹å®Œæˆä¸Šä¸ªå¤„ç†ã€‚</li>
</ul>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/acea8af4268c8d552741ccebcb2d34ec_MD5.png" loading="lazy" class="lazy-image"></div></p>
<h2 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h2><ol>
<li>æœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ª ServerSocketã€‚</li>
<li>å®¢æˆ·ç«¯å¯åŠ¨ Socket å¯¹æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹æœåŠ¡å™¨ç«¯éœ€è¦å¯¹æ¯ä¸ªå®¢æˆ·å»ºç«‹ä¸€ä¸ªçº¿ç¨‹ä¸ä¹‹é€šè®¯ã€‚</li>
<li>å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå…ˆå’¨è¯¢æœåŠ¡å™¨æ˜¯å¦æœ‰çº¿ç¨‹å“åº”ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šç­‰å¾…ï¼Œæˆ–è€…è¢«æ‹’ç»ã€‚</li>
<li>å¦‚æœæœ‰å“åº”ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹ä¼šç­‰å¾…è¯·æ±‚ç»“æŸåï¼Œå†ç»§ç»­æ‰§è¡Œã€‚</li>
</ol>
<pre><code class="language-java">package com.atguigu.bio;

import java.io.InputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class BIOServer {
    
    public static void main(String[] args) throws Exception {
        //çº¿ç¨‹æ± æœºåˆ¶
        //æ€è·¯
        //1. åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± 
        //2. å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯(å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•)
        ExecutorService newCachedThreadPool = Executors.newCachedThreadPool();
        //åˆ›å»ºServerSocket
        ServerSocket serverSocket = new ServerSocket(6666);
        System.out.println("æœåŠ¡å™¨å¯åŠ¨äº†");
        while (true) {
            System.out.println("çº¿ç¨‹ä¿¡æ¯id = " + Thread.currentThread().getId() + "åå­— = " + Thread.currentThread().getName());
            //ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥
            System.out.println("ç­‰å¾…è¿æ¥....");
            //ä¼šé˜»å¡åœ¨accept()
            final Socket socket = serverSocket.accept();
            System.out.println("è¿æ¥åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯");
            //å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯(å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•)
            newCachedThreadPool.execute(new Runnable() {
                public void run() {//æˆ‘ä»¬é‡å†™
                    //å¯ä»¥å’Œå®¢æˆ·ç«¯é€šè®¯
                    handler(socket);
                }
            });
        } 
    }
    
    //ç¼–å†™ä¸€ä¸ªhandleræ–¹æ³•ï¼Œå’Œå®¢æˆ·ç«¯é€šè®¯
    public static void handler(Socket socket) {
        try {
            System.out.println("çº¿ç¨‹ä¿¡æ¯id = " + Thread.currentThread().getId() + "åå­— = " + Thread.currentThread().getName());
            byte[] bytes = new byte[1024];
            //é€šè¿‡socketè·å–è¾“å…¥æµ
            InputStream inputStream = socket.getInputStream();
            //å¾ªç¯çš„è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
            while (true) {
                System.out.println("çº¿ç¨‹ä¿¡æ¯id = " + Thread.currentThread().getId() + "åå­— = " + Thread.currentThread().getName());
                System.out.println("read....");
                int read = inputStream.read(bytes);
                if (read != -1) {
                    System.out.println(new String(bytes, 0, read));//è¾“å‡ºå®¢æˆ·ç«¯å‘é€çš„æ•°æ®
                } else {
                    break;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            System.out.println("å…³é—­å’Œclientçš„è¿æ¥");
            try {
                socket.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ä¼ ç»Ÿçš„ IO æ¨¡å‹ï¼Œå…¶ä¸»è¦æ˜¯ä¸€ä¸ª Server å¯¹æ¥ N ä¸ªå®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥ä¹‹åï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªå­çº¿ç¨‹ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/0fb77c535fcbf8f4264b6eff292fd210_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¼ ç»Ÿ IO çš„ç‰¹ç‚¹åœ¨äºï¼š</p>
<ul>
<li>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°è¾¾æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šåˆ†é…ä¸€ä¸ªçº¿ç¨‹ç»™è¯¥å®¢æˆ·ç«¯ï¼Œè¯¥çº¿ç¨‹å¤„ç†åŒ…æ‹¬è¯»å–æ•°æ®ï¼Œè§£ç ï¼Œä¸šåŠ¡è®¡ç®—ï¼Œç¼–ç ï¼Œä»¥åŠå‘é€æ•°æ®æ•´ä¸ªè¿‡ç¨‹</li>
<li>åŒä¸€æ—¶åˆ»ï¼ŒæœåŠ¡ç«¯çš„ååé‡ä¸æœåŠ¡å™¨æ‰€æä¾›çš„çº¿ç¨‹æ•°é‡å‘ˆçº¿æ€§å…³ç³»çš„ã€‚</li>
</ul>
<p>å¦‚æœå¹¶å‘é‡ä¸å¤§ï¼Œè¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæµ·é‡å¹¶å‘æ—¶å€™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼š</p>
<ol>
<li>æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»ºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸å¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®çš„Readï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®Writeã€</li>
<li>å½“å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œéœ€è¦åˆ›å»ºå¤§é‡çº¿ç¨‹å¤„ç†è¿æ¥ï¼Œèµ„æºå ç”¨è¾ƒå¤§ã€‚</li>
<li>è¿æ¥å»ºç«‹åï¼Œå¦‚æœå½“å‰çº¿ç¨‹å±•ç¤ºæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™çº¿ç¨‹å°±é˜»å¡åœ¨Readæ“ä½œä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ã€‚</li>
</ol>
<h2 id="æ”¹è¿›ï¼šå¤šçº¿ç¨‹æ–¹å¼-ä¼ªå¼‚æ­¥æ–¹å¼"><a href="#æ”¹è¿›ï¼šå¤šçº¿ç¨‹æ–¹å¼-ä¼ªå¼‚æ­¥æ–¹å¼" class="headerlink" title="æ”¹è¿›ï¼šå¤šçº¿ç¨‹æ–¹å¼ - ä¼ªå¼‚æ­¥æ–¹å¼"></a>æ”¹è¿›ï¼šå¤šçº¿ç¨‹æ–¹å¼ - ä¼ªå¼‚æ­¥æ–¹å¼</h2><p>ä¸Šè¿°è¯´çš„æƒ…å†µåªæ˜¯æœåŠ¡å™¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚æœå¼•å…¥å¤šçº¿ç¨‹æ˜¯ä¸æ˜¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯ X çš„è¯·æ±‚åï¼Œï¼ˆè¯»å–åˆ°æ‰€æœ‰çš„è¯·æ±‚æ•°æ®åï¼‰å°†è¿™ä¸ªè¯·æ±‚é€å…¥åˆ°ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œç„¶åä¸»çº¿ç¨‹ç»§ç»­æ¥æ”¶å®¢æˆ·ç«¯ Y çš„è¯·æ±‚ã€‚</li>
<li>å®¢æˆ·ç«¯ä¾§ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªå­çº¿ç¨‹å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·å®¢æˆ·ç«¯ä¸»çº¿ç¨‹çš„å…¶ä»–å·¥ä½œä¸å—å½±å“ï¼Œå½“æœåŠ¡å™¨æœ‰å“åº”ä¿¡æ¯æ—¶å€™å†æœ‰è¿™ä¸ªå­çº¿ç¨‹é€šè¿‡ <code>ç›‘å¬æ¨¡å¼/è§‚å¯Ÿæ¨¡å¼</code>ï¼ˆç­‰å…¶ä»–è®¾è®¡æ¨¡å¼ï¼‰é€šçŸ¥ä¸»çº¿ç¨‹ã€‚</li>
</ul>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/ed84ace61748c9dbdaf3f9718f21ff21_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>ä½†æ˜¯å¤šçº¿ç¨‹è§£å†³è¿™ä¸ªé—®é¢˜æœ‰å±€é™æ€§ï¼š</p>
<ul>
<li>æ“ä½œç³»ç»Ÿé€šçŸ¥accept() çš„æ–¹å¼è¿˜æ˜¯å•ä¸ªï¼Œå³ï¼šæœåŠ¡å™¨æ”¶åˆ°æ•°æ®æŠ¥æ–‡ä¹‹åçš„â€œä¸šåŠ¡å¤„ç†è¿‡ç¨‹â€å¯ä»¥å¤šçº¿ç¨‹ï¼Œä½†æ˜¯æŠ¥æ–‡çš„æ¥æ”¶è¿˜æ˜¯éœ€è¦ä¸€ä¸ªä¸ªæ¥</li>
<li>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ˜¯æœ‰é™çš„ã€‚çº¿ç¨‹è¶Šå¤šï¼ŒCPU åˆ‡æ¢æ‰€éœ€æ—¶é—´ä¹Ÿè¶Šé•¿ï¼Œç”¨æ¥å¤„ç†çœŸæ­£ä¸šåŠ¡çš„éœ€æ±‚ä¹Ÿå°±è¶Šå°‘ã€‚</li>
<li>åˆ›å»ºçº¿ç¨‹éœ€è¦è¾ƒå¤§çš„èµ„æºæ¶ˆè€—ã€‚JVM åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä½¿ä¸è¿›è¡Œä»»ä½•å·¥ä½œï¼Œä¹Ÿéœ€è¦åˆ†é…ä¸€ä¸ªå †æ ˆç©ºé—´ï¼ˆ128kï¼‰ã€‚</li>
<li>å¦‚æœç¨‹åºä¸­ä½¿ç”¨äº†å¤§é‡çš„é•¿è¿æ¥ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šå…³é—­çš„ï¼Œèµ„æºæ¶ˆè€—æ›´å®¹æ˜“å¤±æ§ã€‚</li>
</ul>
<blockquote>
<p>ä¸ºå•¥ <code>serverSocket. accept()</code> ä¼šå‡ºç°é˜»å¡ï¼Ÿ</p>
</blockquote>
<p>æ˜¯å› ä¸º Java é€šè¿‡ JNI è°ƒç”¨çš„ç³»ç»Ÿå±‚é¢çš„ <code>accept0()</code> æ–¹æ³•ï¼Œ<code>accept0()</code> è§„å®šå¦‚æœå‘ç°å¥—é—´å­—ä»æŒ‡å®šçš„ç«¯å£æ¥ï¼Œå°±ä¼šç­‰å¾…ã€‚å…¶å®å°±æ˜¯å†…éƒ¨å®ç°æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŒæ­¥ IOã€‚</p>
<h1 id="äºŒã€NIOï¼ˆnon-Blocking-I-Oï¼‰"><a href="#äºŒã€NIOï¼ˆnon-Blocking-I-Oï¼‰" class="headerlink" title="äºŒã€NIOï¼ˆnon-Blocking I/Oï¼‰"></a>äºŒã€NIOï¼ˆnon-Blocking I/Oï¼‰</h1><p>äº†è§£ NIO ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ ‡å‡† I/Oï¼ˆStandard I/Oï¼‰ã€‚</p>
<p>Standard I/O æ˜¯å¯¹å­—èŠ‚çš„è¯»å†™ï¼Œåœ¨è¿›è¡Œ I/O ä¹‹å‰ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæµå¯¹è±¡ï¼Œæµå¯¹è±¡çš„è¯»å†™æ“ä½œéƒ½æ˜¯æŒ‰å­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»æˆ–è€…å†™ã€‚è€Œ NIO æŠŠ I/O æŠ½è±¡æˆå—ï¼Œç±»ä¼¼ç£ç›˜çš„è¯»å†™ï¼Œæ¯æ¬¡ I/O æ“ä½œçš„å•ä½éƒ½æ˜¯ä¸€ä¸ªå—ï¼Œå—è¢«è¯»å…¥å†…å­˜ä¹‹åå°±æ˜¯ä¸€ä¸ª <code> byte[]</code>ï¼ŒNIO ä¸€æ¬¡å¯ä»¥è¯»æˆ–è€…å†™å¤šä¸ªå­—èŠ‚ã€‚</p>
<h2 id="æµå’Œå—"><a href="#æµå’Œå—" class="headerlink" title="æµå’Œå—"></a>æµå’Œå—</h2><p>IO å’Œ NIO æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯å¯¹æ•°æ®çš„æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒIO æ˜¯ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p>
<p>é¢å‘æµçš„ IO ä¸€æ¬¡æ€§å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ IO é€šå¸¸å¤„ç†éå¸¸æ…¢ã€‚</p>
<p>é¢å‘å—çš„ I/O ä¸€æ¬¡æ€§å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼šæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«çš„å¤šï¼Œä½†æ˜¯é¢å‘å—çš„ I/O ç¡®å®ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…å’Œç®€å•ã€‚</p>
<p>I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½çš„é›†æˆäº†ï¼Œ<code>java.io.*</code> ä¸­å·²ç»ä»¥ NIO é‡æ–°å®ç°äº†ï¼Œå¯ä»¥åˆ©ç”¨ä¸€äº› NIO çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼šåœ¨ <code>java.io.*</code> ä¸­æŸäº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ“ä½œï¼Œè¿™ä½¿å¾—åŠæ—¶åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†æ•°æ®ä¹Ÿä¼šæ›´å¿«ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ-1"><a href="#åŸºæœ¬æ¦‚å¿µ-1" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Java NIOï¼šåŒæ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚ï¼ˆè¿æ¥ï¼‰ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è®­åˆ°è¿æ¥æœ‰ I/O è¯·æ±‚å°±è¿›è¡Œå¤„ç†ã€‚</p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong></p>
<ol>
<li><strong>ä¸‰å¤§æ ¸å¿ƒï¼š</strong> Channelï¼ˆé€šé“ï¼‰ã€Bufferï¼ˆç¼“å†²åŒºï¼‰ã€Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ã€‚</li>
<li><strong>é¢å‘ç¼“å†²åŒºï¼Œæˆ–è€…æ˜¯é¢å‘å—ç¼–ç¨‹ã€‚</strong> æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åç§»åŠ¨ï¼Œè¿™å°±å¢åŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ï¼Œä½¿ç”¨å®ƒå¯ä»¥æä¾›éé˜»å¡å¼çš„é«˜ä¼¸ç¼©å¼¹æ€§ç½‘ç»œã€‚</li>
<li><strong>éé˜»å¡æ¨¡å¼</strong>ï¼Œ ä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸä¸ªé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯ä»–ä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ã€‚æ‰€ä»¥çŸ¥é“æ•°æ®å˜å¾—å¯è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹è¿˜å¯ä»¥å»åšå…¶ä»–å®è¡Œã€‚</li>
<li><strong>Channel å’Œ Buffer ä¸€ä¸€å¯¹åº”ã€‚</strong></li>
<li><strong>ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ª Selectorï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”å¯¹ä¸ª Channelï¼ˆè¿æ¥ï¼‰</strong>ã€‚</li>
<li>ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ª Channel æ˜¯ç”±äº‹ä»¶å†³å®šï¼ŒEvent å°±æ˜¯ä¸ªé‡è¦æ¦‚å¿µã€‚</li>
<li>Selector ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢ã€‚</li>
<li><strong>Buffer æ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚å°±æ˜¯ä¸€ä¸ªæ•°ç»„</strong>ã€‚</li>
<li>æ•°æ®è¯»å†™éƒ½æ˜¯é€šè¿‡ Bufferï¼ŒåŒºåˆ«äº BIO çš„è¾“å…¥è¾“å‡ºæµï¼Œä¸”<strong>åŒå‘</strong>ï¼Œéœ€è¦ <code>flip</code> æ–¹æ³•åˆ‡æ¢ <code>Channel</code> æ˜¯åŒå‘çš„ ã€‚</li>
</ol>
<h2 id="ç¼–ç¨‹åŸç†"><a href="#ç¼–ç¨‹åŸç†" class="headerlink" title="ç¼–ç¨‹åŸç†"></a>ç¼–ç¨‹åŸç†</h2><ol>
<li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡ ServerSocketChannel å¾—åˆ° SocketChannelã€‚</li>
<li>Selector è¿›è¡Œç›‘å¬ select æ–¹æ³•ï¼Œè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“ä¸ªæ•°ã€‚</li>
<li>å°† SocketChannel æ³¨å†Œåˆ° Selector ä¸Šï¼ˆ<code>register(Selector selector, int ops)</code>ï¼‰ï¼Œä¸€ä¸ª Selector å¯ä»¥æ³¨å†Œå¤šä¸ª SocketChannelã€‚</li>
<li>æ³¨å†Œåè¿”å› SelectionKeyï¼Œä¼šå’Œè¯¥ Selector å…³è”ï¼ˆé›†åˆï¼‰ã€‚</li>
<li>å½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿›ä¸€æ­¥å¾—åˆ°å„ä¸ª SelectionKeyã€‚</li>
<li>é€šè¿‡channel () æ–¹æ³•ï¼Œç”¨ SelectionKey åå‘è·å– SocketChannelã€‚</li>
<li>å¯ä»¥é€šè¿‡å¾—åˆ°çš„ channelï¼Œå®Œæˆä¸šåŠ¡å¤„ç†ã€‚</li>
</ol>
<h2 id="1-ç¼“å†²åŒºï¼ˆBufferï¼‰"><a href="#1-ç¼“å†²åŒºï¼ˆBufferï¼‰" class="headerlink" title="1. ç¼“å†²åŒºï¼ˆBufferï¼‰"></a>1. ç¼“å†²åŒºï¼ˆBufferï¼‰</h2><h3 id="Buffer-ç±»åŠå…¶å­ç±»"><a href="#Buffer-ç±»åŠå…¶å­ç±»" class="headerlink" title="Buffer ç±»åŠå…¶å­ç±»"></a>Buffer ç±»åŠå…¶å­ç±»</h3><p><code>ByteBuffer</code> å­—èŠ‚æ•°æ®ï¼›<code>ShortBuffer</code> å­—ç¬¦ä¸²æ•°æ®ï¼›<code>CharBuffer</code> å­—ç¬¦æ•°æ®ï¼›<code>IntBuffer</code> æ•´æ•°ï¼›<code>LongBuffer</code> é•¿æ•´æ•°ï¼›<code>DoubleBuffer</code> å°æ•°ï¼›<code>FloatBuffer</code> å°æ•°</p>
<h3 id="Buffer-å±æ€§å’Œæ–¹æ³•"><a href="#Buffer-å±æ€§å’Œæ–¹æ³•" class="headerlink" title="Buffer å±æ€§å’Œæ–¹æ³•"></a>Buffer å±æ€§å’Œæ–¹æ³•</h3><p>Buffer ç±»æä¾›äº† 4 ä¸ªå±æ€§æ¥æä¾›æ•°æ®å…ƒç´ ä¿¡æ¯ï¼š<code>capacityï¼ˆå®¹é‡ï¼‰</code>ï¼šç¼“å­˜åŒºçš„æœ€å¤§å®¹é‡ï¼Œ<code>Limitï¼ˆç»ˆç‚¹ï¼‰</code>ï¼šç¼“å­˜åŒºæœ€å¤§å¯æ“ä½œä½ç½®ï¼Œ<code>Positionï¼ˆä½ç½®ï¼‰</code> ï¼šç¼“å­˜åŒºå½“å‰åœ¨æ“ä½œçš„ä½ç½®ï¼Œ<code>Markï¼ˆæ ‡è®°ï¼‰</code>ï¼šæ ‡è®°ä½ç½®</p>
<pre><code class="language-java">public abstract class Buffer{
	public final int capacity();
	public final int position();
	public final Buffer position(int newPosition);
	public final int limit();
	public final Buffer limit(int newLimit);
	
}
//å…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å°±æ˜¯ByteBufferï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œè¯¥ç±»ä¸»è¦æœ‰ä»¥ä¸‹æ–¹æ³•
public abstract class ByteBuffer(){
	public static ByteBuffer allocateDirect(int capacity);//ç›´æ¥åˆ›å»ºç¼“å†²åŒº
	public static ByteBuffer allocate(int capacity);//è®¾ç½®ç¼“å†²åŒºçš„åˆå§‹å®¹é‡
	public static ByteBuffer wrap(byte[] array);//æŠŠä¸€ä¸ªæ•°ç»„æ”¾å…¥åˆ°ç¼“å†²åŒºä½¿ç”¨
	//æ„é€ åˆå§‹åŒ–ä½ç½®offsetå’Œä¸Šç•Œlengthçš„ç¼“å†²åŒº
	public static ByteBuffer wrap(byte[] array,int offset,int length);
	//ç¼“å†²åŒºè¯»å–ç›¸å…³API
	public abstract byte get();//ä»å½“å‰ä½ç½®positionä¸Šgetï¼Œgetä¹‹åï¼Œpositonä¼š+1
	public abstract byte get(int index);//ä»ç»å¯¹ä½ç½®è·å–
	public abstract ByteBuffer put(byte b);//å½“å‰ä½ç½®ä¸Šputï¼Œputä¹‹åï¼Œpositionä¼š+1
	public abstract ByteBuffer put(int index,byte b);//ä»ç»å¯¹ä½ç½®put	
}
</code></pre>
<p>çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹:</p>
<p>â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/a8f0d4502adb087892e11866bdac7d57_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ç§»åŠ¨è®¾ç½®ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/5ee1af7a6012fd34b62704d5b2867320_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/5cd2995739f1b0e1f4b355a2471c38aa_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/0d87f8ba4e770fbdcd6c6fc61fb84862_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>â‘¤ æœ€åéœ€è¦è°ƒç”¨ clear() æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/f6ef08bdd8b4ff67a419bfe9b7dbc0f2_MD5.png" loading="lazy" class="lazy-image"></div></p>
<h3 id="æ–‡ä»¶-NIO-å®ä¾‹"><a href="#æ–‡ä»¶-NIO-å®ä¾‹" class="headerlink" title="æ–‡ä»¶ NIO å®ä¾‹"></a>æ–‡ä»¶ NIO å®ä¾‹</h3><p>ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š</p>
<pre><code class="language-java">public static void fastCopy(String src, String dist) throws IOException {

    /* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */
    FileInputStream fin = new FileInputStream(src);

    /* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */
    FileChannel fcin = fin.getChannel();

    /* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */
    FileOutputStream fout = new FileOutputStream(dist);

    /* è·å–è¾“å‡ºå­—èŠ‚æµçš„é€šé“ */
    FileChannel fcout = fout.getChannel();

    /* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */
    ByteBuffer buffer = ByteBuffer.allocateDirect(1024);

    while (true) {

        /* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */
        int r = fcin.read(buffer);

        /* read() è¿”å› -1 è¡¨ç¤º EOF */
        if (r == -1) {
            break;
        }

        /* åˆ‡æ¢è¯»å†™ */
        buffer.flip();

        /* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */
        fcout.write(buffer);
        
        /* æ¸…ç©ºç¼“å†²åŒº */
        buffer.clear();
    }
}
</code></pre>
<h2 id="2-é€šé“ï¼ˆChannelï¼‰"><a href="#2-é€šé“ï¼ˆChannelï¼‰" class="headerlink" title="2. é€šé“ï¼ˆChannelï¼‰"></a>2. é€šé“ï¼ˆChannelï¼‰</h2><p>é€šé“ç±»ä¼¼æµï¼Œä½†æ˜¯æœ‰å¦‚ä¸‹åŒºåˆ«ï¼š</p>
<ul>
<li>é€šé“å¯ä»¥åŒæ—¶è¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–å†™</li>
<li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li>
<li>é€šé“å¯ä»¥ä»ç¼“å†²åŒºè¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²åŒº</li>
</ul>
<h3 id="é€šé“åˆ†ç±»"><a href="#é€šé“åˆ†ç±»" class="headerlink" title="é€šé“åˆ†ç±»"></a>é€šé“åˆ†ç±»</h3><p>Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæ¥å£ <code>public interface Channle extends Closeable{}</code>ã€‚å…¶ä¸­ï¼Œå¸¸ç”¨çš„ Channel ç±»æœ‰ï¼š</p>
<ol>
<li><code>FileChannel</code>ï¼šç”¨äºæ–‡ä»¶çš„æ•°æ®è¯»å†™ï¼›</li>
<li><code>DatagramChannel</code>ï¼šç”¨äº UDP çš„æ•°æ®è¯»å†™ï¼›</li>
<li><code>ServerSocketChannel</code>ï¼šå¯ä»¥ç›‘å¬æ–°æ¥çš„è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚åªæœ‰é€šè¿‡è¿™ä¸ªé€šé“ï¼Œåº”ç”¨ç¨‹åºæ‰èƒ½ç®±æ“ä½œç³»ç»Ÿæ³¨å†Œæ”¯æŒâ€œå¤šè·¯å¤ç”¨ IOâ€çš„ç«¯å£å‡è½»ã€‚æ”¯æŒ TCP å’Œ UDP åè®®ï¼›</li>
<li><code>SocketChannel</code>ï¼šTCP Socket å¥—æ¥å­—çš„ç›‘å¬é€šé“ï¼Œç”¨äº TCP çš„æ•°æ®è¯»å†™</li>
<li>å…¶ä»–çš„é€šé“åŒ…æ‹¬ï¼š</li>
</ol>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/94530647a3be7da4d2de055fff8bacaf_MD5.png" loading="lazy" class="lazy-image"></div></p>
<h3 id="FileChannel-ç±»"><a href="#FileChannel-ç±»" class="headerlink" title="FileChannel ç±»"></a>FileChannel ç±»</h3><p>å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œ IO æ“ä½œï¼Œå¸¸ç”¨æ–¹æ³•åŠå®ä¾‹åº”ç”¨ï¼š</p>
<pre><code class="language-java">//ä»é€šé“è¯»å–æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºå†…
public int read(ByteBuffer content);
//ä»ç¼“å†²åŒºå†™æ•°æ®åˆ°é€šé“ä¸­
public int write(ByteBuffer content);
//ä»ç›®æ ‡é€šé“ä¸­å¤åˆ¶æ•°æ®åˆ°å½“å‰é€šé“å†…
public long transferFrom(ReadableByteChannel src,long position,long count);
//æŠŠæ•°æ®ä»å½“å‰é€šé“å¤åˆ¶åˆ°ç›®æ ‡é€šé“
public long transferTo(long position,long count,WritabelByteChannel target);
</code></pre>
<p>1 . å†™å…¥æ–‡ä»¶ï¼Œä½¿ç”¨ä¹‹å‰ <code>ByteBuffer</code> å’Œ <code>FileChannel</code> ç±»</p>
<pre><code class="language-java">//ä½¿ç”¨ä¹‹å‰ByteBufferå’ŒFileChannelç±»ï¼Œå†™å…¥æ–‡ä»¶
import java.io.FileOutputStream;
import java.nio.ByteBuffer;
import java.nio.channels.FileChannel;

public class NIOFileChannel{
	public static void main(String[] args) throws Exception{
		String str = "hello,world";
		//åˆ›ä¸€ä¸ªè¾“å‡ºæµ -&gt; channel
		FileOutputStream stream = new FileOutputStream("d:\\file.txt");
		//é€šè¿‡ stream è·å–å¯¹åº”çš„ FileChannel
		//è¿™ä¸ª fileChannel çœŸå®ç±»å‹æ˜¯ FileChannelImpl
		FileChannel fileChannel = stream.getChannel();

		//åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer
		ByteBuffer byteBuffer = ByteBuffer.allocate(1024);
		//å°† str æ”¾å…¥åˆ°ç¼“å†²åŒº
		byteBuffer.put(str.getBytes());
		//å¯¹ byteBuffer è¿›è¡Œ flip
		byteBuffer.flip();

		//å°† byteBuffer å†™å…¥åˆ° fileChannel
		fileChannel.write(byteBuffer);
		fileOutputStream.close();
	}

}
</code></pre>
<p>2 . è¯»å–æ–‡ä»¶æ•°æ®å¹¶å±•ç¤ºï¼Œä½¿ç”¨ä¹‹å‰ <code>ByteBuffer</code> å’Œ <code>FileChannel</code> ç±»</p>
<pre><code class="language-java">//è¯»å–æœ¬åœ°æ–‡ä»¶
import java.io.FileOutputStream;
import java.nio.ByteBuffer;
import java.nio.channels.FileChannel;

public class NIOFileChannel{
	public static void main(String[] args) throws Exception{
		//åˆ›ä¸€ä¸ªè¾“å‡ºæµ -&gt; channel
		File file = new File("d:\\file.txt");
		FileOutputStream stream = new FileOutputStream(file);
		//é€šè¿‡ stream è·å–å¯¹åº”çš„ FileChannel
		//è¿™ä¸ª fileChannel çœŸå®ç±»å‹æ˜¯ FileChannelImpl
		FileChannel fileChannel = stream.getChannel();

		//åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer
		ByteBuffer byteBuffer = ByteBuffer.allocate((int)file.length());

		//å°† byteBuffer å†™å…¥åˆ° fileChannel
		fileChannel.read(byteBuffer);
		//å°† byteBufferçš„å­—èŠ‚è½¬åŒ–æˆString
		System.out.println(new String(byteBuffer.array()));
		fileOutputStream.close();
	}

}
</code></pre>
<p>3 . ä½¿ç”¨ä¸€ä¸ª <code>Buffer</code> å®Œæˆæ–‡ä»¶çš„è¯»å–ã€å†™å…¥</p>
<pre><code class="language-java">import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.nio.ByteBuffer;
import java.nio.channels.FileChannel;

public class NIOFileChannel03 {

    public static void main(String[] args) throws Exception {

        FileInputStream fileInputStream = new FileInputStream("1.txt");
        FileChannel fileChannel01 = fileInputStream.getChannel();
        FileOutputStream fileOutputStream = new FileOutputStream("2.txt");
        FileChannel fileChannel02 = fileOutputStream.getChannel();

        ByteBuffer byteBuffer = ByteBuffer.allocate(512);
        
        while (true) { //å¾ªç¯è¯»å–

            //è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„æ“ä½œï¼Œä¸€å®šä¸è¦å¿˜äº†
            /*
            public final Buffer clear() {
                position = 0;
                limit = capacity;
                mark = -1;
                return this;
            }
            */
            byteBuffer.clear(); //æ¸…ç©º buffer
            int read = fileChannel01.read(byteBuffer);
            System.out.println("read = " + read);
            if (read == -1) { //è¡¨ç¤ºè¯»å®Œ
                break;
            }

            //å°† buffer ä¸­çš„æ•°æ®å†™å…¥åˆ° fileChannel02--2.txt
            byteBuffer.flip();
            fileChannel02.write(byteBuffer);
        }

        //å…³é—­ç›¸å…³çš„æµ
        fileInputStream.close();
        fileOutputStream.close();
    }
}
</code></pre>
<p>4 . æ‹·è´æ–‡ä»¶transferFrom æ–¹æ³•</p>
<pre><code class="language-java">import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.nio.channels.FileChannel;

public class NIOFileChannel04 {

    public static void main(String[] args) throws Exception {

        //åˆ›å»ºç›¸å…³æµ
        FileInputStream fileInputStream = new FileInputStream("d:\\a.jpg");
        FileOutputStream fileOutputStream = new FileOutputStream("d:\\a2.jpg");
        
        //è·å–å„ä¸ªæµå¯¹åº”çš„ FileChannel
        FileChannel sourceCh = fileInputStream.getChannel();
        FileChannel destCh = fileOutputStream.getChannel();

        //ä½¿ç”¨ transferForm å®Œæˆæ‹·è´
        destCh.transferFrom(sourceCh, 0, sourceCh.size());

        //å…³é—­ç›¸å…³é€šé“å’Œæµ
        sourceCh.close();
        destCh.close();
        fileInputStream.close();
        fileOutputStream.close();
    }
}
</code></pre>
<h3 id="Buffer-å’Œ-Channel-æ³¨æ„äº‹é¡¹"><a href="#Buffer-å’Œ-Channel-æ³¨æ„äº‹é¡¹" class="headerlink" title="Buffer å’Œ Channel æ³¨æ„äº‹é¡¹"></a>Buffer å’Œ Channel æ³¨æ„äº‹é¡¹</h3><p><strong>1. ByteBuffer æ”¯æŒç±»å‹åŒ–çš„ put å’Œ getï¼Œput æ”¾ä»€ä¹ˆï¼Œget å–å‡ºä»€ä¹ˆï¼Œä¸ç„¶å‡ºç° BufferUnderflowException å¼‚å¸¸</strong></p>
<pre><code class="language-java">import java.nio.ByteBuffer;

public class NIOByteBufferPutGet {

    public static void main(String[] args) {
        
        //åˆ›å»ºä¸€ä¸ª Buffer
        ByteBuffer buffer = ByteBuffer.allocate(64);

        //ç±»å‹åŒ–æ–¹å¼æ”¾å…¥æ•°æ®
        buffer.putInt(100);
        buffer.putLong(9);
        buffer.putChar('å°š');
        buffer.putShort((short) 4);

        //å–å‡º
        buffer.flip();
        
        System.out.println();
        
        System.out.println(buffer.getInt());
        System.out.println(buffer.getLong());
        System.out.println(buffer.getChar());
        System.out.println(buffer.getShort());
    }
}
</code></pre>
<p><strong>2. æ™®é€š Buffer è½¬æˆåªè¯» Buffer</strong></p>
<pre><code class="language-java">
import java.nio.ByteBuffer;

public class ReadOnlyBuffer {

    public static void main(String[] args) {

        //åˆ›å»ºä¸€ä¸ª buffer
        ByteBuffer buffer = ByteBuffer.allocate(64);

        for (int i = 0; i &lt; 64; i++) {
            buffer.put((byte) i);
        }

        //è¯»å–
        buffer.flip();

        //å¾—åˆ°ä¸€ä¸ªåªè¯»çš„ Buffer
        ByteBuffer readOnlyBuffer = buffer.asReadOnlyBuffer();
        System.out.println(readOnlyBuffer.getClass());

        //è¯»å–
        while (readOnlyBuffer.hasRemaining()) {
            System.out.println(readOnlyBuffer.get());
        }

        readOnlyBuffer.put((byte) 100); //ReadOnlyBufferException
    }
}
</code></pre>
<p><strong>3. NIO ä¸­ MappedByteBufferï¼Œå¯ä»¥è®©æ–‡ä»¶ç›´æ¥åœ¨å †å¤–å†…å­˜ä¿®æ”¹</strong></p>
<pre><code class="language-java">
import java.io.RandomAccessFile;
import java.nio.MappedByteBuffer;
import java.nio.channels.FileChannel;

/**
 * è¯´æ˜ 1.MappedByteBuffer å¯è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ï¼ˆå †å¤–å†…å­˜ï¼‰ä¿®æ”¹,æ“ä½œç³»ç»Ÿä¸éœ€è¦æ‹·è´ä¸€æ¬¡
 */
public class MappedByteBufferTest {

    public static void main(String[] args) throws Exception {

        RandomAccessFile randomAccessFile = new RandomAccessFile("1.txt", "rw");
        //è·å–å¯¹åº”çš„é€šé“
        FileChannel channel = randomAccessFile.getChannel();

        /**
         * å‚æ•° 1:FileChannel.MapMode.READ_WRITE ä½¿ç”¨çš„è¯»å†™æ¨¡å¼
         * å‚æ•° 2ï¼š0ï¼šå¯ä»¥ç›´æ¥ä¿®æ”¹çš„èµ·å§‹ä½ç½®
         * å‚æ•° 3:5: æ˜¯æ˜ å°„åˆ°å†…å­˜çš„å¤§å°ï¼ˆä¸æ˜¯ç´¢å¼•ä½ç½®ï¼‰ï¼Œå³å°† 1.txt çš„å¤šå°‘ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜
         * å¯ä»¥ç›´æ¥ä¿®æ”¹çš„èŒƒå›´å°±æ˜¯ 0-5
         * å®é™…ç±»å‹ DirectByteBuffer
         */
        MappedByteBuffer mappedByteBuffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, 5);

        mappedByteBuffer.put(0, (byte) 'H');
        mappedByteBuffer.put(3, (byte) '9');
        mappedByteBuffer.put(5, (byte) 'Y');//IndexOutOfBoundsException

        randomAccessFile.close();
        System.out.println("ä¿®æ”¹æˆåŠŸ~~");
    }
}
</code></pre>
<ol start="4">
<li><strong>NIO è¿˜æ”¯æŒé€šè¿‡å¤šä¸ª Bufferï¼ˆå³ Bufferæ•°ç»„ï¼‰å®Œæˆè¯»å†™æ“ä½œï¼Œå³ Scattering å’Œ Gathering</strong></li>
</ol>
<pre><code class="language-java">import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.util.Arrays;

/**
 * Scatteringï¼šå°†æ•°æ®å†™å…¥åˆ° buffer æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ buffer æ•°ç»„ï¼Œä¾æ¬¡å†™å…¥ [åˆ†æ•£]
 * Gatheringï¼šä» buffer è¯»å–æ•°æ®æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ buffer æ•°ç»„ï¼Œä¾æ¬¡è¯»
 */
public class ScatteringAndGatheringTest {

    public static void main(String[] args) throws Exception {
        
        //ä½¿ç”¨ ServerSocketChannel å’Œ SocketChannel ç½‘ç»œ
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
        InetSocketAddress inetSocketAddress = new InetSocketAddress(7000);

        //ç»‘å®šç«¯å£åˆ° socketï¼Œå¹¶å¯åŠ¨
        serverSocketChannel.socket().bind(inetSocketAddress);

        //åˆ›å»º buffer æ•°ç»„
        ByteBuffer[] byteBuffers = new ByteBuffer[2];
        byteBuffers[0] = ByteBuffer.allocate(5);
        byteBuffers[1] = ByteBuffer.allocate(3);

        //ç­‰å®¢æˆ·ç«¯è¿æ¥ (telnet)
        SocketChannel socketChannel = serverSocketChannel.accept();

        int messageLength = 8; //å‡å®šä»å®¢æˆ·ç«¯æ¥æ”¶ 8 ä¸ªå­—èŠ‚

        //å¾ªç¯çš„è¯»å–
        while (true) {
            int byteRead = 0;

            while (byteRead &lt; messageLength) {
                long l = socketChannel.read(byteBuffers);
                byteRead += l; //ç´¯è®¡è¯»å–çš„å­—èŠ‚æ•°
                System.out.println("byteRead = " + byteRead);
                //ä½¿ç”¨æµæ‰“å°,çœ‹çœ‹å½“å‰çš„è¿™ä¸ª buffer çš„ position å’Œ limit
                Arrays.asList(byteBuffers).stream().map(buffer -&gt; "position = " + buffer.position() + ", limit = " + buffer.limit()).forEach(System.out::println);
            }

            //å°†æ‰€æœ‰çš„ buffer è¿›è¡Œ flip
            Arrays.asList(byteBuffers).forEach(buffer -&gt; buffer.flip());
            //å°†æ•°æ®è¯»å‡ºæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯
            long byteWirte = 0;
            while (byteWirte &lt; messageLength) {
                long l = socketChannel.write(byteBuffers);//
                byteWirte += l;
            }
            
            //å°†æ‰€æœ‰çš„bufferè¿›è¡Œclear
            Arrays.asList(byteBuffers).forEach(buffer -&gt; {
                buffer.clear();
            });
            
            System.out.println("byteRead = " + byteRead + ", byteWrite = " + byteWirte + ", messagelength = " + messageLength);
        }
    }
}
</code></pre>
<h2 id="3-Selectorï¼ˆé€‰æ‹©å™¨ï¼‰"><a href="#3-Selectorï¼ˆé€‰æ‹©å™¨ï¼‰" class="headerlink" title="3. Selectorï¼ˆé€‰æ‹©å™¨ï¼‰"></a>3. Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</h2><h3 id="åŸºæœ¬æ¦‚å¿µ-2"><a href="#åŸºæœ¬æ¦‚å¿µ-2" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reator æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</p>
<p>é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯é¸¡è¡€è½®è¯¢å…¶ä»– Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚</p>
<p>ä»¥ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªäº‹ä»¶æ˜¾ç„¶æ¯”ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/0b37a3b751ec9aa08efa75ace30e23c4_MD5.png" loading="lazy" class="lazy-image"></div></p>
<ol>
<li>Java ä¸­çš„ NIO å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ° Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</li>
<li>å¤šä¸ª Channel ä»¥äº‹ä»¶çš„æ–¹å¼æ³¨å†Œåˆ° Selector</li>
<li>åªæœ‰åœ¨è¿æ¥é€šé“æœ‰çœŸæ­£çš„è¯»å†™äº‹ä»¶çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€</li>
<li>é¿å…äº†<code>å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€</code></li>
</ol>
<pre><code class="language-java">//Selector ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¸¸ç”¨æ–¹æ³•å’Œè¯´æ˜å¦‚ä¸‹ï¼š
public abstract class Selector implements Closeable{
	public static Selector open();//ç›‘æ§æ‰€æœ‰æ³¨å†Œçš„é€šé“ï¼Œå½“å…¶ä¸­æœ‰IOæ“ä½œå¯ä»¥è¿›è¡Œæ—¶ï¼Œå°†SelectionKeyåŠ å…¥åˆ°å†…éƒ¨çš„é›†åˆä¸­å¹¶è¿”å›ï¼Œå‚æ•°ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´
	public Set&lt;SelectionKey&gt; selectedKey();//ä»å†…éƒ¨é›†åˆä¸­å¾—åˆ°æ‰€æœ‰çš„SelectionKey	
}
</code></pre>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><ol>
<li><strong>åˆ›å»ºé€‰æ‹©å™¨</strong></li>
</ol>
<pre><code class="language-java">Selector selector = Selector.open();
</code></pre>
<ol start="2">
<li><strong>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</strong></li>
</ol>
<pre><code class="language-java">ServerSocketChannel ssChannel = ServerSocketChannel.open();
ssChannel.configureBlocking(false);
ssChannel.register(selector,SelectionKey.OP_ACCEPT);
</code></pre>
<p>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p>
<p><code>SelectionKey. OP_CONNECT</code>ã€<code>SelectionKey. OP_ACCEPT</code>ã€<code>SelectionKey. OP_READ</code>ã€ <code>SelectionKey. OP_WRITE</code></p>
<p>ä»–ä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public static final int OP_READ = 1 &lt;&lt; 0;
public static final int OP_WRITE = 1 &lt;&lt; 2;
public static final int OP_CONNECT = 1 &lt;&lt; 3;
public static final int OP_ACCEPT = 1 &lt;&lt; 4;
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶éƒ½èƒ½å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-java">int intersetSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;
</code></pre>
<ol start="3">
<li><strong>ç›‘å¬äº‹ä»¶</strong></li>
</ol>
<pre><code class="language-java">int num = selector.select();
</code></pre>
<p>ä½¿ç”¨ <code>select()</code> æ–¹æ³•æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡çŸ¥é“æœ‰è‡³å°‘ä¸€ä»¶äº‹ä»¶åˆ°è¾¾ã€‚</p>
<ol start="4">
<li><strong>è·å–åˆ°è¾¾çš„äº‹ä»¶</strong></li>
</ol>
<pre><code class="language-java">Set&lt;SelectionKey&gt; keys = selector.selectedKeys();
Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();
while(keyIterator.hasNext()){
	SelectionKey keyu = keyIterator.next();
	if(key.isAcceptabnle()){
	// ...
	}else if(key.isReadable()){
	// ...
	}
	keyIterator.remove();
}
</code></pre>
<ol start="5">
<li><strong>æ—¶é—´å¾ªç¯</strong></li>
</ol>
<p>å› ä¸ºä¸€æ¬¡ select() è°ƒåŠ¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†æ—¶é—´çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p>
<pre><code class="language-java">while (true) { 
	int num = selector.select(); 
	Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); 
	Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator(); 
	while (keyIterator.hasNext()) { 
		SelectionKey key = keyIterator.next(); 
		if (key.isAcceptable()) { 
		  // ... 
		} else if (key.isReadable()) {
		  // ... 
		} 
		keyIterator.remove(); 
	}
}
</code></pre>
<h3 id="å¥—æ¥å­—-NIO-å®ä¾‹"><a href="#å¥—æ¥å­—-NIO-å®ä¾‹" class="headerlink" title="å¥—æ¥å­— NIO å®ä¾‹"></a>å¥—æ¥å­— NIO å®ä¾‹</h3><pre><code class="language-java">public class NIOServer {
 	public static void main(String[] args) throws IOException {
		Selector selector = Selector.open();
		ServerSocketChannel ssChannel = ServerSocketChannel.open();
		ssChannel.configureBlocking(false);
		ssChannel.register(selector, SelectionKey.OP_ACCEPT);
		ServerSocket serverSocket = ssChannel.socket();
		InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888);
		serverSocket.bind(address);
		while(true){
			selector.select();
			Set&lt;SelectionKey&gt; keys = selector.selectedKeys();
			Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();
			while (keyIterator.hasNext()){
				SelectionKey key = keyIterator.next();
				if (key.isAcceptable()) {
					ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel();// æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel SocketChannel sChannel = ssChannel1.accept();
					sChannel.configureBlocking(false);// è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ® 
					sChannel.register(selector, SelectionKey.OP_READ);
				}else if (key.isReadable()) {
					SocketChannel sChannel = (SocketChannel) key.channel();
					System.out.println(readDataFromSocketChannel(sChannel));
					sChannel.close();
				}
 			keyIterator.remove();
			}
		}
 	}
	private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException {
		ByteBuffer buffer = ByteBuffer.allocate(1024);
		StringBuilder data = new StringBuilder();
		while(true) {
			buffer.clear();
			int n = sChannel.read(buffer);
			if (n == -1) {
				break;
			}
			buffer.flip();
			int limit = buffer.limit();
			char[] dst = new char[limit];
			for (int i = 0;i &lt; limit;i++) {
				dst[i] = (char) buffer.get(i);
			}
			data.append(dst);
			buffer.clear();
 		}
 		return data.toString();
 	}
 }
</code></pre>
<pre><code class="language-java">public class NIOClient {
	public static void main(String[] args) throws IOException{
		Socket socket = new Socket("127.0.0.1"ï¼Œ8888);
		OutputStream out = socket.getOutputStream();
		String s = "hello world";
		out.write(s.getBytes());
		out.close();
	}
}
</code></pre>
<h2 id="å…¸å‹çš„å¤šè·¯å¤ç”¨-IO-å®ç°"><a href="#å…¸å‹çš„å¤šè·¯å¤ç”¨-IO-å®ç°" class="headerlink" title="å…¸å‹çš„å¤šè·¯å¤ç”¨ IO å®ç°"></a>å…¸å‹çš„å¤šè·¯å¤ç”¨ IO å®ç°</h2><p>ç›®å‰æµç¨‹çš„å¤šè·¯å¤ç”¨ IO å®ç°ä¸»è¦å®åº“äº†å››ç§ï¼šselectã€pollã€epollã€kqueueã€‚ä»¥ä¸‹æ˜¯å…¶ç‰¹æ€§åŠåŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th align="center">IO æ¨¡å‹</th>
<th align="center">ç›¸å¯¹æ€§èƒ½</th>
<th align="center">å…³é”®æ€è·¯</th>
<th align="center">æ“ä½œç³»ç»Ÿ</th>
<th align="center">Java æ”¯æŒæƒ…å†µ</th>
</tr>
</thead>
<tbody><tr>
<td align="center">select</td>
<td align="center">è¾ƒé«˜</td>
<td align="center">Reactor</td>
<td align="center">Win/Linux</td>
<td align="center">æ”¯æŒï¼ŒReactor æ¨¡å¼ï¼ˆååº”å™¨è®¾è®¡æ¨¡å¼ï¼‰ã€‚Linux kernels 2.4 å†…æ ¸ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤ç”¨çš„æ˜¯ select ï¼›ç›®å‰ windows ä¸‹å¯¹å§åŒæ­¥ IO çš„æ”¯æŒï¼Œéƒ½æ˜¯ select æ¨¡å‹</td>
</tr>
<tr>
<td align="center">poll</td>
<td align="center">è¾ƒé«˜</td>
<td align="center">Reactor</td>
<td align="center">Linux</td>
<td align="center">Linux ä¸‹çš„ Java çš„ NIO æ¡†æ¶ï¼ŒLinux kernels 2.6 å†…æ ¸ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨ poll è¿›è¡Œæ”¯æŒã€‚ä¹Ÿæ˜¯ä½¿ç”¨çš„ Reactor æ¨¡å¼</td>
</tr>
<tr>
<td align="center">epoll</td>
<td align="center">é«˜</td>
<td align="center">Reactor/Proactor</td>
<td align="center">Linux</td>
<td align="center">Linux kernels 2.6 å†…æ ¸ç‰ˆæœ¬ä¹‹åä½¿ç”¨ epoll è¿›è¡Œæ”¯æŒ</td>
</tr>
<tr>
<td align="center">kqueue</td>
<td align="center">é«˜</td>
<td align="center">Proactor</td>
<td align="center">Linux</td>
<td align="center">ç›®å‰ Java ç‰ˆæœ¬ä¸æ”¯æŒ</td>
</tr>
</tbody></table>
<h3 id="1-Reactoräº‹ä»¶é©±åŠ¨æ¨¡å‹"><a href="#1-Reactoräº‹ä»¶é©±åŠ¨æ¨¡å‹" class="headerlink" title="1. Reactoräº‹ä»¶é©±åŠ¨æ¨¡å‹"></a>1. Reactoräº‹ä»¶é©±åŠ¨æ¨¡å‹</h3><p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/10d0080498aba2649f1c04067965b579_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>ä»å›¾ä¸Šå¯çŸ¥ï¼šä¸€ä¸ªå®Œæ•´çš„ Reactor äº‹ä»¶é©±åŠ¨æ¨¡å‹æ˜¯æœ‰å››ä¸ªéƒ¨åˆ†ç»„æˆï¼šå®¢æˆ·ç«¯ Clientï¼ŒReactorï¼ŒAcceptor å’Œæ—¶é—´å¤„ç† Handlerã€‚å…¶ä¸­ Acceptor ä¼šä¸é—´æ–­çš„æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åé€šè¿‡ Reactor åˆ†å‘åˆ°ä¸åŒ Handler è¿›è¡Œå¤„ç†ã€‚æ”¹è¿›åçš„ Reactor æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è™½ç„¶åŒæ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥æ”¶è¿æ¥è¯·æ±‚è¿›è¡Œç½‘ç»œè¯»å†™ï¼Œä½†æ˜¯ Reactor å°†å®¢æˆ·ç«¯è¿æ¥ï¼Œç½‘ç»œè¯»å†™ï¼Œä¸šåŠ¡å¤„ç†ä¸‰å¤§éƒ¨åˆ†æ‹†åˆ†ï¼Œä»è€Œæå¤§æé«˜å·¥ä½œæ•ˆç‡ã€‚</li>
<li>Reactor æ˜¯ä»¥äº‹ä»¶é©±åŠ¨çš„ï¼Œç›¸æ¯”ä¼ ç»Ÿ IO é˜»å¡å¼çš„ï¼Œä¸å¿…ç­‰å¾…ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡ã€‚</li>
</ul>
<h3 id="2-Reactor-æ¨¡å‹â€”â€”ä¸šåŠ¡å¤„ç†å’Œ-IO-åˆ†ç¦»"><a href="#2-Reactor-æ¨¡å‹â€”â€”ä¸šåŠ¡å¤„ç†å’Œ-IO-åˆ†ç¦»" class="headerlink" title="2. Reactor æ¨¡å‹â€”â€”ä¸šåŠ¡å¤„ç†å’Œ IO åˆ†ç¦»"></a>2. Reactor æ¨¡å‹â€”â€”ä¸šåŠ¡å¤„ç†å’Œ IO åˆ†ç¦»</h3><p>åœ¨ä¸Šé¢çš„å¤„ç†æ¨¡å‹ä¸­ï¼Œç”±äºç½‘ç»œè¯»å†™æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢ã€‚åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ä¸¤ä¸ªç“¶é¢ˆï¼š</p>
<ul>
<li>é«˜é¢‘ç‡çš„è¯»å†™äº‹ä»¶å¤„ç†</li>
<li>å¤§é‡çš„ä¸šåŠ¡å¤„ç†</li>
</ul>
<p>åŸºäºä¸Šè¿°ç“¶é¢ˆï¼Œå¯ä»¥å°†ä¸šåŠ¡å¤„ç†å’Œ IO è¯»å†™åˆ†ç¦»å‡ºæ¥ï¼š</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/37b1874d4aabb48cd6b511cba09fa70b_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>å¦‚å›¾å¯ä»¥çœ‹å‡ºï¼Œç›¸å¯¹åŸºç¡€ Reactor æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå®¢æˆ·ç«¯è¿æ¥å’Œç½‘ç»œè¯»å†™</li>
<li>å®¢æˆ·ç«¯è¿æ¥ä¹‹åï¼Œå°†è¯¥è¿æ¥äº¤ç»™çº¿ç¨‹æ± è¿›è¡ŒåŠ è§£ç ä»¥åŠä¸šåŠ¡å¤„ç†</li>
</ul>
<p>è¿™ç§æ¨¡å‹åœ¨æ¥æ”¶è¯·æ±‚è¿›è¡Œç½‘ç»œè¯»å†™çš„åŒæ—¶ï¼Œä¹Ÿåœ¨è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸è¶³çš„åœ°æ–¹ï¼š</p>
<ul>
<li>ç½‘ç»œè¯»å†™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¶ˆè€— CPU çš„æ“ä½œï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå°†æœ‰å¤§é‡çš„å®¢æˆ·ç«¯éœ€è¦ç½‘ç»œè¯»å†™ï¼Œæ­¤æ—¶ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸äº†è¿™ä¹ˆå¤šçš„è¯·æ±‚ã€‚</li>
</ul>
<h3 id="3-Reactorâ€”â€”å¹¶å‘è¯»å†™"><a href="#3-Reactorâ€”â€”å¹¶å‘è¯»å†™" class="headerlink" title="3. Reactorâ€”â€”å¹¶å‘è¯»å†™"></a>3. Reactorâ€”â€”å¹¶å‘è¯»å†™</h3><p>ç”±äºé«˜å¹¶å‘çš„ç½‘ç»œè¯»å†™æ˜¯ç³»ç»Ÿä¸€ä¸ªç“¶é¢ˆï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæ”¹è¿›äº†æ¨¡å‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/870a39b7312d1d18324d3aefa613ab37_MD5.png" loading="lazy" class="lazy-image"></div><br>ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨åŸæœ‰ Reactor æ¨¡å‹ä¸Šï¼ŒåŒæ—¶å°† Reactor æ‹†åˆ†æˆ mainReactor å’Œ subReactor ã€‚å…¶ä¸­ mainReactor ä¸»è¦è´Ÿè´£å®¢æˆ·ç«¯çš„è¯·æ±‚è¿æ¥ï¼ŒsubReactor é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ± è¿›è¡Œæ”¯æ’‘ï¼Œä¸»è¦è´Ÿè´£ç½‘ç»œè¯»å†™ï¼Œå› ä¸ºçº¿ç¨‹æ± çš„åŸå› ï¼Œå¯ä»¥è¿›è¡Œå¤šçº¿ç¨‹å¹¶å‘è¯»å†™ï¼Œå¤§å¤§æå‡äº†ç½‘ç»œè¯»å†™çš„æ•ˆç‡ã€‚ä¸šåŠ¡å¤„ç†ä¹Ÿæ˜¯é€šè¿‡çº¿ç¨‹æ± è¿›è¡Œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è¿›è¡Œç™¾ä¸‡çº§åˆ«çš„è¿æ¥ã€‚</p>
<h3 id="4-Reactor-æ¨¡å‹ç¤ºä¾‹"><a href="#4-Reactor-æ¨¡å‹ç¤ºä¾‹" class="headerlink" title="4. Reactor æ¨¡å‹ç¤ºä¾‹"></a>4. Reactor æ¨¡å‹ç¤ºä¾‹</h3><p>å¯¹äºä¸Šè¿°çš„ Reactor æ¨¡å‹ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ ¸å¿ƒéœ€è¦å®ç°ï¼šAcceptorï¼ŒReactor å’Œ Handlerã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class Reactor implements Runnable{
	private final Selector selector;
	private final ServerSocketChannel serverSocket;

	public Reactor(int port) throws IOException{
		serverSocket = ServerSocketChannel.open();//åˆ›å»ºæœåŠ¡ç«¯çš„ServerSocketChannel
		serverSocket.configureBlocking(false);//è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
		selector = Selector.open();//åˆ›å»ºä¸€ä¸ªselectoré€‰æ‹©å™¨
		SelectionKey key = serverSocket.register(selector,SelectionKey.OP_ACCEPT);
		serverSocket.bind(new InetSocketAddress(port));//ç»‘å®šæœåŠ¡ç«¯ç«¯å£
		key.attach(new Acceptor(serverSocket));//ä¸ºæœåŠ¡ç«¯Channelç»‘å®šä¸€ä¸ªAcceptor
	}
	@Override
	public void run(){
		try{
			while(ï¼Thread.interrupted()){
				selector.select();//æœåŠ¡ç«¯ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ä¸åœæ¥æ”¶è¿æ¥è¯·æ±‚
				Set&lt;SelectionKey&gt; keys = selector.selectedKeys();
				Iterator&lt;SelectionKey&gt; itetrator = keys.iterator();
				while(iterator.hasNext()){
					dispatch(iterator.next());
					iterator.remove();
					}
				selector.selectNow();
				}
		}catch(IOException e){
			e.printStackTrace();
		}
	}

	private void dispatch(SelectionKey key) throws IOException{
		//è¿™é‡Œçš„attachmentä¹Ÿå³å‰é¢çš„ä¸ºæœåŠ¡ç«¯Channelç»‘å®šçš„Acceptorï¼Œè°ƒç”¨å…¶run()æ–¹æ³•è¿›è¡Œåˆ†å‘
		Runnable attachment = (Runable)key.attachment();
		attachment.run();
	}

}
</code></pre>
<p>è¿™é‡ŒReactoré¦–å…ˆå¼€å¯äº†ä¸€ä¸ªServerSocketChannelï¼Œç„¶åå°†å…¶ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼Œå¹¶ä¸”æ³¨å†Œåˆ°äº†ä¸€ä¸ªå¤šè·¯å¤ç”¨å™¨ä¸Šã€‚æ¥ç€åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå…¶ä¼šåœ¨å¤šè·¯å¤ç”¨å™¨ä¸Šç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°è¾¾åï¼ŒReactorå°±ä¼šå°†å…¶æ´¾å‘ç»™ä¸€ä¸ªAcceptorï¼Œç”±è¯¥Acceptorä¸“é—¨è¿›è¡Œå®¢æˆ·ç«¯è¿æ¥çš„è·å–ã€‚ä¸‹é¢æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹Acceptorçš„ä»£ç ï¼š</p>
<pre><code class="language-java">public class Acceptor implements Runnable{
	private final ExecuteorService executor = Exxcutors.newFixedThreadPool(20);

	private final ServerSocketChannel serverSocket;

	public Acceptor(ServerSocketChannel serverSocket){
		this.serverSocket = serverSocket;
		}

	@Override
	public void run(){
		try{
			SocketChannel channel = serverSocket.accept();
			if(null != channel){
				executor.execute(new Handler(channel));
			}
		}catch(IOException e){
			e.printStackTrace();
		}
	}
}
</code></pre>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨Acceptorè·å–åˆ°å®¢æˆ·ç«¯è¿æ¥ä¹‹åï¼Œå…¶å°±å°†å…¶äº¤ç”±çº¿ç¨‹æ± è¿›è¡Œç½‘ç»œè¯»å†™äº†ï¼Œè€Œè¿™é‡Œçš„ä¸»çº¿ç¨‹åªæ˜¯ä¸æ–­ç›‘å¬å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹Handlerçš„å…·ä½“é€»è¾‘ï¼š</p>
<pre><code class="language-java">public class Handler implements Runnable{
	private volatile static Selector selector;
	private final SocketChannel channel;
	private SelectionKey key;
	private volatile ByteBuffer input = ByteBuffer.allocate(1024);
	private volatile ByteBuffer output = ByteBuffer.allocate(1024);

	public Handle(SocketChannel channel) throws IOException{
		this.channel = channel;
		channel.configureBlocking(false);//è®¾ç½®å®¢æˆ·ç«¯è¿æ¥ä¸ºéé˜»å¡æ¨¡å¼
		selector = Selector.open();//ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨
		key = channel.register(selector,SelectionKey.OP_READ);//æ³¨å†Œå®¢æˆ·ç«¯Channelçš„è¯»äº‹ä»¶	
	}

	@Override
	public void run(){
		try{
			while(selector.isOpen() &amp;&amp; channel.isOpen()){
			 	Set&lt;SelectionKey&gt; keys = select();//ç­‰å¾…å®¢æˆ·ç«¯äº‹ä»¶å‘ç”Ÿ
			 	Iterator&lt;SelectionKey&gt; iterator = keys.iterator();
				while(iterator.hasNext()){
					SelectionKey key = iterator.next();
					iterator.remove();

					//å¦‚æœå½“å‰æ˜¯è¯»äº‹ä»¶ï¼Œåˆ™è¯»å–æ•°æ®
					if(key.isReadable()){
						read(key);
					}else if(key.isWritable()){
						write(key)
					}
				}
			}	
		}catch(IOException e){
		e.printStackTrace();
		}
	}
	//è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®

	private void read(SelectionKey key) throws IOException{
		channel.read(input);
		if(input.position() == 0){
			return ;
		}
		input.flip();
		process();//å¯¹è¯»æ•°æ®è¿›è¡Œä¸šåŠ¡å¤„ç†
		input.clear();
		key.interstOps(SelectionKey.OP_WRITE);//è¯»å–å®Œæˆåç›‘å¬å†™å…¥äº‹ä»¶
	}
	private void write(SelectionKey key) throws IOException{
		output.flip();
		if(channel.isOpen()){
			channel.write(output);//å½“æœ‰å†™å…¥äº‹ä»¶æ—¶ï¼Œå°†ä¸šåŠ¡å¤„ç†çš„ç»“æœå†™å…¥åˆ°å®¢æˆ·ç«¯Channelä¸­
			key.channel();
			channel.close();
			output.clear();
		}
	}
	//è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶ä¸”è·å–å¤„ç†ç»“æœã€‚æœ¬è´¨ä¸Šï¼ŒåŸºäºReactoræ¨¡å‹ï¼Œå¦‚æœè¿™é‡Œæˆä¸ºå¤„ç†ç“¶é¢ˆï¼Œåˆ™å°†å¤„ç†è¿‡ç¨‹æ”¾å…¥åˆ°çº¿ç¨‹æ± é‡Œé¢å³å¯ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªFutureè·å–å¤„ç†ç»“æœï¼Œæœ€åå†™å…¥åˆ°å®¢æˆ·ç«¯Channelä¸­
	private void process(){
		byte[] bytes = new byte[input.remaining()];
		input.get(bytes);
		String message = new String(bytes,CharsetUtil.UTF_8);
		System.out.println("receive message from client: \n" +message);
		output.put("hello client".getBytes());
	}
}
</code></pre>
<p>åœ¨ Handler ä¸­ï¼Œä¸»è¦è¿›è¡Œçš„å°±æ˜¯æ¯ä¸ªå®¢æˆ·ç«¯ Channel åˆ›å»ºä¸€ä¸ª Selectorï¼Œå¹¶ä¸”ç›‘å¬è¯¥ Channel çš„ç½‘ç»œè¯»å†™äº‹ä»¶ã€‚å½“æœ‰äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œè¿›è¡Œæ•°æ®çš„è¯»å†™ï¼Œè€Œä¸šåŠ¡æ“ä½œäº¤å‹å…·ä½“çš„ä¸šåŠ¡çº¿ç¨‹æ± å¤„ç†ã€‚</p>
<h1 id="ä¸‰ã€AIOï¼ˆ-Asynchronous-I-Oï¼‰"><a href="#ä¸‰ã€AIOï¼ˆ-Asynchronous-I-Oï¼‰" class="headerlink" title="ä¸‰ã€AIOï¼ˆ Asynchronous I/Oï¼‰"></a>ä¸‰ã€AIOï¼ˆ Asynchronous I/Oï¼‰</h1><ol>
<li>JDK7 å¼•å…¥äº† Asynchronous I/Oï¼Œå³ AIOã€‚åœ¨è¿›è¡Œ I/O ç¼–ç¨‹ä¸­ï¼Œå¸¸ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼šReactor å’Œ Proactorã€‚Java çš„ NIO å°±æ˜¯ Reactorï¼Œå½“æœ‰äº‹ä»¶è§¦å‘æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†</li>
<li>AIO å³ NIO2.0ï¼Œå«åšå¼‚æ­¥ä¸é˜»å¡çš„ IOã€‚AIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨</li>
</ol>
<h3 id="å¼‚æ­¥-IO"><a href="#å¼‚æ­¥-IO" class="headerlink" title="å¼‚æ­¥ IO"></a>å¼‚æ­¥ IO</h3><p>ä¹‹å‰ä¸»è¦ä»‹ç»äº†é˜»å¡å¼åŒæ­¥ IOï¼Œéé˜»å¡å¼åŒæ­¥ IOï¼Œå¤šè·¯å¤ç”¨ IO è¿™ä¸‰ç§ IO æ¨¡å‹ã€‚è€Œå¼‚æ­¥ IO æ˜¯é‡‡ç”¨â€œè®¢é˜…-é€šçŸ¥â€æ¨¡å¼ï¼Œå³åº”ç”¨ç¨‹åºå‘æ“ä½œç³»ç»Ÿæ³¨å†Œ IO ç›‘å¬ï¼Œç„¶åç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ã€‚å½“æ“ä½œç³»ç»Ÿå‘ç”Ÿ IO äº‹ä»¶ï¼Œå¹¶ä¸”å‡†å¤‡å¥½æ•°æ®åï¼Œä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œè§¦å‘ç›¸åº”çš„å‡½æ•°ï¼š</p>
<p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/3a01157436842562f7f21f8b4c4549d4_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>å’ŒåŒæ­¥ IO ä¸€æ ·ï¼Œå¼‚æ­¥ IO ä¹Ÿæ˜¯ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œæ”¯æŒçš„ã€‚Windows ç³»ç»Ÿæä¾›äº†ä¸€ç§å¼‚æ­¥ IO æŠ€æœ¯ï¼šIOCPï¼ˆI/O Completion Portï¼ŒI/O å®Œæˆç«¯å£ï¼‰ï¼›<br>Linux ä¸‹ç”±äºæ²¡æœ‰è¿™ç§å¼‚æ­¥ IO æŠ€æœ¯ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯ epollï¼ˆä¸Šæ–‡ä»‹ç»è¿‡çš„ä¸€ç§å¤šè·¯å¤ç”¨ IO æŠ€æœ¯çš„å®ç°ï¼‰å¯¹å¼‚æ­¥ IO è¿›è¡Œæ¨¡æ‹Ÿã€‚</p>
<h3 id="Java-AIO-æ¡†æ¶è§£æ"><a href="#Java-AIO-æ¡†æ¶è§£æ" class="headerlink" title="Java AIO æ¡†æ¶è§£æ"></a>Java AIO æ¡†æ¶è§£æ</h3><p> <div class="image-container loading"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="[]" data-src="/img/2ff37cd0e1f5f734f8d6209396a08897_MD5.png" loading="lazy" class="lazy-image"></div></p>
<p>ä»¥ä¸Šç»“æ„ä¸»è¦æ˜¯è¯´æ˜ JAVA AIO ä¸­ç±»è®¾è®¡å’Œæ“ä½œç³»ç»Ÿçš„ç›¸å…³æ€§ã€‚</p>
<blockquote>
<p>ä¸Šè¿°æ‰€æœ‰ä»£ç ä»“åº“åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/z1gui/netty_io">https://github.com/z1gui/netty_io</a></p>
</blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/520809188?utm_id=0">BIOã€NIOã€AIOåŒºåˆ«è¯¦è§£</a></p>
<p><a target="_blank" rel="noopener" href="https://pdai.tech/md/java/io/java-io-overview.html">â™¥Java IOçŸ¥è¯†ä½“ç³»è¯¦è§£â™¥</a></p>
</blockquote>

                </div>
            </div>
            <div class="post-content-sidebar">
                <div class="toc-toggle-btn" id="tocToggleBtn" title="æ˜¾ç¤ºç›®å½•">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </div>
                <div class="post-toc" id="postToc">
                    <div class="toc-header">
                        <div class="toc-title">ç›®å½•</div>
                    </div>
                    <div class="toc-content"></div>
                </div>
            </div>
        </div>
    

<!-- åªåœ¨æ–‡ç« é¡µé¢æ˜¾ç¤ºåˆ†ç±»å’Œå¯¼èˆª -->

    <!-- åˆ†ç±»ä¿¡æ¯ -->
    
        <div class="post-categories">
            åˆ†ç±»ï¼š
            
                <a href="/categories/%E5%90%8E%E7%AB%AF/"> / åç«¯</a>
            
        </div>
    

    <!-- åˆ†äº«æŒ‰é’® -->
    <div class="post-share">
        <button class="share-btn" id="shareBtn" title="åˆ†äº«æ–‡ç« ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 5.12548 15.0077 5.24917 15.0227 5.37061L8.08264 9.26727C7.54305 8.48822 6.60487 8 5.5 8C4.11929 8 3 9.11929 3 10.5C3 11.8807 4.11929 13 5.5 13C6.60487 13 7.54305 12.5118 8.08264 11.7327L15.0227 15.6294C15.0077 15.7508 15 15.8745 15 16C15 17.6569 16.3431 19 18 19C19.6569 19 21 17.6569 21 16C21 14.3431 19.6569 13 18 13C16.8951 13 15.9569 13.4882 15.4174 14.2673L8.47736 10.3706C8.49232 10.2492 8.5 10.1255 8.5 10C8.5 9.87452 8.49232 9.75083 8.47736 9.62939L15.4174 5.73273C15.9569 6.51178 16.8951 7 18 7C19.6569 7 21 5.65685 21 4C21 2.34315 19.6569 1 18 1C16.3431 1 15 2.34315 15 4C15 4.12548 15.0077 4.24917 15.0227 4.37061L8.08264 8.26727C7.54305 7.48822 6.60487 7 5.5 7C3.567 7 2 8.567 2 10.5C2 12.433 3.567 14 5.5 14C6.60487 14 7.54305 13.5118 8.08264 12.7327L15.0227 16.6294C15.0077 16.7508 15 16.8745 15 17C15 18.6569 16.3431 20 18 20C19.6569 20 21 18.6569 21 17C21 15.3431 19.6569 14 18 14C16.8951 14 15.9569 14.4882 15.4174 15.2673L8.47736 11.3706C8.49232 11.2492 8.5 11.1255 8.5 11C8.5 10.8745 8.49232 10.7508 8.47736 10.6294L15.4174 6.73273C15.9569 7.51178 16.8951 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            åˆ†äº«
        </button>
    </div>

    <!-- æ·»åŠ ä¸Šä¸€ç¯‡å’Œä¸‹ä¸€ç¯‡å¯¼èˆª -->
    <div class="post-navigation">
        <div class="post-nav-prev">
            
                <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                <a href="/761386768996831/" class="nav-title">Kafkaæ·±å…¥æµ…å‡º</a>
            
        </div>
        <div class="post-nav-next">
            
                <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                <a href="/761386768996885/" class="nav-title">ç±»åŠ è½½å™¨ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹</a>
            
        </div>
    </div>

</div>

<!-- å›¾ç‰‡å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="image-modal" id="imageModal">
    <img id="modalImage" src="" alt="å…¨å±å›¾ç‰‡">
</div>

<!-- ä»£ç å…¨å±æ˜¾ç¤ºæ¨¡æ€æ¡† -->
<div class="code-modal" id="codeModal">
    <div class="code-modal-content">
        <div class="code-modal-header">
            <div class="code-modal-title">ä»£ç æŸ¥çœ‹</div>
            <div class="code-modal-close" id="codeModalClose">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
        </div>
        <div class="code-modal-code">
            <pre><code id="modalCode"></code></pre>
        </div>
    </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const postImages = document.querySelectorAll('.post-md img');

    // ç‚¹å‡»å›¾ç‰‡æ‰“å¼€æ¨¡æ€æ¡†
    postImages.forEach(img => {
        // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦åœ¨ç¤¾äº¤é“¾æ¥ä¸­
        const isSocialIcon = img.closest('.social-links') !== null;
        if (!isSocialIcon) {
            img.addEventListener('click', function() {
                modal.classList.add('active');
                modalImg.src = this.src;
                document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            });
        }
    });

    // ç‚¹å‡»æ¨¡æ€æ¡†å…³é—­
    modal.addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
    });

    // æŒ‰ ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    // é˜…è¯»è¿›åº¦æ¡åŠŸèƒ½
    const progressBar = document.getElementById('readingProgressBar');
    if (progressBar) {
        function updateReadingProgress() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            
            // é™åˆ¶è¿›åº¦æ¡å®½åº¦åœ¨0-100%ä¹‹é—´
            const progressWidth = Math.min(Math.max(scrollPercent, 0), 100);
            progressBar.style.width = progressWidth + '%';
        }

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', updateReadingProgress);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¿›åº¦æ¡
        updateReadingProgress();
    }



    // ç›®å½•åŠŸèƒ½å·²ç§»è‡³å·¥å…·æ ç»Ÿä¸€ç®¡ç†

    // ä»£ç å—å…¨å±åŠŸèƒ½
    const codeModal = document.getElementById('codeModal');
    const modalCode = document.getElementById('modalCode');
    const codeModalClose = document.getElementById('codeModalClose');

    // ä¸ºæ‰€æœ‰ä»£ç å—æ·»åŠ å…¨å±æŒ‰é’®
    const codeBlocks = document.querySelectorAll('.post-md pre');
    codeBlocks.forEach(pre => {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰æŒ‰é’®ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
        if (!pre.querySelector('.code-fullscreen-btn')) {
            const fullscreenBtn = document.createElement('div');
            fullscreenBtn.className = 'code-fullscreen-btn';
            fullscreenBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H5C3.89543 3 3 3.89543 3 5V8M21 8V5C21 3.89543 20.1046 3 19 3H16M16 21H19C20.1046 21 21 20.1046 21 19V16M3 16V19C3 20.1046 3.89543 21 5 21H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            fullscreenBtn.title = 'å…¨å±æŸ¥çœ‹ä»£ç ';
            
            // ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå…¨å±ä»£ç 
            fullscreenBtn.addEventListener('click', function() {
                const codeElement = pre.querySelector('code');
                if (codeElement) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å·²ç»åº”ç”¨äº†è¡Œå·çš„ä»£ç å—
                    const hljsTable = pre.querySelector('table.hljs-ln');
                    
                    let codeContent;
                    let startLineNumber = 1;
                    
                    if (hljsTable) {
                        // å¦‚æœæœ‰è¡Œå·è¡¨æ ¼ï¼Œæå–çº¯ä»£ç å†…å®¹å’Œèµ·å§‹è¡Œå·
                        const codeLines = hljsTable.querySelectorAll('.hljs-ln-code');
                        codeContent = Array.from(codeLines).map(line => {
                            // æå–æ¯è¡Œçš„æ–‡æœ¬å†…å®¹ï¼Œä¿æŒåŸå§‹æ ¼å¼
                            return line.textContent || line.innerText || ' ';
                        }).join('\n');
                        
                        // è·å–èµ·å§‹è¡Œå·
                        const firstNumberCell = hljsTable.querySelector('.hljs-ln-numbers');
                        if (firstNumberCell) {
                            const lineAttr = firstNumberCell.getAttribute('data-line-number');
                            if (lineAttr) {
                                startLineNumber = parseInt(lineAttr) || 1;
                            }
                        }
                    } else {
                        // æ™®é€šä»£ç å—ï¼Œç›´æ¥è·å–æ–‡æœ¬å†…å®¹
                        codeContent = codeElement.textContent || codeElement.innerText;
                    }
                    
                    const codeLanguage = getCodeLanguage(codeElement);
                    
                    // è®¾ç½®æ¨¡æ€æ¡†ä¸­çš„ä»£ç å†…å®¹
                    modalCode.textContent = codeContent;
                    modalCode.className = codeElement.className; // ä¿æŒä»£ç é«˜äº®çš„ç±»å
                    
                    // å¦‚æœåŸä»£ç æœ‰è‡ªå®šä¹‰èµ·å§‹è¡Œå·ï¼Œè®¾ç½®dataå±æ€§
                    if (startLineNumber !== 1) {
                        modalCode.setAttribute('data-ln-start-from', startLineNumber);
                    } else {
                        modalCode.removeAttribute('data-ln-start-from');
                    }
                    
                    // æ›´æ–°æ ‡é¢˜
                    const modalTitle = document.querySelector('.code-modal-title');
                    if (codeLanguage) {
                        modalTitle.textContent = `ä»£ç æŸ¥çœ‹ - ${codeLanguage}`;
                    } else {
                        modalTitle.textContent = 'ä»£ç æŸ¥çœ‹';
                    }
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    codeModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    // é‡æ–°åº”ç”¨ä»£ç é«˜äº®å’Œè¡Œå·
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightElement(modalCode);
                        
                        // åº”ç”¨è¡Œå·
                        if (typeof hljs.lineNumbersBlock !== 'undefined') {
                            hljs.lineNumbersBlock(modalCode, {
                                startFrom: startLineNumber
                            });
                        }
                    }
                }
            });
            
            pre.appendChild(fullscreenBtn);
        }
    });

    // è·å–ä»£ç è¯­è¨€
    function getCodeLanguage(codeElement) {
        const className = codeElement.className;
        const languageMatch = className.match(/language-(\w+)|hljs-(\w+)|\b(\w+)$/);
        if (languageMatch) {
            return languageMatch[1] || languageMatch[2] || languageMatch[3];
        }
        return '';
    }

    // å…³é—­ä»£ç å…¨å±æ¨¡æ€æ¡†
    function closeCodeModal() {
        codeModal.classList.remove('active');
        document.body.style.overflow = '';
    }

    // ç‚¹å‡»å…³é—­æŒ‰é’®
    if (codeModalClose) {
        codeModalClose.addEventListener('click', closeCodeModal);
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­ï¼ˆç‚¹å‡»å†…å®¹åŒºåŸŸä¸å…³é—­ï¼‰
    codeModal.addEventListener('click', function(e) {
        if (e.target === codeModal) {
            closeCodeModal();
        }
    });

    // æŒ‰ ESC é”®å…³é—­ä»£ç æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (codeModal.classList.contains('active')) {
                closeCodeModal();
            }
        }
    });

    // åˆ†äº«åŠŸèƒ½
    const shareBtn = document.getElementById('shareBtn');
    if (shareBtn) {
        shareBtn.addEventListener('click', function() {
            // è·å–æ–‡ç« ä¿¡æ¯
            const title = document.querySelector('.post-main-title')?.textContent?.trim() || 'æœªçŸ¥æ ‡é¢˜';
            const date = document.querySelector('.post-meta')?.textContent?.match(/\d{4}-\d{2}-\d{2}/)?.[0] || '';
            const url = window.location.href;
            
            // è·å–æ–‡ç« å‰å‡ è¡Œå†…å®¹ï¼ˆæ’é™¤æ ‡é¢˜ã€å…ƒä¿¡æ¯ç­‰ï¼‰
            const postContent = document.querySelector('.post-md');
            let content = '';
            if (postContent) {
                // è·å–æ‰€æœ‰æ®µè½å’Œæ–‡æœ¬å†…å®¹
                const paragraphs = postContent.querySelectorAll('p, h1, h2, h3, h4, h5, h6');
                const contentArray = [];
                
                for (let i = 0; i < Math.min(paragraphs.length, 3); i++) {
                    const text = paragraphs[i].textContent?.trim();
                    if (text && text.length > 0) {
                        contentArray.push(text);
                    }
                }
                
                content = contentArray.join('\n\n');
                
                // å¦‚æœå†…å®¹å¤ªé•¿ï¼Œæˆªå–å‰100ä¸ªå­—ç¬¦
                if (content.length > 100) {
                    content = content.substring(0, 100) + '...';
                }
            }
            
            // æ„å»ºåˆ†äº«å†…å®¹
            let shareText = `æ–‡ç« æ ‡é¢˜ï¼š ${title}`;
            if (date) {
                shareText += `\nå‘å¸ƒæ—¶é—´ï¼š ${date}`;
            }
            if (content) {
                shareText += `\n\n${content}`;
            }
            shareText += `\n\nğŸ”— ${url}`;
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard && window.isSecureContext) {
                // ä½¿ç”¨ç°ä»£ Clipboard API
                navigator.clipboard.writeText(shareText).then(function() {
                    showShareSuccess();
                }).catch(function(err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(shareText);
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyTextToClipboard(shareText);
            }
        });
    }
    
    // æ˜¾ç¤ºåˆ†äº«æˆåŠŸæç¤º
    function showShareSuccess() {
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            const originalText = shareBtn.innerHTML;
            shareBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                å·²å¤åˆ¶
            `;
            shareBtn.classList.add('copied');
            
            setTimeout(function() {
                shareBtn.innerHTML = originalText;
                shareBtn.classList.remove('copied');
            }, 2000);
        }
    }
    
    // é™çº§å¤åˆ¶æ–¹æ¡ˆ
    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showShareSuccess();
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
            }
        } catch (err) {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n\n' + text);
        }
        
        document.body.removeChild(textArea);
    }
});
</script>
                
            </div>
        </div>

        <!-- JavaScript -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const html = document.documentElement;
            const header = document.querySelector('.header');
            
            // å¤´éƒ¨å†…å®¹æ»šåŠ¨æ˜¾ç¤º/éšè—åŠŸèƒ½
            let lastScrollTop = 0;
            let scrollThreshold = 3; // æ»šåŠ¨é˜ˆå€¼ï¼Œé¿å…å¾®å°æ»šåŠ¨è§¦å‘
            
            function handleHeaderScroll() {
                if (!header) return;
                
                const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // è®¡ç®—æ»šåŠ¨è·ç¦»
                const scrollDifference = currentScrollTop - lastScrollTop;
                
                // å‘ä¸‹æ»šåŠ¨éšè—
                if (scrollDifference > scrollThreshold && currentScrollTop > 30) {
                    header.classList.add('hidden');
                }
                // å‘ä¸Šæ»šåŠ¨æ˜¾ç¤º
                else if (scrollDifference < -scrollThreshold) {
                    header.classList.remove('hidden');
                }
                // åœ¨é¡µé¢é¡¶éƒ¨æ—¶æ˜¾ç¤º
                else if (currentScrollTop <= 30) {
                    header.classList.remove('hidden');
                }
                
                lastScrollTop = currentScrollTop;
            }
            
            // ç›‘å¬æ»šåŠ¨äº‹ä»¶
            window.addEventListener('scroll', handleHeaderScroll, { passive: true });
            
            // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå¤´éƒ¨å†…å®¹
            if (header) {
                header.classList.remove('hidden');
            }
            
            // ç›®å½•åˆ‡æ¢æŒ‰é’®åŠŸèƒ½ï¼ˆä»…åœ¨æ–‡ç« é¡µé¢ï¼‰
            function setupTocToggle() {
                const tocToggleBtn = document.getElementById('tocToggleBtn');
                const postToc = document.getElementById('postToc');
                
                if (!tocToggleBtn || !postToc) {
                    // å…ƒç´ è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå»¶è¿Ÿé‡è¯•
                    setTimeout(setupTocToggle, 100);
                    return;
                }
                

                
                // å»¶è¿Ÿåº”ç”¨localStorageçŠ¶æ€ï¼Œç¡®ä¿ç›®å½•å·²åˆå§‹åŒ–
                setTimeout(() => {
                    const tocHidden = localStorage.getItem('tocHidden') === 'true';
                    if (tocHidden) {
                        postToc.classList.add('hidden');
                        tocToggleBtn.classList.add('hidden');

                    }
                }, 200);
                
                // ç‚¹å‡»åˆ‡æ¢ç›®å½•æ˜¾ç¤º/éšè—
                tocToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    

                    
                    if (postToc) {
                        const isHidden = postToc.classList.contains('hidden');

                        
                        if (isHidden) {
                            // æ˜¾ç¤ºç›®å½•
                            postToc.classList.remove('hidden');
                            this.classList.remove('hidden');
                            // ç¡®ä¿ç›®å½•å¯è§
                            postToc.style.display = 'flex';
                            localStorage.setItem('tocHidden', 'false');

                        } else {
                            // éšè—ç›®å½•
                            postToc.classList.add('hidden');
                            this.classList.add('hidden');
                            localStorage.setItem('tocHidden', 'true');

                        }
                    }
                });
                

            }
            
            // å¯åŠ¨ç›®å½•åˆ‡æ¢åŠŸèƒ½è®¾ç½®
            setupTocToggle();
        });
        </script>
        
        <!-- å¼‚æ­¥åŠ è½½ä»£ç é«˜äº® -->
        
        <script async="" src="/js/highlight.min.js"></script>
        <script async="" src="/js/highlightjs-line-numbers.js"></script>
        <script>
        // ç­‰å¾…ä»£ç é«˜äº®åº“åŠ è½½å®Œæˆååˆå§‹åŒ–
        function initHighlight() {
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
                hljs.initLineNumbersOnLoad();
            } else {
                setTimeout(initHighlight, 100);
            }
        }
        document.addEventListener('DOMContentLoaded', initHighlight);
        </script>
        
        
        <!-- å¼‚æ­¥åŠ è½½ç›®å½•åŠŸèƒ½ -->
        <script async="" src="/js/toc.js"></script>
    
</body></html>